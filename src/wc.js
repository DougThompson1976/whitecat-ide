var Blockly={};Blockly.Blocks=Object(null);var Blockly={Blocks:{}};Blockly.Blocks.bitlogic={};Blockly.Blocks.bitlogic_msb={init:function(){this.jsonInit({message0:Blockly.Msg.BITLOGIC_MSB_TITLE,args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",colour:Blockly.Blocks.logic.HUE,tooltip:Blockly.Msg.BITLOGIC_MSB_TOOLTIP,helpUrl:Blockly.Msg.BITLOGIC_MSB_HELPURL})}};Blockly.Blocks.bitlogic_lsb={init:function(){this.jsonInit({message0:Blockly.Msg.BITLOGIC_LSB_TITLE,args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",colour:Blockly.Blocks.logic.HUE,tooltip:Blockly.Msg.BITLOGIC_LSB_TOOLTIP,helpUrl:Blockly.Msg.BITLOGIC_LSB_HELPURL})}};"use strict";goog.require("Blockly.Workspace");goog.require("Blockly.Sensors");goog.require("goog.array");goog.require("goog.math");Blockly.Workspace.prototype.getSensors=function(h){if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){var a=require("fs");var g=require("path");var d="boards/defs/sensors.json";var c=g.join(process.cwd(),d);try{var f=a.readFileSync(c,"utf8")}catch(b){return}try{var e=JSON.parse(f);h(e)}catch(b){h(JSON.parse("{}"))}}else{jQuery.ajax({url:Code.folder+"/boards/defs/sensors.json",success:function(i){h(i);return},error:function(){h(JSON.parse("{}"))}})}}else{jQuery.ajax({url:Code.folder+"/boards/defs/sensors.json",success:function(i){h(i);return},error:function(){h(JSON.parse("{}"))}})}};Blockly.Workspace.prototype.wcInit=function(){var b=this;if(typeof this.lora=="undefined"){this.lora={band:"868",activation:"ABP",dr:"0",retx:"0",adr:"false",deveui:"",appeui:"",appkey:"",devaddr:"",nwkskey:"",appskey:""}}if(typeof this.Wifi=="undefined"){this.Wifi={wtype:"STA",ssid:"",password:""}}if(typeof this.MQTT=="undefined"){this.MQTT={clientid:"",host:"",port:"1883",secure:false,username:"",password:""}}if(typeof this.sensors=="undefined"){this.sensors={names:[],provides:[],properties:[],setup:[]}}if(typeof this.allSensors=="undefined"){this.getSensors(function(c){b.allSensors=c})}if(typeof this.events=="undefined"){this.events={builtIn:["event"],names:[]};var a;for(a=0;a<this.events.builtIn.length;a++){this.events.names.push(this.events.builtIn[a])}}if(typeof this.canFrames=="undefined"){this.canFrames={builtIn:["frame"],names:[]};var a;for(a=0;a<this.canFrames.builtIn.length;a++){this.canFrames.names.push(this.canFrames.builtIn[a])}}this.registerToolboxCategoryCallback(Blockly.Sensors.NAME_TYPE,Blockly.Sensors.flyoutCategory);this.registerToolboxCategoryCallback(Blockly.Lora.NAME_TYPE,Blockly.Lora.flyoutCategory);this.registerToolboxCategoryCallback(Blockly.Wifi.NAME_TYPE,Blockly.Wifi.flyoutCategory);this.registerToolboxCategoryCallback(Blockly.MQTT.NAME_TYPE,Blockly.MQTT.flyoutCategory)};Blockly.Workspace.prototype.eventIndexOf=function(b){for(var c=0,a;a=this.events.names[c];c++){if(Blockly.Names.equals(a,b)){return c}}return -1};Blockly.Workspace.prototype.canFrameIndexOf=function(b){for(var c=0,a;a=this.canFrames.names[c];c++){if(Blockly.Names.equals(a,b)){return c}}return -1};Blockly.Workspace.prototype.doCreateEvent=function(c,a){var d=(typeof c!="undefined");if(!d){c=a}var b=this.eventIndexOf(c);if(d){if(b==-1){return -1}else{if(this.eventIndexOf(a)==-1){this.events.names[b]=a}else{return -1}}}else{if(this.eventIndexOf(a)==-1){this.events.names.push(a)}else{return -1}}return this.eventIndexOf(a)};Blockly.Workspace.prototype.doCreateCanFrame=function(c,a){var d=(typeof c!="undefined");if(!d){c=a}var b=this.canFrameIndexOf(c);if(d){if(b==-1){return -1}else{if(this.canFrameIndexOf(a)==-1){this.canFrames.names[b]=a}else{return -1}}}else{if(this.canFrameIndexOf(a)==-1){this.canFrames.names.push(a)}else{return -1}}return this.canFrameIndexOf(a)};Blockly.Workspace.prototype.createEvent=function(d,a){var f=this;var g="";var e=false;if(typeof d!="undefined"){e=true}if(e){var b=this.eventIndexOf(d);if(b<this.events.builtIn.length){Code.showError(Blockly.Msg.ERROR,Blockly.Msg.EVENT_CANNOT_RENAME,function(){});return}}g='<form id="event_form">';g+="<div>";g+='<label for="event_name">'+Blockly.Msg.EVENT_NAME+":&nbsp;&nbsp;</label>";if(e){g+='<input id="event_name" event_name="name" value="'+d+'">'}else{g+='<input id="event_name" name="event_name" value="">'}g+="</div>";g+="</form>";var c=bootbox.dialog({title:e?Blockly.Msg.EDIT_EVENT_TITLE:Blockly.Msg.NEW_EVENT_TITLE,message:g,buttons:{main:{label:e?Blockly.Msg.UPDATE:Blockly.Msg.EVENT_CREATE,clasevent:"btn-primary",callback:function(){var h=jQuery("#event_form").find("#event_name").val();if(h){if((f.eventIndexOf(h)==-1)||(e&&d==h)){var i=f.doCreateEvent(e?d:undefined,h);a.setValue(h);a.setText(h)}else{Code.showError(Blockly.Msg.ERROR,Blockly.Msg.EVENT_ALREADY_EXISTS.replace("%1",h),function(){})}}}},danger:{label:Blockly.Msg.EVENT_CANCEL,clasevent:"btn-danger",callback:function(){}}},closable:false});c.one("shown.bs.modal",function(){c.find("#event_name").focus()})};Blockly.Workspace.prototype.createCanFrame=function(d,a){var f=this;var g="";var e=false;if(typeof d!="undefined"){e=true}if(e){var b=this.canFrameIndexOf(d);if(b<this.canFrames.builtIn.length){Code.showError(Blockly.Msg.ERROR,Blockly.Msg.CAN_FRAME_CANNOT_RENAME,function(){});return}}g='<form id="can_frame_form">';g+="<div>";g+='<label for="frame_name">'+Blockly.Msg.CAN_FRAME_NAME+":&nbsp;&nbsp;</label>";if(e){g+='<input id="frame_name" frame_name="name" value="'+d+'">'}else{g+='<input id="frame_name" name="frame_name" value="">'}g+="</div>";g+="</form>";var c=bootbox.dialog({title:e?Blockly.Msg.EDIT_CAN_FRAME_TITLE:Blockly.Msg.NEW_CAN_FRAME_TITLE,message:g,buttons:{main:{label:e?Blockly.Msg.UPDATE:Blockly.Msg.CAN_FRAME_CREATE,clasevent:"btn-primary",callback:function(){var h=jQuery("#can_frame_form").find("#frame_name").val();if(h){if((f.canFrameIndexOf(h)==-1)||(e&&d==h)){var i=f.doCreateCanFrame(e?d:undefined,h);a.setValue(h);a.setText(h)}else{Code.showError(Blockly.Msg.ERROR,Blockly.Msg.CAN_FRAME_ALREADY_EXISTS.replace("%1",h),function(){})}}}},danger:{label:Blockly.Msg.CAN_FRAME_CANCEL,clasevent:"btn-danger",callback:function(){}}},closable:false});c.one("shown.bs.modal",function(){c.find("#frame_name").focus()})};Blockly.Workspace.prototype.deleteEvent=function(c,a){var b=this.eventIndexOf(c);if(b<this.events.builtIn.length){Code.showError(Blockly.Msg.ERROR,Blockly.Msg.EVENT_CANNOT_REMOVE,function(){})}else{this.events.names.splice(b,1);a.setValue(this.events.names[0]);a.setText(this.events.names[0])}};Blockly.Workspace.prototype.deleteCanFrame=function(c,a){var b=this.canFrameIndexOf(c);if(b<this.canFrames.builtIn.length){Code.showError(Blockly.Msg.ERROR,Blockly.Msg.CAN_FRAME_CANNOT_REMOVE,function(){})}else{this.canFrames.names.splice(b,1);a.setValue(this.canFrames.names[0]);a.setText(this.canFrames.names[0])}};Blockly.Workspace.prototype.sensorIndexOf=function(b){for(var c=0,a;a=this.sensors.names[c];c++){if(Blockly.Names.equals(a,b)){return c}}return -1};Blockly.Workspace.prototype.createSensor=function(c,d){var k=this;var f=(typeof c!="undefined");var b;if(f){b=c}else{b=d.name}var h=this.sensorIndexOf(b);if(f){this.sensors.names[h]=d.name;Code.status.sensors.forEach(function(j,i){if(j.id==d.id){k.sensors.setup[h]=d;k.sensors.provides[h]=j.provides;k.sensors.properties[h]=j.properties}});var a=this.getAllBlocks();for(var g=0;g<a.length;g++){if((a[g].type=="sensor_attach")||(a[g].type=="sensor_read")||(a[g].type=="sensor_set")||(a[g].type=="sensor_when")){if(a[g]["name"]==c){a[g]["interface"]=d["interface"];a[g]["name"]=d.name;for(var e=0;e<a[g]["interface"].split(",").length;e++){a[g]["interface"+e+"_unit"]=d["interface"+e+"_unit"];a[g]["interface"+e+"_subunit"]=d["interface"+e+"_subunit"];a[g]["interface"+e+"_device"]=d["interface"+e+"_device"]}a[g].updateShape_()}}}}else{if(h==-1){this.sensors.names.push(b);h=this.sensorIndexOf(b);Code.status.sensors.forEach(function(j,i){if(j.id==d.id){k.sensors.setup[h]=d;k.sensors.provides[h]=j.provides;k.sensors.properties[h]=j.properties}})}}};Blockly.Workspace.prototype.configureLora=function(a){var c=this;c.lora=a;var e=this.getAllBlocks();for(var b=0;b<e.length;b++){var d=e[b];if((d.type=="lora_join")||(d.type=="lora_tx")){d.band=a.band;d.activation=a.activation;d.dr=a.dr;d.retx=a.retx;d.deveui=a.deveui;d.appeui=a.appeui;d.appkey=a.appkey;d.devaddr=a.devaddr;d.nwkskey=a.nwkskey;d.appskey=a.appskey}}};Blockly.Workspace.prototype.configureWifi=function(a){var c=this;c.Wifi=a;var e=this.getAllBlocks();for(var b=0;b<e.length;b++){var d=e[b];if((d.type=="wifi_start")||(d.type=="wifi_stop")){d.wtype=a.wtype;d.ssid=a.ssid;d.password=a.password}}};Blockly.Workspace.prototype.configureMQTT=function(a){var c=this;c.MQTT=a;var e=this.getAllBlocks();for(var b=0;b<e.length;b++){var d=e[b];if((d.type=="mqtt_publish")||(d.type=="mqtt_subscribe")){d.clientid=a.clientid;d.host=a.host;d.port=a.port;d.secure=a.secure;d.username=a.username;d.password=a.password}}};Blockly.Workspace.prototype.removeSensor=function(c){var a=this.sensorIndexOf(c.name);this.sensors.names.splice(a,1);this.sensors.provides.splice(a,1);this.sensors.properties.splice(a,1);this.sensors.setup.splice(a,1);this.toolbox_.refreshSelection();var d=this.getAllBlocks();for(var b=0;b<d.length;b++){if((d[b].type=="sensor_attach")||(d[b].type=="sensor_read")||(d[b].type=="sensor_set")){if(d[b].name==c.name){d[b].dispose(true)}}}};Blockly.BlockSvg.prototype.addError=function(){Blockly.utils.addClass((this.svgGroup_),"blocklyError");var b=this;do{var a=b.getSvgRoot();a.parentNode.appendChild(a);b=b.getParent()}while(b)};Blockly.BlockSvg.prototype.removeError=function(){Blockly.utils.removeClass((this.svgGroup_),"blocklyError")};Blockly.BlockSvg.prototype.addStart=function(){Blockly.utils.addClass((this.svgGroup_),"blocklyStarted");var b=this;do{var a=b.getSvgRoot();a.parentNode.appendChild(a);b=b.getParent()}while(b)};Blockly.BlockSvg.prototype.removeStart=function(){Blockly.utils.removeClass((this.svgGroup_),"blocklyStarted")};Blockly.Css.CONTENT.push(".blocklyStarted>.blocklyPath {","stroke: #00c800;","stroke-width: 4px;","}");Blockly.Css.CONTENT.push(".blocklyStarted>.blocklyPathLight {","display: none;","}");Blockly.Css.CONTENT.push(".blocklyError>.blocklyPath {","stroke: #ff0000;","stroke-width: 4px;","}");Blockly.Css.CONTENT.push(".blocklyError>.blocklyPathLight {","display: none;","}");Blockly.BlockSvg.prototype.updateColour=function(){if(this.disabled){return}var k=this.getColour();var d=goog.color.hexToRgb(k);if(this.isShadow()){k=goog.color.rgbArrayToHex(d);this.svgPathLight_.style.display="none";this.svgPathDark_.setAttribute("fill",k)}else{this.svgPathLight_.style.display="";var a=goog.color.rgbArrayToHex(goog.color.lighten(d,0.3));var b=goog.color.rgbArrayToHex(goog.color.darken(d,0.2));this.svgPathLight_.setAttribute("stroke",a);this.svgPathDark_.setAttribute("fill",b)}this.svgPath_.setAttribute("fill",k);var j=this.getIcons();for(var c=0;c<j.length;c++){j[c].updateColour()}for(var h=0,g;g=this.inputList[h];h++){for(var e=0,f;f=g.fieldRow[e];e++){f.setText(null)}}};Blockly.WorkspaceSvg.prototype.removeErrors=function(){var b=this.getAllBlocks();for(var a=0;a<b.length;a++){b[a].removeError();b[a].setWarningText(null)}};Blockly.WorkspaceSvg.prototype.removeStarts=function(){var b=this.getAllBlocks();for(var a=0;a<b.length;a++){b[a].removeStart()}};Blockly.Workspace.prototype.migratePinField=function(d){var b=d.childNodes.length;for(var c=0;c<b;c++){var e=d.childNodes[c];var a=e.nodeName.toLowerCase();if(a=="field"){var j=e.getAttribute("name");if(j=="PIN"){var g=goog.dom.createDom("value");g.setAttribute("name","PIN");var h=goog.dom.createDom("shadow");h.setAttribute("type","output_digital_pin");var f=goog.dom.createDom("field");f.setAttribute("name","PIN");f.innerText=e.innerText;h.appendChild(f);g.appendChild(h);d.childNodes[c].outerHTML=g.outerHTML}}}return d};Blockly.Workspace.prototype.migrateTimeField=function(d){var b=d.childNodes.length;for(var c=0;c<b;c++){var e=d.childNodes[c];var a=e.nodeName.toLowerCase();if(a=="field"){var j=e.getAttribute("name");if(j=="time"){var g=goog.dom.createDom("value");g.setAttribute("name","TIME");var h=goog.dom.createDom("shadow");h.setAttribute("type","math_number");var f=goog.dom.createDom("field");f.setAttribute("name","NUM");f.innerText=e.innerText;h.appendChild(f);g.appendChild(h);d.childNodes[c].outerHTML=g.outerHTML}}}return d};Blockly.Workspace.prototype.migrateMutation=function(c){var a=c.childNodes.length;for(var d=0;d<a;d++){var e=c.childNodes[d];var b=e.nodeName.toLowerCase();if(b=="mutation"){if(e.getAttribute("pin")||e.getAttribute("device")||e.getAttribute("unit")){if(e.getAttribute("interface")=="ADC"){if(!e.getAttribute("unit")){e.setAttribute("interface0_unit",1);e.setAttribute("interface0_subunit",e.getAttribute("pin"));e.setAttribute("interface0_device",e.getAttribute("device"))}else{if(!e.getAttribute("unit")){e.setAttribute("unit",1)}e.setAttribute("interface0_unit",e.getAttribute("unit"));e.setAttribute("interface0_subunit",e.getAttribute("pin"));e.setAttribute("interface0_device",e.getAttribute("device"))}}else{if(!e.getAttribute("unit")){e.setAttribute("unit",1)}e.setAttribute("interface0_unit",e.getAttribute("pin"));e.setAttribute("interface0_subunit",e.getAttribute("unit"));e.setAttribute("interface0_device",e.getAttribute("device"))}e.removeAttribute("pin");e.removeAttribute("unit");e.removeAttribute("device")}}}return c};Blockly.Workspace.prototype.migrate=function(c){var a=c.childNodes.length;for(var d=0;d<a;d++){var f=c.childNodes[d];var b=f.nodeName.toLowerCase();var e="";if(typeof f.getAttribute=="function"){e=f.getAttribute("type")}if((e=="setdigitalpin")||(e=="getdigitalpin")||(e=="getanalogpin")||(e=="setpwmpin")||(e=="when_digital_pin")||(e=="servo_move")){f=this.migratePinField(f);f=this.migrate(f)}else{if(e=="wait_for"){f=this.migrateTimeField(f);f=this.migrate(f)}else{if((e=="sensor_read")||(e=="sensor_set")||(e=="sensor_when")){f=this.migrateMutation(f);f=this.migrate(f)}else{f=this.migrate(f)}}}}return c};Blockly.Workspace.prototype.clear=function(){var a=Blockly.Events.getGroup();if(!a){Blockly.Events.setGroup(true)}while(this.topBlocks_.length){this.topBlocks_[0].dispose()}if(!a){Blockly.Events.setGroup(false)}this.variableList.length=0;this.lora=undefined;this.Wifi=undefined;this.MQTT=undefined;this.sensors=undefined;this.events=undefined;this.canFrames=undefined;this.wcInit()};"use strict";goog.provide("Blockly.Sensors");goog.require("Blockly.Blocks");goog.require("Blockly.Workspace");goog.require("goog.string");goog.require("Blockly.Blocks.io.helper");Blockly.Sensors.NAME_TYPE="SENSOR";Blockly.Sensors.flyoutCategory=function(a){var c=[];var d=a.sensors;var b=goog.dom.createDom("button");b.setAttribute("text",Blockly.Msg.NEW_SENSOR);b.setAttribute("callbackKey","CREATE_SENSOR");a.registerButtonCallback("CREATE_SENSOR",function(e){Blockly.Sensors.createSensor(e.getTargetWorkspace())});c.push(b);d.names.forEach(function(f,k){if(Blockly.Blocks.sensor_attach&&(Code.blockAbstraction==blockAbstraction.Low)){var g=goog.dom.createDom("mutation","");g.setAttribute("interface",d.setup[k]["interface"]);g.setAttribute("sid",d.setup[k].id);g.setAttribute("name",f);for(var j=0;j<d.setup[k]["interface"].split(",").length;j++){g.setAttribute("interface"+j+"_unit",d.setup[k]["interface"+j+"_unit"]);g.setAttribute("interface"+j+"_subunit",d.setup[k]["interface"+j+"_subunit"]);g.setAttribute("interface"+j+"_device",d.setup[k]["interface"+j+"_device"])}var h=goog.dom.createDom("block");h.setAttribute("type","sensor_attach");var m=d.setup[k].id;if(typeof Blockly.Msg[m]!="undefined"){m=Blockly.Msg[m]}var l=goog.dom.createDom("field",null,Blockly.Msg.SENSOR_ACQUIRE.replace("%1",f).replace("%2",m));l.setAttribute("name","NAME");h.appendChild(l);h.appendChild(g);c.push(h)}if(Blockly.Blocks.sensor_when){var e=false;Code.status.sensors.forEach(function(p,i){if(p.id==d.setup[k].id){d.setup.forEach(function(q,r){if(p.id==q.id){if(typeof p.callback=="string"){e=(p.callback=="true")}else{e=p.callback}}})}});if(e){var g=goog.dom.createDom("mutation","");g.setAttribute("interface",d.setup[k]["interface"]);g.setAttribute("sid",d.setup[k].id);g.setAttribute("name",f);for(var j=0;j<d.setup[k]["interface"].split(",").length;j++){g.setAttribute("interface"+j+"_unit",d.setup[k]["interface"+j+"_unit"]);g.setAttribute("interface"+j+"_subunit",d.setup[k]["interface"+j+"_subunit"]);g.setAttribute("interface"+j+"_device",d.setup[k]["interface"+j+"_device"])}var h=goog.dom.createDom("block");h.setAttribute("type","sensor_when");var m=d.setup[k].id;if(typeof Blockly.Msg[m]!="undefined"){m=Blockly.Msg[m]}var l=goog.dom.createDom("field",null,Blockly.Msg.SENSOR_WHEN2.replace("%1",f).replace("%2",m));l.setAttribute("name","NAME");h.appendChild(l);var l=goog.dom.createDom("field",null,a.sensors.provides[k][0].id);l.setAttribute("name","PROVIDES");h.appendChild(l);h.appendChild(l);h.appendChild(g);c.push(h)}}if(Blockly.Blocks.sensor_read){var g=goog.dom.createDom("mutation","");g.setAttribute("interface",d.setup[k]["interface"]);g.setAttribute("sid",d.setup[k].id);g.setAttribute("name",f);for(var j=0;j<d.setup[k]["interface"].split(",").length;j++){g.setAttribute("interface"+j+"_unit",d.setup[k]["interface"+j+"_unit"]);g.setAttribute("interface"+j+"_subunit",d.setup[k]["interface"+j+"_subunit"]);g.setAttribute("interface"+j+"_device",d.setup[k]["interface"+j+"_device"])}var h=goog.dom.createDom("block");h.setAttribute("type","sensor_read");var m=d.setup[k].id;if(typeof Blockly.Msg[m]!="undefined"){m=Blockly.Msg[m]}var l=goog.dom.createDom("field",null,Blockly.Msg.SENSOR_READ2.replace("%1",f).replace("%2",m));l.setAttribute("name","NAME");h.appendChild(l);var l=goog.dom.createDom("field",null,a.sensors.provides[k][0].id);l.setAttribute("name","PROVIDES");h.appendChild(l);h.appendChild(l);h.appendChild(g);c.push(h)}if(Blockly.Blocks.sensor_set&&(a.sensors.properties[k].length>0)){var g=goog.dom.createDom("mutation","");g.setAttribute("interface",d.setup[k]["interface"]);g.setAttribute("sid",d.setup[k].id);g.setAttribute("name",f);for(var j=0;j<d.setup[k]["interface"].split(",").length;j++){g.setAttribute("interface"+j+"_unit",d.setup[k]["interface"+j+"_unit"]);g.setAttribute("interface"+j+"_subunit",d.setup[k]["interface"+j+"_subunit"]);g.setAttribute("interface"+j+"_device",d.setup[k]["interface"+j+"_device"])}var h=goog.dom.createDom("block");h.setAttribute("type","sensor_set");var m=d.setup[k].id;if(typeof Blockly.Msg[m]!="undefined"){m=Blockly.Msg[m]}var l=goog.dom.createDom("field",null,Blockly.Msg.SENSOR_SET3.replace("%1",f).replace("%2",m));l.setAttribute("name","NAME");h.appendChild(l);var l=goog.dom.createDom("field",null,a.sensors.properties[k][0].id);l.setAttribute("name","PROPERTIES");h.appendChild(l);var l=goog.dom.createDom("field",null,"0");l.setAttribute("name","NUM");var o=goog.dom.createDom("shadow",null,l);o.setAttribute("type","math_number");var n=goog.dom.createDom("value",null,o);n.setAttribute("name","VALUE");h.appendChild(n);h.appendChild(l);h.appendChild(g);c.push(h)}});return c};Blockly.Sensors.categoryChanged=function(){var d=this;var c=jQuery("#sensor_form");var a=c.find("#cat").find(":selected").attr("value");if(a==Blockly.Msg.NEW_SENSOR_SELECT_ONE){a=""}c.find(".id").hide();c.find(".sensor_name").hide();c.find(".sensor_interfaces").html("");if(a=="other"){var b='<option data-interface="" value="">'+Blockly.Msg.NEW_SENSOR_SELECT_ONE+"</option>";Code.status.sensors.forEach(function(g){var f=true;d.currentWS.allSensors.sensors.forEach(function(h){if(h.id==g.id){f=false}});if(f){var e=g.id;if(typeof Blockly.Msg[e]!="undefined"){e=Blockly.Msg[e]}b+='<option data-interface="'+g["interface"]+'" value="'+g.id+'">'+e+"</option>"}});c.find("#id").html(b);c.find(".id").show()}else{d.currentWS.allSensors.categories.forEach(function(f){if(f.id==a){var e='<option data-interface="" value="">'+Blockly.Msg.NEW_SENSOR_SELECT_ONE+"</option>";f.sensors.forEach(function(h){var g=null;Code.status.sensors.forEach(function(j){if(j.id==h.id){g=j}});if(g){var i=g.id;if(i.match(/^\d/)){i="S"+i}if(typeof Blockly.Msg[i]!="undefined"){i=Blockly.Msg[i]}else{i=g.id}e+='<option data-interface="'+g["interface"]+'" value="'+g.id+'">'+i+"</option>"}});c.find("#id").html(e);c.find(".id").show()}})}};Blockly.Sensors.InterfaceName=function(c,a){var b="";Code.status.sensors.forEach(function(f,d){if(f.id==c){if(typeof f.interface_name!="undefined"){var e=f.interface_name.split(",")[a];if((typeof e!="undefined")&&(e!="")){b=Blockly.Msg.SENSOR_INT_ATTACHED.replace("%1",e)}else{b=Blockly.Msg.SENSOR_INT_ATTACHED.replace("%1",Blockly.Msg.SENSOR)}}else{b=Blockly.Msg.SENSOR_INT_ATTACHED.replace("%1",Blockly.Msg.SENSOR)}}});return b};Blockly.Sensors.GPIOSelection=function(g,b,f,h){var d="";var c=[];var a="";for(var i in Code.status.maps.digitalPins){c.push([Code.status.maps.digitalPins[i][3]+" - "+Code.status.maps.digitalPins[i][0].replace(/pio\.P/i,"").replace(/_/i,""),i])}var a='<select id="interface'+g+'_unit" name="interface'+g+'_unit">';c.forEach(function(j){a+="<option "+((h&&(j[1]==f["interface"+g+"_unit"]))?"selected":"")+' value="'+j[1]+'">'+j[0]+"</option>"});a+="</select>";var e=Blockly.Sensors.InterfaceName(b,g);if(h){d+="<div>";d+='<label for="gpio">'+e+":&nbsp;&nbsp;</label>"+a;d+="</div>"}else{d+='<div id="GPIO_sensor">';d+='<label for="gpio">'+e+":&nbsp;&nbsp;</label>"+a;d+="</div>"}return d};Blockly.Sensors.I2CSelection=function(g,a,f,h){var c="";var b=[];var d="";for(var i in Code.status.maps.i2cUnits){b.push([Code.status.maps.i2cUnits[i][0],i])}var d='<select id="interface'+g+'_unit" name="interface'+g+'_unit">';b.forEach(function(j){d+="<option "+((h&&(j[1]==f["interface"+g+"_unit"]))?"selected":"")+' value="'+j[1]+'">'+j[0]+"</option>"});d+="</select>";var e=Blockly.Sensors.InterfaceName(a,g);if(h){c+="<div>";c+='<label for="i2c">'+e+":&nbsp;&nbsp;</label>"+d;c+="</div>"}else{c+='<div id="I2C_sensor">';c+='<label for="i2c">'+e+":&nbsp;&nbsp;</label>"+d;c+="</div>"}return c};Blockly.Sensors.UARTSelection=function(f,a,d,g){var b="";var h=[];var e="";for(var i in Code.status.maps.uartUnits){h.push([Code.status.maps.uartUnits[i][0],i])}var e='<select id="interface'+f+'_unit" name="interface'+f+'_unit">';h.forEach(function(j){e+="<option "+((g&&(j[1]==d["interface"+f+"_unit"]))?"selected":"")+' value="'+j[1]+'">'+j[0]+"</option>"});e+="</select>";var c=Blockly.Sensors.InterfaceName(a,f);if(g){b+="<div>";b+='<label for="uart">'+c+":&nbsp;&nbsp;</label>"+e;b+="</div>"}else{b+='<div id="UART_sensor">';b+='<label for="uart">'+c+":&nbsp;&nbsp;</label>"+e;b+="</div>"}return b};Blockly.Sensors.ONEWIRESelection=function(f,a,e,h){var c="";var b=[];var g=[];var g="";for(var i in Code.status.maps.digitalPins){b.push([Code.status.maps.digitalPins[i][3]+" - "+Code.status.maps.digitalPins[i][0].replace(/pio\.P/i,"").replace(/_/i,""),i])}var g='<select id="interface'+f+'_unit" name="interface'+f+'_unit">';b.forEach(function(j){g+="<option "+((h&&(j[1]==e["interface"+f+"_unit"]))?"selected":"")+' value="'+j[1]+'">'+j[0]+"</option>"});g+="</select>";var d=Blockly.Sensors.InterfaceName(a,f);if(h){c+="<div>";c+='<label for="1-wire">'+d+":&nbsp;&nbsp;</label>"+g;c+='<br><label for="device">'+Blockly.Msg.SENSOR_DEVICE_ID+":&nbsp;&nbsp;</label>";c+='<input type="text" value="'+e["interface"+f+"_device"]+'" name="interface'+f+'_device" id="interface'+f+'_device">';c+="</div>"}else{c+='<div id="1-WIRE_sensor">';c+='<label for="1-wire">'+d+":&nbsp;&nbsp;</label>"+g;c+='<br><label for="device">'+Blockly.Msg.SENSOR_DEVICE_ID+":&nbsp;&nbsp;</label>";c+='<input type="text" value="1" name="interface'+f+'_device" id="interface'+f+'_device">';c+="</div>"}return c};Blockly.Sensors.ADCSelection=function(h,a,f,j){var b="";var l=[];var m="";l.push(["ADC1","ADC1",8,1]);for(var k in Code.status.maps.externalAdcUnits){l.push([Code.status.maps.externalAdcUnits[k][0],Code.status.maps.externalAdcUnits[k][0],Code.status.maps.externalAdcUnits[k][1],k])}var m='<select id="interface'+h+'_unit" name="interface'+h+'_unit" onchange="Blockly.Sensors.adcUnitChanged('+h+')">';l.forEach(function(i){m+="<option "+((j&&(i[3]==f["interface"+h+"_unit"]))?"selected":"")+' value="'+i[3]+'">'+i[0]+"</option>"});m+="</select>";var e=[];var c="";var l=1;var g;if(j){l=f["interface"+h+"_unit"]}if(l==1){for(var k in Code.status.maps.analogPins){e.push([Code.status.maps.analogPins[k][1]+" - "+Code.status.maps.analogPins[k][0].replace(/pio\.P/i,"").replace(/_/i,""),k])}}else{for(g=0;g<Code.status.maps.externalAdcUnits[l][1];g++){e.push(["channel%1".replace("%1",String(g)),g.toString()])}}var c='<select id="interface'+h+'_subunit" name="interface'+h+'_subunit">';e.forEach(function(i){c+="<option "+((j&&(i[1]==f["interface"+h+"_subunit"]))?"selected":"")+' value="'+i[1]+'">'+i[0]+"</option>"});c+="</select>";var d=Blockly.Sensors.InterfaceName(a,h);if(j){b+="<div>";b+='<label for="adc">'+d+":&nbsp;&nbsp;</label>"+m+"&nbsp;&nbsp;"+c;b+="</div>"}else{b+='<div class="sensor_interface" id="ADC_sensor">';b+='<label for="adc">'+d+":&nbsp;&nbsp;</label>"+m+"&nbsp;&nbsp;"+c;b+="</div>"}return b};Blockly.Sensors.sensorChanged=function(d,b){var a=jQuery("#sensor_form");var e;if(b){e=a.find("#id").attr("value")}else{e=a.find("#id").find(":selected").attr("value")}if(e==Blockly.Msg.NEW_SENSOR_SELECT_ONE){e=""}var c;if(b){c=a.find("#id").data("interface").split(",")}else{c=a.find("#id").find(":selected").data("interface").split(",")}a.find(".sensor_interfaces").html("");c.forEach(function(h,g){var f="";if(h=="GPIO"){f=Blockly.Sensors.GPIOSelection(g,e,d,b)}else{if(h=="I2C"){f=Blockly.Sensors.I2CSelection(g,e,d,b)}else{if(h=="UART"){f=Blockly.Sensors.UARTSelection(g,e,d,b)}else{if(h=="1-WIRE"){f=Blockly.Sensors.ONEWIRESelection(g,e,d,b)}else{if(h=="ADC"){f=Blockly.Sensors.ADCSelection(g,e,d,b)}}}}}a.find(".sensor_interfaces").append(f)});if((e!="")&&(c!="")){a.find(".sensor_name").show()}else{a.find(".sensor_name").hide()}};Blockly.Sensors.adcUnitChanged=function(c){var a=[];var e;var g=jQuery("#sensor_form");var f=g.find("#interface"+c+"_unit").find(":selected").attr("value");if(f==1){for(var d in Code.status.maps.analogPins){a.push([Code.status.maps.analogPins[d][1]+" - "+Code.status.maps.analogPins[d][0].replace(/pio\.P/i,"").replace(/_/i,""),d])}}else{for(e=0;e<Code.status.maps.externalAdcUnits[f][1];e++){a.push(["channel%1".replace("%1",String(e)),e.toString()])}}var b="";a.forEach(function(h){b+='<option value="'+h[1]+'">'+h[0]+"</option>"});g.find("#interface"+c+"_subunit").html(b)};Blockly.Sensors.createSetupStructure=function(d,e){var a={};if((typeof e=="undefined")||(d)){var c=jQuery("#sensor_form");var f=c.find("#id").find(":selected").attr("value");if(f==Blockly.Msg.NEW_SENSOR_SELECT_ONE){f=""}a.id=f;a.name=c.find("#sensor_name").val();if(d){a["interface"]=c.find("#id").data("interface")}else{a["interface"]=c.find("#id").find(":selected").data("interface")}for(var b=0;b<a["interface"].split(",").length;b++){a["interface"+b+"_unit"]=c.find("#interface"+b+"_unit").val();a["interface"+b+"_subunit"]=c.find("#interface"+b+"_subunit").val();a["interface"+b+"_device"]=c.find("#interface"+b+"_device").val()}}else{a.id=e.sid;a.name=e.name;a["interface"]=e["interface"];for(var b=0;b<e["interface"].split(",").length;b++){a["interface"+b+"_unit"]=e["interface"+b+"_unit"];a["interface"+b+"_subunit"]=e["interface"+b+"_subunit"];a["interface"+b+"_device"]=e["interface"+b+"_device"]}}return a};Blockly.Sensors.createSensor=function(b,a,e){var g="";var c=false;this.currentWS=b;if(typeof e!="undefined"){c=true}if(Code.status.sensors.length==0){Code.showError(MSG.error,MSG.attachBoardForUseThisOption,function(){});return}if(c){var d=""}else{var d='<select onchange="Blockly.Sensors.categoryChanged()" id="cat" name="cat">';d+='<option data-interface="" value="">'+Blockly.Msg.NEW_SENSOR_SELECT_ONE+"</option>";b.allSensors.categories.forEach(function(h){d+='<option value="'+h.id+'">'+Blockly.Msg[h.id]+"</option>"});d+='<option data-interface="" value="other">'+Blockly.Msg.other+"</option>";d+="</select>"}if(c){f="<span>"+e.sid+"</span>";f+='<input type="hidden" id="id" name="id" value="'+e.sid+'" data-interface="'+e["interface"]+'"></input>'}else{var f='<select onchange="Blockly.Sensors.sensorChanged('+e+", "+c+')" id="id" name="id">';f+='<option data-interface="" value="">'+Blockly.Msg.NEW_SENSOR_SELECT_ONE+"</option>";f+="</select>"}g='<form id="sensor_form">';if(d!=""){g+='<label for="id">'+Blockly.Msg.SENSOR_CATEGORY+":&nbsp;&nbsp;</label>"+d+"<br>";g+='<div class="id" style="display: none;">';g+='<label for="id">'+Blockly.Msg.SENSOR+":&nbsp;&nbsp;</label>"+f;g+="</div>"}else{g+='<div class="id">';g+='<label for="id">'+Blockly.Msg.SENSOR+":&nbsp;&nbsp;</label>"+f;g+="</div>"}if(c){g+="<div>";g+='<label for="sensor_name">'+Blockly.Msg.SENSOR_NAME+":&nbsp;&nbsp;</label>";g+='<input id="sensor_name" name="sensor_name" value="'+e.name+'">';g+="</div>"}else{g+='<div class="sensor_name" style="display: none;">';g+='<label for="sensor_name">'+Blockly.Msg.SENSOR_NAME+":&nbsp;&nbsp;</label>";g+='<input id="sensor_name" name="sensor_name" value="'+Blockly.Msg.SENSOR_DEFAULT_NAME+b.sensors.names.length+'">';g+="</div>"}g+='<div class="sensor_interfaces"';g+="</div>";g+="</form>";bootbox.dialog({title:c?Blockly.Msg.EDIT_SENSOR_TITLE:Blockly.Msg.NEW_SENSOR_TITLE,message:g,buttons:{main:{label:c?Blockly.Msg.UPDATE:Blockly.Msg.SENSOR_CREATE,classensor:"btn-primary",callback:function(){var h=jQuery("#sensor_form");var k;if(c){k=h.find("#id").val()}else{k=h.find("#id").find(":selected").attr("value");if(k==Blockly.Msg.NEW_SENSOR_SELECT_ONE){k=""}}var j=h.find("#sensor_name").val();if((b.sensorIndexOf(j)==-1)||(c&&e.name==j)){var i;if(c){i=h.find("#id").data("interface")}else{i=h.find("#id").find(":selected").data("interface")}if((j!="")&&(i!="")){b.createSensor(c?e.name:undefined,Blockly.Sensors.createSetupStructure(c,e));b.toolbox_.refreshSelection()}else{return false}}else{Code.showError(Blockly.Msg.ERROR,Blockly.Msg.SENSOR_ALREADY_EXISTS.replace("%1",j),function(){})}}},danger:{label:Blockly.Msg.SENSOR_CANCEL,classensor:"btn-danger",callback:function(){}}},closable:false,onEscape:true}).on("shown.bs.modal",function(h){Blockly.Sensors.sensorChanged(e,c)})};Blockly.Sensors.edit=function(a){Blockly.Sensors.createSensor(a.workspace,null,a)};Blockly.Sensors.remove=function(a){bootbox.confirm({message:Blockly.Msg.SENSOR_REMOVE_CONFIRM.replace("%1",a.name+" - "+a.sid),buttons:{confirm:{label:Blockly.Msg.YES,className:"btn-success"},cancel:{label:Blockly.Msg.NO,className:"btn-danger"}},callback:function(b){if(b){a.workspace.removeSensor(a)}}})};"use strict";goog.provide("Blockly.Wifi");goog.require("Blockly.Blocks");goog.require("Blockly.Workspace");goog.require("goog.string");Blockly.Wifi.NAME_TYPE="WIFI";Blockly.Wifi.flyoutCategory=function(c){var e=[];var a=c.Wifi;var d=goog.dom.createDom("button");d.setAttribute("text",Blockly.Msg.CONFIGURE_WIFI);d.setAttribute("callbackKey","CONFIGURE_WIFI");c.registerButtonCallback("CONFIGURE_WIFI",function(g){Blockly.Wifi.configure(g.getTargetWorkspace())});e.push(d);if(Blockly.Blocks.wifi_start){var b=goog.dom.createDom("mutation","");b.setAttribute("wtype",a.wtype);b.setAttribute("ssid",a.ssid);b.setAttribute("password",a.password);var f=goog.dom.createDom("block");f.setAttribute("type","wifi_start");f.appendChild(b);e.push(f)}if(Blockly.Blocks.wifi_stop){var b=goog.dom.createDom("mutation","");b.setAttribute("wtype",a.wtype);b.setAttribute("ssid",a.ssid);b.setAttribute("password",a.password);var f=goog.dom.createDom("block");f.setAttribute("type","wifi_stop");f.appendChild(b);e.push(f)}return e};Blockly.Wifi.configure=function(c,b,f){var g="";var e=false;if(typeof f!="undefined"){e=true}var a='<select id="type" name="type" onchange="Blockly.Wifi.wtypeChanged()">';a+='<option data-type="STA" '+(c.Wifi.wtype=="STA"?"selected":"")+' value="STA">STATION</option>';a+="</select>";g='<form id="Wifi_form">';g+="<div>";g+='<label for="type">'+Blockly.Msg.WIFI_TYPE+":&nbsp;&nbsp;</label>"+a;g+="</div>";g+="<div><br>";g+='<div id="STA" style="display: none;">';g+="<div>";g+='<label for="ssid">SSID:&nbsp;&nbsp;</label><input id="ssid" name="ssid" style="width:300px;" value="'+c.Wifi.ssid+'">';g+="</div>";g+="<div>";g+='<label for="password">PASSWORD:&nbsp;&nbsp;</label><input type="password" id="password" name="password" style="width:300px;" value="'+c.Wifi.password+'">';g+="</div>";g+='<div id="AP" style="display: none;">';g+="</div>";g+='<span class="error-msg" id="errors"></span>';g+="</form>";var d=bootbox.dialog({title:Blockly.Msg.WIFI_CONFIG_TITLE,message:g,buttons:{main:{label:Blockly.Msg.CONFIGURE,classensor:"btn-primary",callback:function(){var k=jQuery("#Wifi_form");var j=k.find("#type").find(":selected").attr("value");var l=k.find("#ssid").val().trim();var i=k.find("#password").val().trim();var h=false;k.find("#errors").html("");if(j=="STA"){if(l==""){k.find("#errors").html(k.find("#errors").html()+"<br>"+Blockly.Msg.WIFI_INVALID.replace("%1","SSID"));h=true}if(i==""){k.find("#errors").html(k.find("#errors").html()+"<br>"+Blockly.Msg.WIFI_INVALID.replace("%1","PASSWORD"));h=true}}else{}if(h){return false}c.configureWifi({wtype:j,ssid:l,password:i});c.toolbox_.refreshSelection()}},danger:{label:Blockly.Msg.CANCEL,classensor:"btn-danger",callback:function(){}}},closable:false,onEscape:true});d.bind("shown.bs.modal",function(){jQuery(":checkbox").checkboxpicker({html:true,offLabel:'<span class="glyphicon glyphicon-remove">',onLabel:'<span class="glyphicon glyphicon-ok">'}).on("change",function(){var h=jQuery("#Wifi_form");h.find("#ssid").val(this.checked)}).prop("checked",c.Wifi.ssid=="true");Blockly.Wifi.wtypeChanged()})};Blockly.Wifi.wtypeChanged=function(){var b=jQuery("#Wifi_form");var a=b.find("#type").find(":selected").attr("value");if(a=="STA"){b.find("#STA").show();b.find("#AP").hide()}else{b.find("#STA").hide();b.find("#AP").show()}};"use strict";goog.provide("Blockly.MQTT");goog.require("Blockly.Blocks");goog.require("Blockly.Workspace");goog.require("goog.string");Blockly.MQTT.NAME_TYPE="MQTT";Blockly.MQTT.flyoutCategory=function(b){var a=[];var f=b.MQTT;var e=goog.dom.createDom("button");e.setAttribute("text",Blockly.Msg.CONFIGURE_MQTT);e.setAttribute("callbackKey","CONFIGURE_MQTT");b.registerButtonCallback("CONFIGURE_MQTT",function(j){Blockly.MQTT.configure(j.getTargetWorkspace())});a.push(e);if(Blockly.Blocks.mqtt_subscribe){var c=goog.dom.createDom("mutation","");c.setAttribute("clientid",f.clientid);c.setAttribute("host",f.host);c.setAttribute("port",f.port);c.setAttribute("secure",f.secure);c.setAttribute("username",f.username);c.setAttribute("password",f.password);var d=goog.dom.createDom("block");d.setAttribute("type","mqtt_subscribe");var g=goog.dom.createDom("field",null,"");g.setAttribute("name","TEXT");var i=goog.dom.createDom("shadow");i.setAttribute("type","text");i.appendChild(g);var h=goog.dom.createDom("value");h.setAttribute("name","TOPIC");h.appendChild(i);d.appendChild(h);d.appendChild(c);a.push(d)}if(Blockly.Blocks.mqtt_publish){var c=goog.dom.createDom("mutation","");c.setAttribute("clientid",f.clientid);c.setAttribute("host",f.host);c.setAttribute("port",f.port);c.setAttribute("secure",f.secure);c.setAttribute("username",f.username);c.setAttribute("password",f.password);var d=goog.dom.createDom("block");d.setAttribute("type","mqtt_publish");var g=goog.dom.createDom("field",null,"");g.setAttribute("name","TEXT");var i=goog.dom.createDom("shadow");i.setAttribute("type","text");i.appendChild(g);var h=goog.dom.createDom("value");h.setAttribute("name","PAYLOAD");h.appendChild(i);d.appendChild(h);var g=goog.dom.createDom("field",null,"");g.setAttribute("name","TEXT");var i=goog.dom.createDom("shadow");i.setAttribute("type","text");i.appendChild(g);var h=goog.dom.createDom("value");h.setAttribute("name","TOPIC");h.appendChild(i);d.appendChild(h);d.appendChild(c);a.push(d)}return a};Blockly.MQTT.configure=function(b,a,e){var f="";var d=false;if(typeof e!="undefined"){d=true}f='<form id="MQTT_form">';f+='<label for="clientid">Client ID:&nbsp;&nbsp;</label><input id="clientid" name="clientid" style="width:300px;" value="'+b.MQTT.clientid+'">';f+="</div>";f+="<div>";f+='<label for="host">Host:&nbsp;&nbsp;</label><input type="text" id="host" name="host" style="width:300px;" value="'+b.MQTT.host+'">';f+="</div>";f+="<div>";f+='<label for="port">Port:&nbsp;&nbsp;</label><input type="text" id="port" name="port" style="width:100px;" value="'+b.MQTT.port+'">';f+="</div>";f+="<div>";f+='<label for="secure">Secure:&nbsp;&nbsp;</label><br>';f+='<input id="secure" name="secure" type="checkbox" data-group-cls="btn-group-sm" value="'+b.MQTT.secure+'">';f+="</div>";f+='<div id="credentials" style="display:none;"><br>';f+="<div>";f+='<label for="username">User:&nbsp;&nbsp;</label><input type="text" id="username" name="username" style="width:100px;" value="'+b.MQTT.username+'">';f+="</div>";f+="<div>";f+='<label for="password">Password:&nbsp;&nbsp;</label><input type="password" id="password" name="password" style="width:100px;" value="'+b.MQTT.password+'">';f+="</div>";f+="</div>";f+="</div>";f+="<br><span>"+Blockly.Msg.MQTT_GET_DATA_HELP+"</span><br>";f+='<br><button type="button" class="btn" id="getMQTTData">'+Blockly.Msg.MQTT_GET_DATA+'</button>&nbsp;<span id="waitingMQTT" class="waiting"><i class="spinner icon icon-spinner3"></i></span><br>';f+="</div>";f+='<span class="error-msg" id="errors"></span>';f+="</form>";var c=bootbox.dialog({title:Blockly.Msg.MQTT_CONFIG_TITLE,message:f,buttons:{main:{label:Blockly.Msg.CONFIGURE,classensor:"btn-primary",callback:function(){var k=jQuery("#MQTT_form");var m=k.find("#clientid").val().trim();var j=k.find("#host").val().trim();var g=k.find("#port").val().trim();var l=k.find("#secure").val();var n=k.find("#username").val().trim();var i=k.find("#password").val().trim();var h=false;k.find("#errors").html("");if(m==""){k.find("#errors").html(k.find("#errors").html()+"<br>"+Blockly.Msg.MQTT_INVALID.replace("%1","Client ID"));h=true}if(j==""){k.find("#errors").html(k.find("#errors").html()+"<br>"+Blockly.Msg.MQTT_INVALID.replace("%1","Host"));h=true}if((g=="")||(isNaN(g))){k.find("#errors").html(k.find("#errors").html()+"<br>"+Blockly.Msg.MQTT_INVALID.replace("%1","Port"));h=true}if(parseInt(g)<0){k.find("#errors").html(k.find("#errors").html()+"<br>"+Blockly.Msg.MQTT_INVALID.replace("%1","Port"));h=true}if(h){return false}b.configureMQTT({clientid:m,host:j,port:g,secure:l,username:n,password:i});b.toolbox_.refreshSelection()}},danger:{label:Blockly.Msg.CANCEL,classensor:"btn-danger",callback:function(){}}},closable:false,onEscape:true});c.bind("shown.bs.modal",function(){jQuery(":checkbox").checkboxpicker({html:true,offLabel:'<span class="glyphicon glyphicon-remove">',onLabel:'<span class="glyphicon glyphicon-ok">'}).on("change",function(){var h=jQuery("#MQTT_form");h.find("#secure").val(this.checked);if(this.checked){h.find("#credentials").show()}else{h.find("#credentials").hide()}}).prop("checked",b.MQTT.secure=="true");var g=jQuery("#MQTT_form");g.find("#getMQTTData").click(function(){jQuery("#waitingMQTT").show();jQuery.ajax({url:Code.server+"/?mqttRegister",type:"POST",success:function(h){jQuery("#waitingMQTT").hide();h=JSON.parse(h);if(h.success){jQuery(":checkbox").prop("checked",true);h=JSON.parse(h.result);g.find("#clientid").val("mqtt");g.find("#host").val("mqtt.whitecatboard.org");g.find("#port").val("8883");g.find("#username").val(h.user);g.find("#password").val(h.password)}else{g.find("#errors").html(h.result)}},error:function(){jQuery("#waitingMQTT").hide()}})})})};"use strict";goog.provide("Blockly.Lora");goog.require("Blockly.Blocks");goog.require("Blockly.Workspace");goog.require("goog.string");Blockly.Lora.NAME_TYPE="LORA";Blockly.Lora.flyoutCategory=function(c){var b=[];var a=c.lora;var f=goog.dom.createDom("button");f.setAttribute("text",Blockly.Msg.CONFIGURE_LORA);f.setAttribute("callbackKey","CONFIGURE_LORA");c.registerButtonCallback("CONFIGURE_LORA",function(j){Blockly.Lora.configure(j.getTargetWorkspace())});b.push(f);if(Blockly.Blocks.when_i_receive_a_lora_frame){var e=goog.dom.createDom("block");e.setAttribute("type","when_i_receive_a_lora_frame");b.push(e)}if(Blockly.Blocks.lora_join&&(c.lora.activation=="OTAA")){var d=goog.dom.createDom("mutation","");d.setAttribute("band",a.band);d.setAttribute("activation",a.activation);d.setAttribute("dr",a.dr);d.setAttribute("retx",a.retx);d.setAttribute("adr",a.adr);d.setAttribute("deveui",a.deveui);d.setAttribute("appeui",a.appeui);d.setAttribute("appkey",a.appkey);d.setAttribute("devaddr",a.devaddr);d.setAttribute("nwkskey",a.nwkskey);d.setAttribute("appskey",a.appskey);var e=goog.dom.createDom("block");e.setAttribute("type","lora_join");e.appendChild(d);b.push(e)}if(Blockly.Blocks.lora_tx){var d=goog.dom.createDom("mutation","");d.setAttribute("band",a.band);d.setAttribute("activation",a.activation);d.setAttribute("dr",a.dr);d.setAttribute("retx",a.retx);d.setAttribute("adr",a.adr);d.setAttribute("deveui",a.deveui);d.setAttribute("appeui",a.appeui);d.setAttribute("appkey",a.appkey);d.setAttribute("devaddr",a.devaddr);d.setAttribute("nwkskey",a.nwkskey);d.setAttribute("appskey",a.appskey);var e=goog.dom.createDom("block");e.setAttribute("type","lora_tx");var g=goog.dom.createDom("field",null,"1");g.setAttribute("name","NUM");var i=goog.dom.createDom("shadow");i.setAttribute("type","math_number");i.appendChild(g);var h=goog.dom.createDom("value");h.setAttribute("name","PORT");h.appendChild(i);e.appendChild(h);var g=goog.dom.createDom("field",null,"");g.setAttribute("name","TEXT");var g=goog.dom.createDom("field",null,"");g.setAttribute("name","TEXT");var i=goog.dom.createDom("shadow");i.setAttribute("type","text");i.appendChild(g);var h=goog.dom.createDom("value");h.setAttribute("name","PAYLOAD");h.appendChild(i);e.appendChild(h);e.appendChild(d);b.push(e)}return b};Blockly.Lora.configure=function(b,h,d){var c="";var i=false;if(typeof d!="undefined"){i=true}var a='<select id="band" name="band">';a+='<option data-band="868" '+(b.lora.band=="868"?"selected":"")+' value="868">868 (Europe) Mhz</option>';a+='<option data-band="433" '+(b.lora.band=="433"?"selected":"")+' value="433">433 (United States) Mhz</option>';a+="</select>";var j='<select id="activation" name="activation" onchange="Blockly.Lora.activationChanged()">';j+='<option data-band="ABP" '+(b.lora.activation=="ABP"?"selected":"")+' value="ABP">ABP</option>';j+='<option data-band="OTAA" '+(b.lora.activation=="OTAA"?"selected":"")+' value="OTAA">OTAA</option>';j+="</select>";var f='<select id="dr" name="dr">';f+='<option data-dr="0" '+(b.lora.dr=="0"?"selected":"")+' value="0">0</option>';f+='<option data-dr="1" '+(b.lora.dr=="1"?"selected":"")+' value="1">1</option>';f+='<option data-dr="2" '+(b.lora.dr=="2"?"selected":"")+' value="2">2</option>';f+='<option data-dr="3"'+(b.lora.dr=="3"?"selected":"")+' value="3">3</option>';f+='<option data-dr="4" '+(b.lora.dr=="4"?"selected":"")+' value="4">4</option>';f+='<option data-dr="5" '+(b.lora.dr=="5"?"selected":"")+' value="5">5</option>';f+='<option data-dr="6" '+(b.lora.dr=="6"?"selected":"")+' value="6">6</option>';f+='<option data-dr="7" '+(b.lora.dr=="7"?"selected":"")+' value="7">7</option>';f+="</select>";var g='<select id="retx" name="retx">';g+='<option data-retx="0" '+(b.lora.retx=="0"?"selected":"")+' value="0">0</option>';g+='<option data-retx="1" '+(b.lora.retx=="1"?"selected":"")+' value="1">1</option>';g+='<option data-retx="2" '+(b.lora.retx=="2"?"selected":"")+' value="2">2</option>';g+='<option data-retx="3" '+(b.lora.retx=="3"?"selected":"")+' value="3">3</option>';g+='<option data-retx="4" '+(b.lora.retx=="4"?"selected":"")+' value="4">4</option>';g+='<option data-retx="5" '+(b.lora.retx=="5"?"selected":"")+' value="5">5</option>';g+='<option data-retx="6" '+(b.lora.retx=="6"?"selected":"")+' value="6">6</option>';g+='<option data-retx="7" '+(b.lora.retx=="7"?"selected":"")+' value="7">7</option>';g+='<option data-retx="8" '+(b.lora.retx=="8"?"selected":"")+' value="8">8</option>';g+="</select>";c='<form id="lora_form">';c+="<div>";c+='<label for="band">'+Blockly.Msg.LORA_BAND+":&nbsp;&nbsp;</label>"+a;c+="</div>";c+="<div>";c+='<label for="activation">'+Blockly.Msg.LORA_ACTIVATION+":&nbsp;&nbsp;</label>"+j;c+="</div>";c+="<div>";c+='<label for="dr">'+Blockly.Msg.LORA_DR+":&nbsp;&nbsp;</label>"+f;c+="</div>";c+="<div>";c+='<label for="retx">'+Blockly.Msg.LORA_CONFIG_RETX+":&nbsp;&nbsp;</label>"+g;c+="</div>";c+="<div>";c+='<label for="adr">'+Blockly.Msg.LORA_ADR+":&nbsp;&nbsp;</label><br>";c+='<input id="adr" name="adr" type="checkbox" data-group-cls="btn-group-sm" value="'+b.lora.adr+'">';c+="</div>";c+="<div><br>";c+='<div id="OTAA" style="display: none;">';c+='<div style="margin: 0px;border-bottom: 1px solid #e5e5e5;">';c+="<label>"+Blockly.Msg.LORA_ACTIVATION_DATA+"&nbsp;&nbsp;</label>";c+="</div><br>";c+="<div>";c+='<label for="DevEUI">DevEUI:&nbsp;&nbsp;</label><input id="DevEUI" name="DevEUI" style="width:300px;" value="'+b.lora.deveui+'">';c+="</div>";c+="<div>";c+='<label for="AppEUI">AppEUI:&nbsp;&nbsp;</label><input id="AppEUI" name="AppEUI" style="width:300px;" value="'+b.lora.appeui+'">';c+="</div>";c+="<div>";c+='<label for="AppKey">AppKey:&nbsp;&nbsp;</label><input id="AppKey" name="AppKey" style="width:300px;" value="'+b.lora.appkey+'">';c+="</div>";c+="<br><span>"+Blockly.Msg.LORA_GET_OTAA_DATA_HELP+"</span><br>";c+='<br><button type="button" class="btn" id="getOTAAData">'+Blockly.Msg.LORA_GET_DATA+'</button>&nbsp;<span id="waitingOTAA" class="waiting"><i class="spinner icon icon-spinner3"></i></span><br>';c+="</div>";c+='<div id="ABP" style="display: none;">';c+='<div style="margin: 0px;border-bottom: 1px solid #e5e5e5;">';c+="<label>"+Blockly.Msg.LORA_PERSONALIZATION_DATA+"&nbsp;&nbsp;</label>";c+="</div><br>";c+="<div>";c+='<label for="DevAddr">DevAddr:&nbsp;&nbsp;</label><input id="DevAddr" name="DevAddr" style="width:300px;" value="'+b.lora.devaddr+'">';c+="</div>";c+="<div>";c+='<label for="NwkSKey">NwkSKey:&nbsp;&nbsp;</label><input id="NwkSKey" name="NwkSKey" style="width:300px;" value="'+b.lora.nwkskey+'">';c+="</div>";c+="<div>";c+='<label for="AppSKey">AppSKey:&nbsp;&nbsp;</label><input id="AppSKey" name="AppSKey" style="width:300px;" value="'+b.lora.appskey+'">';c+="</div>";c+="<br><span>"+Blockly.Msg.LORA_GET_ABP_DATA_HELP+"</span><br>";c+='<br><button type="button" class="btn" id="getABPData">'+Blockly.Msg.LORA_GET_DATA+'</button>&nbsp;<span id="waitingABP" class="waiting"><i class="spinner icon icon-spinner3"></i></span><br>';c+="</div>";c+='<span class="error-msg" id="errors"></span>';c+="</form>";var e=bootbox.dialog({title:Blockly.Msg.LORA_CONFIG_TITLE,message:c,buttons:{main:{label:Blockly.Msg.CONFIGURE,classensor:"btn-primary",callback:function(){var l=jQuery("#lora_form");var z=l.find("#band").find(":selected").attr("value");var t=l.find("#activation").find(":selected").attr("value");var o=l.find("#dr").find(":selected").attr("value");var u=l.find("#retx").find(":selected").attr("value");var p=l.find("#adr").val();var q=l.find("#DevEUI").val();var k=l.find("#AppEUI").val();var y=l.find("#AppKey").val();var s=l.find("#DevAddr").val();var w=l.find("#NwkSKey").val();var m=l.find("#AppSKey").val();var n=/[0-9A-Fa-f]{16}/;var x=/[0-9A-Fa-f]{32}/;var r=/[0-9A-Fa-f]{8}/;var v=false;l.find("#errors").html("");if(t=="OTAA"){if(!(n.test(q))){l.find("#errors").html(l.find("#errors").html()+"<br>"+Blockly.Msg.LORA_INVALID.replace("%1","DevEUI"));v=true}if(!(n.test(k))){l.find("#errors").html(l.find("#errors").html()+"<br>"+Blockly.Msg.LORA_INVALID.replace("%1","AppEUI"));v=true}if(!(x.test(y))){l.find("#errors").html(l.find("#errors").html()+"<br>"+Blockly.Msg.LORA_INVALID.replace("%1","AppKey"));v=true}}else{if(!(r.test(s))){l.find("#errors").html(l.find("#errors").html()+"<br>"+Blockly.Msg.LORA_INVALID.replace("%1","DevAddr"));v=true}if(!(x.test(w))){l.find("#errors").html(l.find("#errors").html()+"<br>"+Blockly.Msg.LORA_INVALID.replace("%1","NwkSKey"));v=true}if(!(x.test(m))){l.find("#errors").html(l.find("#errors").html()+"<br>"+Blockly.Msg.LORA_INVALID.replace("%1","AppSKey"));v=true}}if(v){return false}b.configureLora({band:z,activation:t,dr:o,retx:u,adr:p,deveui:q,appeui:k,appkey:y,devaddr:s,nwkskey:w,appskey:m});b.toolbox_.refreshSelection()}},danger:{label:Blockly.Msg.CANCEL,classensor:"btn-danger",callback:function(){}}},closable:false});e.bind("shown.bs.modal",function(){var k=jQuery("#lora_form");k.find("#getOTAAData").click(function(){jQuery("#waitingOTAA").show();jQuery.ajax({url:Code.server+"/?nodeRegister",type:"POST",success:function(l){jQuery("#waitingOTAA").hide();l=JSON.parse(l);if(l.success){l=JSON.parse(l.result);k.find("#AppEUI").val(l.OTAA.AppEUI);k.find("#DevEUI").val(l.OTAA.DevEUI);k.find("#AppKey").val(l.OTAA.AppKey)}else{k.find("#errors").html(l.result)}},error:function(){jQuery("#waitingOTAA").hide()}})});k.find("#getABPData").click(function(){jQuery("#waitingABP").show();jQuery.ajax({url:Code.server+"/?nodeRegister",type:"POST",success:function(l){jQuery("#waitingABP").hide();l=JSON.parse(l);if(l.success){l=JSON.parse(l.result);k.find("#DevAddr").val(l.ABP.DevAddr);k.find("#NwkSKey").val(l.ABP.NwkSKey);k.find("#AppSKey").val(l.ABP.AppSKey)}else{k.find("#errors").html(l.result)}},error:function(){jQuery("#waitingABP").hide()}})});jQuery(":checkbox").checkboxpicker({html:true,offLabel:'<span class="glyphicon glyphicon-remove">',onLabel:'<span class="glyphicon glyphicon-ok">'}).on("change",function(){var l=jQuery("#lora_form");l.find("#adr").val(this.checked)}).prop("checked",b.lora.adr=="true");Blockly.Lora.activationChanged()})};Blockly.Lora.activationChanged=function(){var a=jQuery("#lora_form");var b=a.find("#activation").find(":selected").attr("value");if(b=="OTAA"){a.find("#OTAA").show();a.find("#ABP").hide()}else{a.find("#OTAA").hide();a.find("#ABP").show()}};"use strict";goog.provide("Blockly.wc.FieldEvent");goog.require("Blockly.FieldDropdown");goog.require("Blockly.Msg");goog.require("Blockly.Events");goog.require("goog.asserts");goog.require("goog.string");Blockly.wc.FieldEvent=function(b,a){Blockly.wc.FieldEvent.superClass_.constructor.call(this,Blockly.wc.FieldEvent.dropdownCreate,a);this.setValue(b||"")};goog.inherits(Blockly.wc.FieldEvent,Blockly.FieldDropdown);Blockly.wc.FieldEvent.prototype.createEventItemIndex_=-1;Blockly.wc.FieldEvent.prototype.renameEventItemIndex_=-1;Blockly.wc.FieldEvent.prototype.deleteEventIndex_=-1;Blockly.wc.FieldEvent.prototype.setText=function(a){if(a===null){return}if(Blockly.Msg[a]){a=Blockly.Msg[a]}a=String(a);if(a===this.text_){return}this.text_=a;this.size_.width=0;if(this.sourceBlock_&&this.sourceBlock_.rendered){this.sourceBlock_.render();this.sourceBlock_.bumpNeighbours_()}};Blockly.wc.FieldEvent.prototype.setValue=function(d){if(d===null||d===this.value_){return}if(this.sourceBlock_&&Blockly.Events.isEnabled()){Blockly.Events.fire(new Blockly.Events.Change(this.sourceBlock_,"field",this.name,this.value_,d))}if(this.sourceBlock_){this.sourceBlock_.workspace.doCreateEvent(undefined,d)}this.value_=d;var a=this.getOptions();for(var b=0;b<a.length;b++){if(a[b][1]==d){var c=a[b][0];if(typeof c=="object"){this.imageJson_=c;this.setText(c.alt)}else{this.imageJson_=null;this.setText(c)}return}}this.setText(d)};Blockly.wc.FieldEvent.dropdownCreate=function(){if(this.sourceBlock_&&this.sourceBlock_.workspace){var d=this.sourceBlock_.workspace.events.names.slice(0)}else{var d=[]}var b=this.getValue();if(b&&d.indexOf(b)==-1){d.push(b)}this.createEventItemIndex_=d.length;d.push(Blockly.Msg.EVENT_CREATE);this.renameEventItemIndex_=d.length;d.push(Blockly.Msg.RENAME_EVENT);this.deleteEventIndex_=d.length;d.push(Blockly.Msg.DELETE_EVENT.replace("%1",b));var a=[];for(var c=0;c<d.length;c++){if(Blockly.Msg[d[c]]){a[c]=[Blockly.Msg[d[c]],d[c]]}else{a[c]=[d[c],d[c]]}}return a};Blockly.wc.FieldEvent.prototype.onItemSelected=function(e,d){var c=e.getChildCount();var b=d.getValue();if(this.sourceBlock_){var a=this.sourceBlock_.workspace;if(this.renameEventItemIndex_>=0&&e.getChildAt(this.renameEventItemIndex_)===d){a.createEvent(this.getText(),this);return}else{if(this.deleteEventIndex_>=0&&e.getChildAt(this.deleteEventIndex_)===d){a.deleteEvent(this.getText(),this);return}else{if(this.createEventItemIndex_>=0&&e.getChildAt(this.createEventItemIndex_)===d){a.createEvent(undefined,this);return}}}b=this.callValidator(b)}if(b!==null){this.setValue(b)}};"use strict";goog.provide("Blockly.wc.FieldCanFrame");goog.require("Blockly.FieldDropdown");goog.require("Blockly.Msg");goog.require("Blockly.Events");goog.require("goog.asserts");goog.require("goog.string");Blockly.wc.FieldCanFrame=function(b,a){Blockly.wc.FieldCanFrame.superClass_.constructor.call(this,Blockly.wc.FieldCanFrame.dropdownCreate,a);this.setValue(b||"")};goog.inherits(Blockly.wc.FieldCanFrame,Blockly.FieldDropdown);Blockly.wc.FieldCanFrame.prototype.createCanFrameItemIndex_=-1;Blockly.wc.FieldCanFrame.prototype.renameCanFrameItemIndex_=-1;Blockly.wc.FieldCanFrame.prototype.deleteCanFrameIndex_=-1;Blockly.wc.FieldCanFrame.prototype.setText=function(a){if(a===null){return}if(Blockly.Msg[a]){a=Blockly.Msg[a]}a=String(a);if(a===this.text_){return}this.text_=a;this.size_.width=0;if(this.sourceBlock_&&this.sourceBlock_.rendered){this.sourceBlock_.render();this.sourceBlock_.bumpNeighbours_()}};Blockly.wc.FieldCanFrame.prototype.setValue=function(d){if(d===null||d===this.value_){return}if(this.sourceBlock_&&Blockly.Events.isEnabled()){Blockly.Events.fire(new Blockly.Events.Change(this.sourceBlock_,"field",this.name,this.value_,d))}if(this.sourceBlock_){this.sourceBlock_.workspace.doCreateCanFrame(undefined,d)}this.value_=d;var a=this.getOptions();for(var b=0;b<a.length;b++){if(a[b][1]==d){var c=a[b][0];if(typeof c=="object"){this.imageJson_=c;this.setText(c.alt)}else{this.imageJson_=null;this.setText(c)}return}}this.setText(d)};Blockly.wc.FieldCanFrame.dropdownCreate=function(){if(this.sourceBlock_&&this.sourceBlock_.workspace){var d=this.sourceBlock_.workspace.canFrames.names.slice(0)}else{var d=[]}var b=this.getValue();if(b&&d.indexOf(b)==-1){d.push(b)}this.createCanFrameItemIndex_=d.length;d.push(Blockly.Msg.CAN_FRAME_CREATE);this.renameCanFrameItemIndex_=d.length;d.push(Blockly.Msg.RENAME_CAN_FRAME);this.deleteCanFrameIndex_=d.length;d.push(Blockly.Msg.DELETE_CAN_FRAME.replace("%1",b));var a=[];for(var c=0;c<d.length;c++){if(Blockly.Msg[d[c]]){a[c]=[Blockly.Msg[d[c]],d[c]]}else{a[c]=[d[c],d[c]]}}return a};Blockly.wc.FieldCanFrame.prototype.onItemSelected=function(e,d){var c=e.getChildCount();var b=d.getValue();if(this.sourceBlock_){var a=this.sourceBlock_.workspace;if(this.renameCanFrameItemIndex_>=0&&e.getChildAt(this.renameCanFrameItemIndex_)===d){a.createCanFrame(this.getText(),this);return}else{if(this.deleteCanFrameIndex_>=0&&e.getChildAt(this.deleteCanFrameIndex_)===d){a.deleteCanFrame(this.getText(),this);return}else{if(this.createCanFrameItemIndex_>=0&&e.getChildAt(this.createCanFrameItemIndex_)===d){a.createCanFrame(undefined,this);return}}}b=this.callValidator(b)}if(b!==null){this.setValue(b)}};"use strict";goog.provide("Blockly.wc.FieldException");goog.require("Blockly.FieldDropdown");goog.require("Blockly.Msg");goog.require("Blockly.Events");goog.require("goog.asserts");goog.require("goog.string");Blockly.wc.FieldException=function(b,a){Blockly.wc.FieldException.superClass_.constructor.call(this,Blockly.wc.FieldException.dropdownCreate,a);this.setValue(b||"")};goog.inherits(Blockly.wc.FieldException,Blockly.FieldDropdown);Blockly.wc.FieldException.prototype.setText=function(a){if(a===null){return}if(Blockly.Msg[a]){a=Blockly.Msg[a]}a=String(a);if(a===this.text_){return}this.text_=a;this.size_.width=0;if(this.sourceBlock_&&this.sourceBlock_.rendered){this.sourceBlock_.render();this.sourceBlock_.bumpNeighbours_()}};Blockly.wc.FieldException.prototype.setValue=function(d){if(d===null||d===this.value_){return}if(this.sourceBlock_&&Blockly.Events.isEnabled()){Blockly.Events.fire(new Blockly.Events.Change(this.sourceBlock_,"field",this.name,this.value_,d))}if(this.sourceBlock_){this.sourceBlock_.workspace.doCreateEvent(undefined,d)}this.value_=d;var a=this.getOptions();for(var b=0;b<a.length;b++){if(a[b][1]==d){var c=a[b][0];if(typeof c=="object"){this.imageJson_=c;this.setText(c.alt)}else{this.imageJson_=null;this.setText(c)}return}}this.setText(d)};Blockly.wc.FieldException.find=function(d,e){while(d){d=d.targetBlock();if(d){if(typeof d.module!="undefined"){if(typeof Code.status.exceptions[d.module]!="undefined"){for(var c=0;c<Code.status.exceptions[d.module].length;c++){var b=d.module+".error."+Code.status.exceptions[d.module][c];if(e.indexOf(b)==-1){e.push(b)}}}}var a=d.getConnections_();for(var c=0;c<a.length;c++){if(a[c].type==1){Blockly.wc.FieldException.find(a[c],e)}}d=d.nextConnection}}};Blockly.wc.FieldException.dropdownCreate=function(){var e=[];if(this.sourceBlock_&&this.sourceBlock_.workspace){var d=this.sourceBlock_.previousConnection;if(d){d=d.targetBlock();if(d){if(d.type=="exception_try"){var c=d.inputList[0].connection;Blockly.wc.FieldException.find(c,e)}}}}e.push("any");e=e.sort();var a=[];for(var b=0;b<e.length;b++){if(Blockly.Msg[e[b]]){a[b]=[Blockly.Msg[e[b]],e[b]]}else{a[b]=[e[b],e[b]]}}return a};Blockly.wc.FieldException.prototype.onItemSelected=function(d,c){var b=d.getChildCount();var a=c.getValue();if(a!==null){this.setValue(a)}};"use strict";var IDEHelp={broadcast:"Broadcast-()",broadcast_and_wait:"Broadcast-()-and-wait",when_board_starts:"When-board-starts",when_i_receive:"When-I-receive-()",execute_every:"Every-()-(unit)",thread:"Forever",wait_for:"Wait-()-(unit)",cpu_sleep:"Sleep-()-seconds",controls_repeat:"Repeat-()-times",controls_whileUntil:"Repeat-while-()",setdigitalpin:"Set-digital-pin-()-to-()",invertdigitalpin:"Invert-digital-pin-()",getdigitalpin:"Get-digital-pin-value-()",getanalogpin:"Get-analog-pin-value-()-in-()",getexternalanalogchannel:"Get-analog-value-from-()-()-in-()",setpwmpin:"Set-PWM-pin-()-to-frequency-()-hertzs-and-duty-()-%25",when_digital_pin:"When-digital-pin-()-changes-at-()",wifi_start:"Start-Wi-Fi",wifi_stop:"Stop-Wi-Fi",mqtt_subscribe:"When-a-message-is-received-to-topic-()-with-()-with:-length,-payload",mqtt_publish:"Publish-()-to-topic-()-with-()"};Blockly.Block.prototype.isHatBlock=function(){var a=["when_board_starts","when_i_receive","when_digital_pin","when_i_receive_a_lora_frame","sensor_when","execute_every","thread","mqtt_subscribe"];return(a.indexOf(this.type)!=-1)};Blockly.Block.prototype.isInHatBlock=function(){var a=["when_board_starts","when_i_receive","when_digital_pin","when_i_receive_a_lora_frame","sensor_when","execute_every","thread","mqtt_subscribe"];var b=this;do{if(a.indexOf(b.type)!=-1){return true;break}b=b.getSurroundParent()}while(b);return false};Blockly.Block.prototype.checkIsInHatBlock=function(b){if(!this.workspace.isDragging||this.workspace.isDragging()){return}if((typeof b.element!="undefined")&&(this.warning!=null)&&(b.element=="disabled")){if(b.blockId==this.id){this.setDisabled(true);return}}if((typeof b.element!="undefined")&&(b.element=="disabled")){if((b.newValue!=b.oldValue)&&(b.blockId==this.id)){this.disabledByUser=b.newValue}}if(this.isInHatBlock()){var a=(this.warning!=null);this.setWarningText(null);if(!this.isInFlyout&&a&(typeof this.disabledByUser=="undefined"?true:(!this.disabledByUser))){this.setDisabled(false)}else{if(typeof this.disabledByUser!="undefined"){this.setDisabled(this.disabledByUser)}}}else{this.setWarningText(Blockly.Msg.WARNING_NOT_IN_HAT_BLOCK);if(!this.isInFlyout&&!this.getInheritedDisabled()){this.setDisabled(true)}}};Blockly.Block.prototype.getHelpUrl=function(){var a;if(typeof IDEHelp[this.type]!="undefined"){a="https://ide.whitecatboard.org/wiki/"+IDEHelp[this.type]}else{a=""}return a};Blockly.Block.prototype.updateBoardAtFieldChange=function(b){var a=this;if(!a.isInFlyout){Code.workspace.blocks.addChangeListener(function(d){if((d.type==Blockly.Events.CHANGE)){if(d.blockId!=a.id){var c=Blockly.Workspace.getById(d.workspaceId);if(c.getBlockById(d.blockId).getParent()){if(c.getBlockById(d.blockId).getParent().id!=a.id){return}}else{return}}if(d.name==b){if(a.fieldTimeout){clearTimeout(a.fieldTimeout)}a.fieldTimeout=setTimeout(function(){a.value=d.newValue;var e=Blockly.Lua.blockCode(a);console.log(e);a.removeError();a.removeStart();Code.agent.send({command:"boardRunCommand",arguments:{code:btoa(e)}},function(g,f){});a.value=-1},500)}}})}};Blockly.Block.prototype.updateBoardAtBlockCreate=function(){var a=this;if(!a.isInFlyout){Code.workspace.blocks.addChangeListener(function(c){if((c.type==Blockly.Events.CREATE)){if(c.blockId!=a.id){var b=Blockly.Workspace.getById(c.workspaceId);if(b.getBlockById(c.blockId).getParent()){if(b.getBlockById(c.blockId).getParent().id!=a.id){return}}else{return}}if(a.createTimeout){clearTimeout(a.createTimeout)}a.createTimeout=setTimeout(function(){var d=Blockly.Lua.blockCode(a);a.removeError();a.removeStart();Code.agent.send({command:"boardRunCommand",arguments:{code:btoa(d)}},function(f,e){})},250)}})}};var Settings={};Settings.load=function(e){if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){var a=require("fs");var h=require("path");var d="settings.json";var c=h.join(process.cwd(),d);try{var g=a.readFileSync(c,"utf8")}catch(b){return}try{var f=JSON.parse(g);if(f.hasOwnProperty("language")){e.language=f.language}if(f.hasOwnProperty("board")){e.board=f.board}if(f.hasOwnProperty("programmingModel")){e.programmingModel=f.programmingModel}}catch(b){Code.showError(MSG.error,MSG.youHaveAnErrorInSettings+"<br><br>"+b)}}}else{e.language=jQuery("#laguagePreferences").attr("value");if(e.language==""){e.language="en"}e.programmingModel=jQuery("#programmingModelPreferences").attr("value");if(e.programmingModel==""){e.programmingModel="blocks"}}};Settings.save=function(d){if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){var a=require("fs");var e=require("path");var c="settings.json";var b=e.join(process.cwd(),c);a.writeFileSync(b,JSON.stringify(d));chrome.runtime.reload()}}else{jQuery("#laguagePreferences").attr("value",d.language);jQuery("#programmingModelPreferences").attr("value",d.programmingModel);jQuery("#preferencesForm").submit()}};function watcher(){var a=this;Blockly.Blocks.logic_compare.hasWatcher=true;Blockly.Blocks.logic_operation.hasWatcher=true;Blockly.Blocks.logic_negate.hasWatcher=true;Blockly.Blocks.logic_boolean.hasWatcher=true;Blockly.Blocks.logic_null.hasWatcher=true;Blockly.Blocks.logic_ternary.hasWatcher=true;Blockly.Blocks.math_number.hasWatcher=true;Blockly.Blocks.math_arithmetic.hasWatcher=true;Blockly.Blocks.math_single.hasWatcher=true;Blockly.Blocks.math_trig.hasWatcher=true;Blockly.Blocks.logic_ternary.hasWatcher=true;Blockly.Blocks.math_constant.hasWatcher=true;Blockly.Blocks.math_number_property.hasWatcher=true;Blockly.Blocks.math_change.hasWatcher=true;Blockly.Blocks.math_round.hasWatcher=true;Blockly.Blocks.math_on_list.hasWatcher=true;Blockly.Blocks.math_modulo.hasWatcher=true;Blockly.Blocks.math_constrain.hasWatcher=true;Blockly.Blocks.math_random_int.hasWatcher=true;Blockly.Blocks.math_random_float.hasWatcher=true;Blockly.Blocks.variables_get.hasWatcher=true;a.watcher=jQuery('<div title="" style="position:absolute;"></div>').hide().appendTo("body");jQuery(".btn-toolbar,#languageDiv,#content_blocks,#statusBar").click(function(){a.hide()});Blockly.bindEventWithChecks_(document,"mousemove",this,function(b){a.hide()});Blockly.bindEventWithChecks_(document,"dblclick",this,function(b){a.hide();a.show()});Code.workspace.blocks.addChangeListener(function(b){if((b.type==Blockly.Events.UI)&&(b.element=="selected")){a.hide()}if((b.type==Blockly.Events.CHANGE)){a.hide()}if((b.type==Blockly.Events.DELETE)){a.hide()}})}watcher.prototype.show=function(){var e=this;if(Blockly.selected){if(Blockly.selected.hasOwnProperty("hasWatcher")&&Blockly.selected.hasWatcher){var a=Blockly.selected.workspace.getSvgXY(Blockly.selected.svgPath_);var c=jQuery("#content_blocks").position().left;var b=jQuery("#content_blocks").position().top;e.watcher.css({left:c+a.x+Blockly.selected.width*Blockly.selected.workspace.scale,top:b+a.y-2,width:2,height:Blockly.selected.height*Blockly.selected.workspace.scale});var d=Blockly.Lua.blockWatcherCode(Blockly.selected);Code.agent.send({command:"boardRunCommand",arguments:{code:btoa(d)}},function(h,g){var f=atob(g.response);e.watcher.show();e.watcher.showBalloon({contents:f})})}}};watcher.prototype.hide=function(){var a=this;a.watcher.hide();a.watcher.hideBalloon()};Blockly.WorkspaceSvg.prototype.setScale=function(a){Code.watcher.hide();if(this.options.zoomOptions.maxScale&&a>this.options.zoomOptions.maxScale){a=this.options.zoomOptions.maxScale}else{if(this.options.zoomOptions.minScale&&a<this.options.zoomOptions.minScale){a=this.options.zoomOptions.minScale}}this.scale=a;this.updateGridPattern_();if(this.scrollbar){this.scrollbar.resize()}else{this.translate(this.scrollX,this.scrollY)}Blockly.hideChaff(false);if(this.flyout_){this.flyout_.reflow()}};var StorageType={None:0,Board:1,Computer:2,Cloud:3};function Storage(a){this.type=a;this.isInit=false;this.fs=null}Storage.prototype.errorHandler=function(a){var b=""};Storage.prototype.init=function(b){var a=this;if(a.isInit){b();return}if(a.type==StorageType.Board){a.isInit=true;b()}if(a.type==StorageType.Cloud){a.isInit=true;b()}if(a.type==StorageType.Computer){window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;navigator.webkitPersistentStorage.requestQuota(5*1024*1024,function(c){window.requestFileSystem(window.PERSISTENT,c,function(d){a.fs=d;a.isInit=true;b()},a.errorHandler)},function(c){})}};Storage.prototype._localListDirectories=function(e,f){var d=this;var a=[];var c;var b=function(){c.readEntries(function(h){if(!h.length){f(a.sort())}else{for(var g=0;g<h.length;g++){var j=h[g];a.push({date:"",name:j.name,size:"",type:(j.isDirectory?"d":"f")})}b()}},d.errorHandler)};if(e=="/"){c=d.fs.root.createReader();b()}else{d.fs.root.getDirectory(e,{create:false},function(g){c=g.createReader();b()})}};Storage.prototype._boardListDirectories=function(a,b){Code.agent.send({command:"boardGetDirContent",arguments:{path:a}},function(d,c){b(c)})};Storage.prototype._cloudListDirectories=function(a,b){if(a=="/"){a=""}jQuery.ajax({url:Code.server,data:{listDirectories:"",folder:a},type:"POST",success:function(d){var c=[];d=JSON.parse(d);if(!d.success){Code.showError(MSG.error,MSG.youHaveAnError+"<br><br>"+d.result,function(){});b([])}d=d.result;for(var e=0;e<d.length;e++){var f=d[e];f.name=atob(f.name);c.push(f)}b(c);return},error:function(){b([])}})};Storage.prototype._localLoad=function(a,c){var b=this;b.fs.root.getFile(a,{},function(d){d.file(function(f){var e=new FileReader();e.onloadend=function(g){c(this.result)};e.readAsText(f)},b.errorHandler)},b.errorHandler)};Storage.prototype._boardLoad=function(a,b){Code.agent.send({command:"boardReadFile",arguments:{path:a}},function(e,c){var d=atob(c.content);b(d)})};Storage.prototype._cloudLoad=function(a,b){jQuery.ajax({url:Code.server,data:{loadFile:a},type:"POST",success:function(c){c=JSON.parse(c);if(!c.success){Code.showError(MSG.error,MSG.youHaveAnError+"<br><br>"+c.result,function(){});b([])}c=c.result;b(atob(c.content));return},error:function(){b([])}})};Storage.prototype._localRemove=function(a,c){var b=this;b.fs.root.getFile(a,{create:true},function(d){d.remove(function(){c(true)},function(){c(false)})})};Storage.prototype._boardRemove=function(a,b){Code.agent.send({command:"boardRemoveFile",arguments:{path:btoa(a)}},function(d,c){b(true)})};Storage.prototype._cloudRemove=function(a,b){jQuery.ajax({url:Code.server,data:{removeFile:a},type:"POST",success:function(c){c=JSON.parse(c);if(!c.success){Code.showError(MSG.error,MSG.youHaveAnError+"<br><br>"+c.result,function(){});b(false);return}c=c.result;b(true);return},error:function(){b(false);return}})};Storage.prototype._localSave=function(a,c,d){var b=this;b.fs.root.getFile(a,{create:true},function(e){e.createWriter(function(f){f.onwriteend=function(h){d()};f.onerror=function(h){};var g=new Blob([c],{type:"plain/text"});f.write(g)},b.errorHandler)},b.errorHandler)};Storage.prototype._boardSave=function(a,b,c){Code.agent.send({command:"boardWriteFile",arguments:{path:a,content:btoa(b)}},function(e,d){c()})};Storage.prototype._cloudSave=function(a,d,b,c){jQuery.ajax({url:Code.server,data:{saveFile:btoa(a),id:d,content:btoa(b)},type:"POST",success:function(e){e=JSON.parse(e);if(!e.success){Code.showError(MSG.error,MSG.youHaveAnError+"<br><br>"+e.result,function(){});c([])}e=e.result;c();return},error:function(){c([])}});c()};Storage.prototype.listDirectories=function(b,c){var a=this;a.init(function(){if(a.type==StorageType.Board){return a._boardListDirectories(b,c)}else{if(a.type==StorageType.Computer){return a._localListDirectories(b,c)}else{if(a.type==StorageType.Cloud){return a._cloudListDirectories(b,c)}}}})};Storage.prototype.load=function(a,c){var b=this;b.init(function(){if(b.type==StorageType.Board){return b._boardLoad(a,c)}else{if(b.type==StorageType.Computer){return b._localLoad(a,c)}else{if(b.type==StorageType.Cloud){return b._cloudLoad(a,c)}}}})};Storage.prototype.save=function(a,e,c,d){var b=this;b.init(function(){if(b.type==StorageType.Board){return b._boardSave(a,c,d)}else{if(b.type==StorageType.Computer){return b._localSave(a,c,d)}else{if(b.type==StorageType.Cloud){return b._cloudSave(a,e,c,d)}}}})};Storage.prototype.remove=function(a,c){var b=this;b.init(function(){if(b.type==StorageType.Board){return b._boardRemove(a,c)}else{if(b.type==StorageType.Computer){return b._localRemove(a,c)}else{if(b.type==StorageType.Cloud){return b._cloudRemove(a,c)}}}})};"use strict";var statusType={Alert:0,Info:1,Nothing:3,Progress:4};var Status={};Status.messages=[];Status.messages["Downloading prerequisites"]={tag:"downloadingPrerequisites",type:statusType.Progress,zone:"statusBar1"};Status.messages["Uploading framework"]={tag:"uploadingFramework",type:statusType.Progress,zone:"statusBar1"};Status.messages["Downloading esptool"]={tag:"downloadingEsptool",type:statusType.Progress,zone:"statusBar1"};Status.messages["Unpacking esptool"]={tag:"unpackingEsptool",type:statusType.Progress,zone:"statusBar1"};Status.messages["Downloading firmware"]={tag:"downloadingFirmware",type:statusType.Progress,zone:"statusBar1"};Status.messages["Unpacking firmware"]={tag:"unpackingFirmware",type:statusType.Progress,zone:"statusBar1"};Status.messages["No board attached"]={tag:"noBoardAttached",type:statusType.Alert,page:"whitecat-ide/Errors:--No-board-attached",zone:"statusBar1"};Status.messages["Scanning boards"]={tag:"scanningBoards",type:statusType.Progress,zone:"statusBar1"};Status.messages["Python not found"]={tag:"pythonNotFound",type:statusType.Aler,zone:"statusBar1"};Status.messages["Reseting board"]={tag:"resetingBoard",type:statusType.Progress,zone:"statusBar1"};Status.messages["Stopping program"]={tag:"stoppingProgram",type:statusType.Progress,zone:"statusBar1"};Status.messages["Can't connect to agent"]={tag:"cannotConnectToAgent",type:statusType.Alert,page:"whitecat-ide/Errors:--Can't-connect-to-agent",zone:"statusBar1"};Status.messages["Connect a board"]={tag:"connectABoard",type:statusType.Alert,zone:"statusBar1"};Status.messages["Corrupted firmware"]={tag:"corruptedFirmware",type:statusType.Alert,zone:"statusBar1"};Status.messages["Flash error"]={tag:"flashError",type:statusType.Alert,zone:"statusBar1"};Status.messages["Whitecat N1 ESP32"]={tag:"boardAttached",type:statusType.Info,zone:"statusBar1"};Status.messages["ESP32 Thing"]={tag:"boardAttached",type:statusType.Info,zone:"statusBar1"};Status.messages["ESP32 Core Board"]={tag:"boardAttached",type:statusType.Info,zone:"statusBar1"};Status.messages.cloudConsoleOn={tag:"cloudConsoleOn",type:statusType.Info,zone:"statusBar2"};Status.messages.cloudConsoleOff={tag:"cloudConsoleOff",type:statusType.Info,zone:"statusBar2"};Status.current={type:statusType.Nothing,message:""};Status.show=function(h){var g=Status.messages[h];var e=statusType.Info;var i="";var a=undefined;var d="";if(typeof g!="undefined"){e=g.type;i=g.tag;d=g.zone;if(typeof g.page!="undefined"){a="https://whitecatboard.org/git/wiki/"+g.page}}else{d="statusBar1"}if((Status.current.type!=e)||(Status.current.message!=h)){jQuery("."+d).removeClass("statusBarClick").unbind("click");Status.current.type=e;Status.current.message=h;var b=h;if(typeof(MSG[i])!="undefined"){b=MSG[i]}if(e==statusType.Progress){b=b+" ..."}var f="";switch(e){case statusType.Alert:f="warning2";break}var c;if(e==statusType.Progress){c='<span class="statusBarText noselect">'+b+"</span>"}else{c='<span class="statusBarText noselect">'+b+"</span>";if(i=="boardAttached"){c+='<span class="icon icon-arrow-down5" style="margin-right: 2px;vertical-align: text-bottom;"></span>'}if((i=="cloudConsoleOn")||(i=="cloudConsoleOff")){c+='<span class="icon icon-arrow-down5" style="margin-right: 2px;vertical-align: text-bottom;"></span>'}}if(f){c='<i class="icon icon-'+f+'"></i><span>'+c+"</span>"}if(e==statusType.Alert){jQuery("."+d).addClass("statusBarClick").bind("click",function(k){if(typeof a!="undefined"){if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){var j=gui.Window.open(a,{focus:true,position:"center",width:1055,height:700})}else{window.open(a,"_blank")}}else{window.open(a,"_blank")}}})}else{if(e==statusType.Info){if(i=="boardAttached"){jQuery("."+d).addClass("statusBarClick").bind("click",function(j){jQuery("#cloudConsole").hide();jQuery("#cloudConsole").attr("data-visibe","false");if(Code.agent.version>"1.2"){var k=jQuery("#boardConsole").attr("data-visibe");if(typeof k=="undefined"){k=false}if((k=="")||(k=="false")){jQuery("#boardConsole").show();jQuery("#boardConsole").attr("data-visibe","true");jQuery("#boardConsole").focus()}else{jQuery("#boardConsole").hide();jQuery("#boardConsole").attr("data-visibe","false")}}else{Code.showAlert(MSG.thisFuntionRequiresUpdateAgent)}})}if((i=="cloudConsoleOn")||(i=="cloudConsoleOff")){jQuery("."+d).addClass("statusBarClick").bind("click",function(j){jQuery("#boardConsole").hide();jQuery("#boardConsole").attr("data-visibe","false");var k=jQuery("#cloudConsole").attr("data-visibe");if(typeof k=="undefined"){k=false}if((k=="")||(k=="false")){jQuery("#cloudConsole").show();jQuery("#cloudConsole").attr("data-visibe","true")}else{jQuery("#cloudConsole").hide();jQuery("#cloudConsole").attr("data-visibe","false")}})}}}if(i=="cloudConsoleOff"){jQuery("."+d).html(c).hide();jQuery("#cloudConsole").hide();jQuery("#cloudConsole").attr("data-visibe","false")}else{jQuery("."+d).html(c).show()}}};Status.hide=function(){jQuery(".statusBar1").hide();jQuery(".statusBar2").hide()};function Cloud(d,a,b){var e=this;e.username=a;if(e.username!=""){e.client=new Paho.MQTT.Client("mqtt.whitecatboard.org",9883,"/"+e.username,"web_"+parseInt(Math.random()*100,10));e.client.onConnectionLost=e.onConnectionLost;e.client.onMessageArrived=e.onMessageArrived;e.options={timeout:3,useSSL:true,cleanSession:true,onSuccess:function(){e.client.subscribe("/"+e.username+"/+",{qos:0});e.client.subscribe("/"+e.username+"/+/+",{qos:0});e.client.subscribe("/"+e.username+"/+/+/+",{qos:0});e.client.subscribe("/"+e.username+"/+/+/+/+",{qos:0})},onFailure:function(f){setTimeout(e.Connect,200)},userName:e.username,password:b};var c="";if(d=="mqtt"){c+='<table id="cloudTable" width="100%">';c+="<thead>";c+="<tr>";c+="<th>Time</th><th>Topic</th><th>Payload</th>";c+="</tr>";c+="</thead>";c+="<tbody>";c+="</thead>";c+="</table>";jQuery("#cloudConsole").html(c);jQuery("#cloudTable").DataTable({lengthMenu:[[10,25],[10,25]],order:[[0,"desc"]],columns:[{width:"5%"},{width:"20%"},{width:"75%"}]})}else{c+='<table id="cloudTable" width="100%">';c+="<thead>";c+="<tr>";c+="<th>Time</th><th>Device</th><th>Payload</th>";c+="</tr>";c+="</thead>";c+="<tbody>";c+="</thead>";c+="</table>";jQuery("#cloudConsole").html(c);jQuery("#cloudTable").DataTable({lengthMenu:[[10,25],[10,25]],order:[[0,"desc"]],columns:[{width:"5%"},{width:"20%"},{width:"75%"}]})}}}Cloud.prototype.Connect=function(){var a=this;a.client.connect(a.options)};Cloud.prototype.Disconnect=function(){var a=this;a.client.disconnect()};Cloud.prototype.onConnectionLost=function(a){var b=this;setTimeout(b.Connect,200)};Cloud.prototype.onMessageArrived=function(c){var a=c.destinationName;var e=c.payloadString;var b=jQuery("#cloudTable").DataTable();var d=a.split("/");if((d[1]=="ttn")&&(d[3]=="up")){b.row.add([jQuery.format.date(new Date(),"dd/M/yy hh:mm:ss"),a,e]).draw(false)}else{b.row.add([jQuery.format.date(new Date(),"dd/M/yy hh:mm:ss"),a,e]).draw(false)}};var Blockly={};Blockly.Lua=new Blockly.Generator("Lua");Blockly.Lua.addReservedWords("_,__inext,assert,bit,colors,colours,coroutine,disk,dofile,error,fs,fetfenv,getmetatable,gps,help,io,ipairs,keys,loadfile,loadstring,math,native,next,os,paintutils,pairs,parallel,pcall,peripheral,print,printError,rawequal,rawget,rawset,read,rednet,redstone,rs,select,setfenv,setmetatable,sleep,string,table,term,textutils,tonumber,tostring,turtle,type,unpack,vector,write,xpcall,_VERSION,__indext,HTTP,and,break,do,else,elseif,end,false,for,function,if,in,local,nil,not,or,repeat,return,then,true,until,while,add,sub,mul,div,mod,pow,unm,concat,len,eq,lt,le,index,newindex,call,assert,collectgarbage,dofile,error,_G,getmetatable,inpairs,load,loadfile,next,pairs,pcall,print,rawequal,rawget,rawlen,rawset,select,setmetatable,tonumber,tostring,type,_VERSION,xpcall,require,package,string,table,math,bit32,io,file,os,debug");Blockly.Lua.ORDER_ATOMIC=0;Blockly.Lua.ORDER_HIGH=1;Blockly.Lua.ORDER_EXPONENTIATION=2;Blockly.Lua.ORDER_UNARY=3;Blockly.Lua.ORDER_MULTIPLICATIVE=4;Blockly.Lua.ORDER_ADDITIVE=5;Blockly.Lua.ORDER_CONCATENATION=6;Blockly.Lua.ORDER_RELATIONAL=7;Blockly.Lua.ORDER_AND=8;Blockly.Lua.ORDER_OR=9;Blockly.Lua.ORDER_NONE=99;Blockly.Lua.init=function(b){Blockly.Lua.blockNums=0;Blockly.Lua.blockNum=[];Blockly.Lua.blockId=[];Blockly.Lua.definitions_=Object.create(null);Blockly.Lua.functionNames_=Object.create(null);Blockly.Lua.variableDB_?Blockly.Lua.variableDB_.reset():Blockly.Lua.variableDB_=new Blockly.Names(Blockly.Lua.RESERVED_WORDS_)};Blockly.Lua.finish=function(b){var f=[],e;for(e in Blockly.Lua.definitions_){f.push(Blockly.Lua.definitions_[e])}delete Blockly.Lua.definitions_;delete Blockly.Lua.functionNames_;Blockly.Lua.variableDB_.reset();return f.join("\n\n")+"\n\n\n"+b};Blockly.Lua.scrubNakedValue=function(b){return"local _ = "+b+"\n"};Blockly.Lua.quote_=function(b){b=b.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'");return"'"+b+"'"};Blockly.Lua.scrub_=function(g,j){var i="";if(!g.outputConnection||!g.outputConnection.targetConnection){var h=g.getCommentText();(h=Blockly.utils.wrap(h,Blockly.Lua.COMMENT_WRAP-3))&&(i+=Blockly.Lua.prefixLines(h,"-- ")+"\n");for(var f=0;f<g.inputList.length;f++){g.inputList[f].type==Blockly.INPUT_VALUE&&(h=g.inputList[f].connection.targetBlock())&&(h=Blockly.Lua.allNestedComments(h))&&(i+=Blockly.Lua.prefixLines(h,"-- "))}}f=g.nextConnection&&g.nextConnection.targetBlock();f=Blockly.Lua.blockToCode(f);return i+j+f};Blockly.Lua.inTryBlock=function(b){for(b=b.previousConnection;b;){if(b=b.targetBlock()){if("exception_try"==b.type){return !0}b=b.previousConnection}}return !1};Blockly.Lua.blockStart=function(b,d){return Blockly.Lua.developerMode?Blockly.Lua.indent(b,"wcBlock.blockStart("+Blockly.Lua.blockIdToNum(d.id)+")")+"\n":""};Blockly.Lua.blockEnd=function(b,d){return Blockly.Lua.developerMode?Blockly.Lua.indent(b,"wcBlock.blockEnd("+Blockly.Lua.blockIdToNum(d.id)+")")+"\n":""};Blockly.Lua.blockError=function(b,f){var e;return Blockly.Lua.developerMode?e=""+(Blockly.Lua.indent(b,"wcBlock.blockError("+Blockly.Lua.blockIdToNum(f.id)+", err, message)")+"\n"):""};Blockly.Lua.tryBlock=function(g,j,i,h){var f="";Blockly.Lua.blockIdToNum(j.id);"undefined"==typeof h&&(h="");""!=h&&(f+="-- begin: "+h+"\n");!Blockly.Lua.developerMode||Blockly.Lua.inTryBlock(j)?f+=Blockly.Lua.indent(g,i):(f+=Blockly.Lua.indent(0,"try(")+"\n",f+=Blockly.Lua.indent(1,"function()")+"\n",""!=i&&(f+=Blockly.Lua.indent(2,i)),f+=Blockly.Lua.indent(1,"end,")+"\n",f+=Blockly.Lua.indent(1,"function(where, line, err, message)")+"\n",f+=Blockly.Lua.blockError(2,j),f+=Blockly.Lua.indent(1,"end")+"\n",f+=Blockly.Lua.indent(0,")"),f=Blockly.Lua.indent(g,f)+"\n");""!=h&&(f+="-- end: "+h+"\n");j.nextConnection&&j.nextConnection.targetBlock()&&(f+="\n");return f};Blockly.Lua.require=function(b){-1==codeSection.require.indexOf('require("'+b+'")')&&codeSection.require.push('require("'+b+'")')};Blockly.Lua.indent=function(b,f){for(var e=0;e<b;e++){f=Blockly.Lua.prefixLines(f,Blockly.Lua.INDENT)}return f};Blockly.Lua.blockIdToNum=function(b){"undefined"==typeof Blockly.Lua.blockNum[b]&&(Blockly.Lua.blockNums+=1,Blockly.Lua.blockNum[b]=Blockly.Lua.blockNums,Blockly.Lua.blockId[Blockly.Lua.blockNums]=b);return Blockly.Lua.blockNum[b]};Blockly.Lua.numToBlockId=function(b){return Blockly.Lua.blockId[b]};function board(){var a=this;a.list=[{id:"N1ESP32",desc:"Whitecat N1 ESP32"},{id:"ESP32THING",desc:"ESP32 Thing"},{id:"ESP32COREBOARD",desc:"ESP32 Core Board"}]}board.prototype.getDesc=function(b){var a="";this.list.forEach(function(d,c){if(d.id==b){a=d.desc;return}});return a};board.prototype.get=function(a,h){if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){var f=require("fs");var i=require("path");var c="boards/defs/"+a+".json";var d=i.join(process.cwd(),c);try{var e=f.readFileSync(d,"utf8")}catch(g){return}try{var b=JSON.parse(e);h(b)}catch(g){h(JSON.parse("{}"))}}else{jQuery.ajax({url:Code.folder+"/boards/defs/"+a+".json",success:function(j){h(j);return},error:function(){h(JSON.parse("{}"))}})}}else{jQuery.ajax({url:Code.folder+"/boards/defs/"+a+".json",success:function(j){h(j);return},error:function(){h(JSON.parse("{}"))}})}};board.prototype.getMaps=function(c,b){var a=this;a.get(c,function(d){var e=[];if(d.hasOwnProperty("digitalPins")){e.digitalPins=d.digitalPins}if(d.hasOwnProperty("analogPins")){e.analogPins=d.analogPins}if(d.hasOwnProperty("analogPinsChannel")){e.analogPinsChannel=d.analogPinsChannel}if(d.hasOwnProperty("pwmPins")){e.pwmPins=d.pwmPins}if(d.hasOwnProperty("pwmPinsChannel")){e.pwmPinsChannel=d.pwmPinsChannel}if(d.hasOwnProperty("i2cUnits")){e.i2cUnits=d.i2cUnits}if(d.hasOwnProperty("canUnits")){e.canUnits=d.canUnits}if(d.hasOwnProperty("spiUnits")){e.spiUnits=d.spiUnits}if(d.hasOwnProperty("uartUnits")){e.uartUnits=d.uartUnits}if(d.hasOwnProperty("externalAdcUnits")){e.externalAdcUnits=d.externalAdcUnits}b(e)})};function agent(){var b=this;b.boardEvents=["boardUpgraded","boardAttached","boardDetached","boardPowerOnReset","blockStart","blockEnd","blockError","boardUpdate","boardConsoleOut","boardRuntimeError"];b.boardCommands=["attachIde","detachIde","boardUpgrade","boardInfo","boardReset","boardStop","boardGetDirContent","boardReadFile","boardWriteFile","boardRunProgram","boardRunCommand","boardRemoveFile"];b.version="";for(var a=0;a<b.boardEvents.length;a++){b[b.boardEvents[a]+"Listeners"]=[]}for(var a=0;a<b.boardCommands.length;a++){b[b.boardCommands[a]+"Listeners"]=[]}b.controlSocket=undefined;b.controlSocketConnected=false;b.consoleUpSocket=undefined;b.consoleUpSocketConnected=false;b.consoleDownSocket=undefined;b.consoleDownSocketConnected=false}agent.prototype.controlSocketConnect=function(){var b=this;var a;if(window.MozWebSocket){window.WebSocket=window.MozWebSocket}else{if(!window.WebSocket){return}}a=new WebSocket("ws://localhost:8080");a.addEventListener("open",function(c){b.controlSocketConnected=true;b.controlSocket=a;Code.board.get(Code.settings.board,function(d){Code.agent.send({command:"attachIde",arguments:{devices:Code.devices}},function(f,e){})})});a.addEventListener("message",function(d){var e=d.data;e=e.replace('"info": , "','"');var c=JSON.parse(e);b.callListeners(c.notify,c.info)});a.addEventListener("close",function(c){b.controlSocket=undefined;if(b.controlSocketConnected){b.callListeners("boardDetached","")}b.controlSocketConnected=false;setTimeout(function(){b.controlSocketConnect()},1000)});a.addEventListener("error",function(c){Status.show("Can't connect to agent")})};agent.prototype.consoleUpSocketConnect=function(){var b=this;var a;if(window.MozWebSocket){window.WebSocket=window.MozWebSocket}else{if(!window.WebSocket){return}}a=new WebSocket("ws://localhost:8080/up");a.addEventListener("open",function(c){b.consoleUpSocketConnected=true;b.consoleUpSocket=a});a.addEventListener("message",function(c){Term.write(c.data)});a.addEventListener("close",function(c){b.consoleUpSocket=undefined;b.consoleUpSocketConnected=false;setTimeout(function(){b.consoleUpSocketConnect()},1000)});a.addEventListener("error",function(c){})};agent.prototype.consoleDownSocketConnect=function(){var b=this;var a;if(window.MozWebSocket){window.WebSocket=window.MozWebSocket}else{if(!window.WebSocket){return}}a=new WebSocket("ws://localhost:8080/down");a.addEventListener("open",function(c){b.consoleDownSocketConnected=true;b.consoleDownSocket=a});a.addEventListener("message",function(c){});a.addEventListener("close",function(c){b.consoleDownSocket=undefined;b.consoleDownSocketConnected=false;setTimeout(function(){b.consoleDownSocketConnect()},1000)});a.addEventListener("error",function(c){})};agent.prototype.callListeners=function(e,d){var c=this;var b=[];if(c.hasOwnProperty(e+"Listeners")){for(var a=0;a<c[e+"Listeners"].length;a++){b.push(a);c[e+"Listeners"][a](e,d)}for(var a=0;a<b.length;a++){if(c.boardEvents.indexOf(e)==-1){c[e+"Listeners"].splice(a,1)}}}};agent.prototype.addListener=function(c,b){var a=this;if(!a.hasOwnProperty(c+"Listeners")){throw"missingListener:"+c}a[c+"Listeners"].push(b);return a[c+"Listeners"].length};agent.prototype.send=function(b,c){var a=this;if(a.controlSocket){a.addListener(b.command,c);a.controlSocket.send(JSON.stringify(b))}else{c({})}};(function(a,d,c){var g={"function":true,object:true},f=g[typeof exports]&&exports&&!exports.nodeType&&exports,b=g[typeof module]&&module&&!module.nodeType&&module,e=f&&b&&typeof global=="object"&&global,h=b&&b.exports===f&&f;if(e&&(e.global===e||e.window===e||e.self===e)){a=e}if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(["exports"],c);if(f&&h){c(b.exports)}}else{if(f&&b){if(h){c(b.exports)}else{c(f)}}else{c((a[d]={}))}}}(this,"luaparse",function(P){P.version="0.2.1";var aZ,ab,j;var ax=P.defaultOptions={wait:false,comments:true,scope:false,locations:false,ranges:false,onCreateNode:null,onCreateScope:null,onDestroyScope:null};var ak=1,aY=2,o=4,ag=8,aN=16,p=32,K=64,ai=128,x=256;P.tokenTypes={EOF:ak,StringLiteral:aY,Keyword:o,Identifier:ag,NumericLiteral:aN,Punctuator:p,BooleanLiteral:K,NilLiteral:ai,VarargLiteral:x};var ao=P.errors={unexpected:"unexpected %1 '%2' near '%3'",expected:"'%1' expected near '%2'",expectedToken:"%1 expected near '%2'",unfinishedString:"unfinished string near '%1'",malformedNumber:"malformed number near '%1'",invalidVar:"invalid left-hand side of assignment near '%1'"};var au=P.ast={labelStatement:function(a2){return{type:"LabelStatement",label:a2}},breakStatement:function(){return{type:"BreakStatement"}},gotoStatement:function(a2){return{type:"GotoStatement",label:a2}},returnStatement:function(a2){return{type:"ReturnStatement","arguments":a2}},ifStatement:function(a2){return{type:"IfStatement",clauses:a2}},ifClause:function(a3,a2){return{type:"IfClause",condition:a3,body:a2}},elseifClause:function(a3,a2){return{type:"ElseifClause",condition:a3,body:a2}},elseClause:function(a2){return{type:"ElseClause",body:a2}},whileStatement:function(a3,a2){return{type:"WhileStatement",condition:a3,body:a2}},doStatement:function(a2){return{type:"DoStatement",body:a2}},repeatStatement:function(a3,a2){return{type:"RepeatStatement",condition:a3,body:a2}},localStatement:function(a3,a2){return{type:"LocalStatement",variables:a3,init:a2}},assignmentStatement:function(a3,a2){return{type:"AssignmentStatement",variables:a3,init:a2}},callStatement:function(a2){return{type:"CallStatement",expression:a2}},functionStatement:function(a3,a5,a4,a2){return{type:"FunctionDeclaration",identifier:a3,isLocal:a4,parameters:a5,body:a2}},forNumericStatement:function(a4,a6,a3,a5,a2){return{type:"ForNumericStatement",variable:a4,start:a6,end:a3,step:a5,body:a2}},forGenericStatement:function(a4,a3,a2){return{type:"ForGenericStatement",variables:a4,iterators:a3,body:a2}},chunk:function(a2){return{type:"Chunk",body:a2}},identifier:function(a2){return{type:"Identifier",name:a2}},literal:function(a3,a4,a2){a3=(a3===aY)?"StringLiteral":(a3===aN)?"NumericLiteral":(a3===K)?"BooleanLiteral":(a3===ai)?"NilLiteral":"VarargLiteral";return{type:a3,value:a4,raw:a2}},tableKey:function(a2,a3){return{type:"TableKey",key:a2,value:a3}},tableKeyString:function(a2,a3){return{type:"TableKeyString",key:a2,value:a3}},tableValue:function(a2){return{type:"TableValue",value:a2}},tableConstructorExpression:function(a2){return{type:"TableConstructorExpression",fields:a2}},binaryExpression:function(a2,a5,a3){var a4=("and"===a2||"or"===a2)?"LogicalExpression":"BinaryExpression";return{type:a4,operator:a2,left:a5,right:a3}},unaryExpression:function(a2,a3){return{type:"UnaryExpression",operator:a2,argument:a3}},memberExpression:function(a4,a3,a2){return{type:"MemberExpression",indexer:a3,identifier:a2,base:a4}},indexExpression:function(a3,a2){return{type:"IndexExpression",base:a3,index:a2}},callExpression:function(a3,a2){return{type:"CallExpression",base:a3,"arguments":a2}},tableCallExpression:function(a3,a2){return{type:"TableCallExpression",base:a3,"arguments":a2}},stringCallExpression:function(a3,a2){return{type:"StringCallExpression",base:a3,argument:a2}},comment:function(a3,a2){return{type:"Comment",value:a3,raw:a2}}};function aM(a3){if(H){var a2=aI.pop();a2.complete();if(ab.locations){a3.loc=a2.loc}if(ab.ranges){a3.range=a2.range}}if(ab.onCreateNode){ab.onCreateNode(a3)}return a3}var u=Array.prototype.slice,at=Object.prototype.toString,l=function l(a5,a3){for(var a2=0,a4=a5.length;a2<a4;a2++){if(a5[a2]===a3){return a2}}return -1};function J(a6,a5,a3){for(var a2=0,a4=a6.length;a2<a4;a2++){if(a6[a2][a5]===a3){return a2}}return -1}function G(a3){var a2=u.call(arguments,1);a3=a3.replace(/%(\d)/g,function(a5,a4){return""+a2[a4-1]||""});return a3}function ae(){var a3=u.call(arguments),a2={},a6,a7;for(var a4=0,a5=a3.length;a4<a5;a4++){a6=a3[a4];for(a7 in a6){if(a6.hasOwnProperty(a7)){a2[a7]=a6[a7]}}}return a2}function W(a4){var a5=G.apply(null,u.call(arguments,1)),a3,a2;if("undefined"!==typeof a4.line){a2=a4.range[0]-a4.lineStart;a3=new SyntaxError(G("[%1:%2] %3",a4.line,a2,a5));a3.line=a4.line;a3.index=a4.range[0];a3.column=a2}else{a2=aT-aX+1;a3=new SyntaxError(G("[%1:%2] %3",n,a2,a5));a3.index=aT;a3.line=n;a3.column=a2}throw a3}function a1(a3,a2){W(a2,ao.expectedToken,a3,a2.value)}function an(a4,a3){if("undefined"===typeof a3){a3=B.value}if("undefined"!==typeof a4.type){var a2;switch(a4.type){case aY:a2="string";break;case o:a2="keyword";break;case ag:a2="identifier";break;case aN:a2="number";break;case p:a2="symbol";break;case K:a2="boolean";break;case ai:return W(a4,ao.unexpected,"symbol","nil",a3)}return W(a4,ao.unexpected,a2,a4.value,a3)}return W(a4,ao.unexpected,"symbol",a4,a3)}var aT,az,aA,B,aj,ah,n,aX;P.lex=aa;function aa(){aB();while(45===aZ.charCodeAt(aT)&&45===aZ.charCodeAt(aT+1)){ac();aB()}if(aT>=j){return{type:ak,value:"<eof>",line:n,lineStart:aX,range:[aT,aT]}}var a2=aZ.charCodeAt(aT),a3=aZ.charCodeAt(aT+1);ah=aT;if(t(a2)){return aR()}switch(a2){case 39:case 34:return Z();case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i();case 46:if(ar(a3)){return i()}if(46===a3){if(46===aZ.charCodeAt(aT+2)){return aP()}return D("..")}return D(".");case 61:if(61===a3){return D("==")}return D("=");case 62:if(61===a3){return D(">=")}if(62===a3){return D(">>")}return D(">");case 60:if(60===a3){return D("<<")}if(61===a3){return D("<=")}return D("<");case 126:if(61===a3){return D("~=")}return D("~");case 58:if(58===a3){return D("::")}return D(":");case 91:if(91===a3||61===a3){return T()}return D("[");case 47:if(47===a3){return D("//")}return D("/");case 42:case 94:case 37:case 44:case 123:case 124:case 125:case 93:case 40:case 41:case 59:case 38:case 35:case 45:case 43:return D(aZ.charAt(aT))}return an(aZ.charAt(aT))}function q(){var a2=aZ.charCodeAt(aT),a3=aZ.charCodeAt(aT+1);if(aU(a2)){if(10===a2&&13===a3){aT++}if(13===a2&&10===a3){aT++}n++;aX=++aT;return true}return false}function aB(){while(aT<j){var a2=aZ.charCodeAt(aT);if(aV(a2)){aT++}else{if(!q()){break}}}}function aR(){var a3,a2;while(aW(aZ.charCodeAt(++aT))){}a3=aZ.slice(ah,aT);if(d(a3)){a2=o}else{if("true"===a3||"false"===a3){a2=K;a3=("true"===a3)}else{if("nil"===a3){a2=ai;a3=null}else{a2=ag}}}return{type:a2,value:a3,line:n,lineStart:aX,range:[ah,aT]}}function D(a2){aT+=a2.length;return{type:p,value:a2,line:n,lineStart:aX,range:[ah,aT]}}function aP(){aT+=3;return{type:x,value:"...",line:n,lineStart:aX,range:[ah,aT]}}function Z(){var a3=aZ.charCodeAt(aT++),a5=aT,a4="",a2;while(aT<j){a2=aZ.charCodeAt(aT++);if(a3===a2){break}if(92===a2){a4+=aZ.slice(a5,aT-1)+C();a5=aT}else{if(aT>=j||aU(a2)){a4+=aZ.slice(a5,aT-1);W({},ao.unfinishedString,a4+String.fromCharCode(a2))}}}a4+=aZ.slice(a5,aT-1);return{type:aY,value:a4,line:n,lineStart:aX,range:[ah,aT]}}function T(){var a2=aG();if(false===a2){W(az,ao.expected,"[",az.value)}return{type:aY,value:a2,line:n,lineStart:aX,range:[ah,aT]}}function i(){var a4=aZ.charAt(aT),a2=aZ.charAt(aT+1);var a3=("0"===a4&&"xX".indexOf(a2||null)>=0)?I():R();return{type:aN,value:a3,line:n,lineStart:aX,range:[ah,aT]}}function I(){var a4=0,a3=1,a6=1,a8,a2,a7,a5;a5=aT+=2;if(!aD(aZ.charCodeAt(aT))){W({},ao.malformedNumber,aZ.slice(ah,aT))}while(aD(aZ.charCodeAt(aT))){aT++}a8=parseInt(aZ.slice(a5,aT),16);if("."===aZ.charAt(aT)){a2=++aT;while(aD(aZ.charCodeAt(aT))){aT++}a4=aZ.slice(a2,aT);a4=(a2===aT)?0:parseInt(a4,16)/Math.pow(16,aT-a2)}if("pP".indexOf(aZ.charAt(aT)||null)>=0){aT++;if("+-".indexOf(aZ.charAt(aT)||null)>=0){a6=("+"===aZ.charAt(aT++))?1:-1}a7=aT;if(!ar(aZ.charCodeAt(aT))){W({},ao.malformedNumber,aZ.slice(ah,aT))}while(ar(aZ.charCodeAt(aT))){aT++}a3=aZ.slice(a7,aT);a3=Math.pow(2,a3*a6)}return(a8+a4)*a3}function R(){while(ar(aZ.charCodeAt(aT))){aT++}if("."===aZ.charAt(aT)){aT++;while(ar(aZ.charCodeAt(aT))){aT++}}if("eE".indexOf(aZ.charAt(aT)||null)>=0){aT++;if("+-".indexOf(aZ.charAt(aT)||null)>=0){aT++}if(!ar(aZ.charCodeAt(aT))){W({},ao.malformedNumber,aZ.slice(ah,aT))}while(ar(aZ.charCodeAt(aT))){aT++}}return parseFloat(aZ.slice(ah,aT))}function C(){var a2=aT;switch(aZ.charAt(aT)){case"n":aT++;return"\n";case"r":aT++;return"\r";case"t":aT++;return"\t";case"v":aT++;return"\x0B";case"b":aT++;return"\b";case"f":aT++;return"\f";case"z":aT++;aB();return"";case"x":if(aD(aZ.charCodeAt(aT+1))&&aD(aZ.charCodeAt(aT+2))){aT+=3;return"\\"+aZ.slice(a2,aT)}return"\\"+aZ.charAt(aT++);default:if(ar(aZ.charCodeAt(aT))){while(ar(aZ.charCodeAt(++aT))){}return"\\"+aZ.slice(a2,aT)}return aZ.charAt(aT++)}}function ac(){ah=aT;aT+=2;var a5=aZ.charAt(aT),a4="",a7=false,a8=aT,a2=aX,a6=n;if("["===a5){a4=aG();if(false===a4){a4=a5}else{a7=true}}if(!a7){while(aT<j){if(aU(aZ.charCodeAt(aT))){break}aT++}if(ab.comments){a4=aZ.slice(a8,aT)}}if(ab.comments){var a3=au.comment(a4,aZ.slice(ah,aT));if(ab.locations){a3.loc={start:{line:a6,column:ah-a2},end:{line:n,column:aT-aX}}}if(ab.ranges){a3.range=[ah,aT]}if(ab.onCreateNode){ab.onCreateNode(a3)}aj.push(a3)}}function aG(){var a7=0,a5="",a2=false,a6,a3;aT++;while("="===aZ.charAt(aT+a7)){a7++}if("["!==aZ.charAt(aT+a7)){return false}aT+=a7+1;if(aU(aZ.charCodeAt(aT))){q()}a3=aT;while(aT<j){if(aU(aZ.charCodeAt(aT))){q()}a6=aZ.charAt(aT++);if("]"===a6){a2=true;for(var a4=0;a4<a7;a4++){if("="!==aZ.charAt(aT+a4)){a2=false}}if("]"!==aZ.charAt(aT+a7)){a2=false}}if(a2){break}}a5+=aZ.slice(a3,aT-1);aT+=a7+1;return a5}function af(){aA=az;az=B;B=aa()}function c(a2){if(a2===az.value){af();return true}return false}function r(a2){if(a2===az.value){af()}else{W(az,ao.expected,a2,az.value)}}function aV(a2){return 9===a2||32===a2||11===a2||12===a2}function aU(a2){return 10===a2||13===a2}function ar(a2){return a2>=48&&a2<=57}function aD(a2){return(a2>=48&&a2<=57)||(a2>=97&&a2<=102)||(a2>=65&&a2<=70)}function t(a2){return(a2>=65&&a2<=90)||(a2>=97&&a2<=122)||95===a2}function aW(a2){return(a2>=65&&a2<=90)||(a2>=97&&a2<=122)||95===a2||(a2>=48&&a2<=57)}function d(a2){switch(a2.length){case 2:return"do"===a2||"if"===a2||"in"===a2||"or"===a2;case 3:return"and"===a2||"end"===a2||"for"===a2||"not"===a2;case 4:return"else"===a2||"goto"===a2||"then"===a2;case 5:return"break"===a2||"local"===a2||"until"===a2||"while"===a2;case 6:return"elseif"===a2||"repeat"===a2||"return"===a2;case 8:return"function"===a2}return false}function aS(a2){if(p===a2.type){return"#-~".indexOf(a2.value)>=0}if(o===a2.type){return"not"===a2.value}return false}function aQ(a2){switch(a2.type){case"CallExpression":case"TableCallExpression":case"StringCallExpression":return true}return false}function h(a2){if(ak===a2.type){return true}if(o!==a2.type){return false}switch(a2.value){case"else":case"elseif":case"end":case"until":return true;default:return false}}var aq,aF,aL;function aJ(){var a2=Array.apply(null,aq[aF++]);aq.push(a2);if(ab.onCreateScope){ab.onCreateScope()}}function a0(){var a2=aq.pop();aF--;if(ab.onDestroyScope){ab.onDestroyScope()}}function X(a2){if(-1!==l(aq[aF],a2)){return}aq[aF].push(a2)}function Q(a2){X(a2.name);ad(a2,true)}function ad(a3,a2){if(!a2&&-1===J(aL,"name",a3.name)){aL.push(a3)}a3.isLocal=a2}function F(a2){return(-1!==l(aq[aF],a2))}var aI=[],H;function aw(){return new E(az)}function E(a2){if(ab.locations){this.loc={start:{line:a2.line,column:a2.range[0]-a2.lineStart},end:{line:0,column:0}}}if(ab.ranges){this.range=[a2.range[0],0]}}E.prototype.complete=function(){if(ab.locations){this.loc.end.line=aA.line;this.loc.end.column=aA.range[1]-aA.lineStart}if(ab.ranges){this.range[1]=aA.range[1]}};function aH(){if(H){aI.push(aw())}}function V(a2){if(H){aI.push(a2)}}function m(){af();aH();if(ab.scope){aJ()}var a2=M();if(ab.scope){a0()}if(ak!==az.type){an(az)}if(H&&!a2.length){aA=az}return aM(au.chunk(a2))}function M(a2){var a4=[],a3;while(!h(az)){if("return"===az.value){a4.push(L());break}a3=L();if(a3){a4.push(a3)}}return a4}function L(){aH();if(o===az.type){switch(az.value){case"local":af();return f();case"if":af();return s();case"return":af();return av();case"function":af();var a2=y();return Y(a2);case"while":af();return z();case"for":af();return aK();case"repeat":af();return ay();case"break":af();return b();case"do":af();return g();case"goto":af();return A()}}if(p===az.type){if(c("::")){return al()}}if(H){aI.pop()}if(c(";")){return}return U()}function al(){var a3=az.value,a2=v();if(ab.scope){X("::"+a3+"::");ad(a2,true)}r("::");return aM(au.labelStatement(a2))}function b(){return aM(au.breakStatement())}function A(){var a3=az.value,a2=v();return aM(au.gotoStatement(a2))}function g(){if(ab.scope){aJ()}var a2=M();if(ab.scope){a0()}r("end");return aM(au.doStatement(a2))}function z(){var a3=ap();r("do");if(ab.scope){aJ()}var a2=M();if(ab.scope){a0()}r("end");return aM(au.whileStatement(a3,a2))}function ay(){if(ab.scope){aJ()}var a2=M();r("until");var a3=ap();if(ab.scope){a0()}return aM(au.repeatStatement(a3,a2))}function av(){var a2=[];if("end"!==az.value){var a3=O();if(null!=a3){a2.push(a3)}while(c(",")){a3=ap();a2.push(a3)}c(";")}return aM(au.returnStatement(a2))}function s(){var a4=[],a5,a2,a3;if(H){a3=aI[aI.length-1];aI.push(a3)}a5=ap();r("then");if(ab.scope){aJ()}a2=M();if(ab.scope){a0()}a4.push(aM(au.ifClause(a5,a2)));if(H){a3=aw()}while(c("elseif")){V(a3);a5=ap();r("then");if(ab.scope){aJ()}a2=M();if(ab.scope){a0()}a4.push(aM(au.elseifClause(a5,a2)));if(H){a3=aw()}}if(c("else")){if(H){a3=new E(aA);aI.push(a3)}if(ab.scope){aJ()}a2=M();if(ab.scope){a0()}a4.push(aM(au.elseClause(a2)))}r("end");return aM(au.ifStatement(a4))}function aK(){var a4=v(),a2;if(ab.scope){aJ();Q(a4)}if(c("=")){var a9=ap();r(",");var a3=ap();var a6=c(",")?ap():null;r("do");a2=M();r("end");if(ab.scope){a0()}return aM(au.forNumericStatement(a4,a9,a3,a6,a2))}else{var a8=[a4];while(c(",")){a4=v();if(ab.scope){Q(a4)}a8.push(a4)}r("in");var a5=[];do{var a7=ap();a5.push(a7)}while(c(","));r("do");a2=M();r("end");if(ab.scope){a0()}return aM(au.forGenericStatement(a8,a5,a2))}}function f(){var a3;if(ag===az.type){var a7=[],a6=[];do{a3=v();a7.push(a3)}while(c(","));if(c("=")){do{var a5=ap();a6.push(a5)}while(c(","))}if(ab.scope){for(var a4=0,a2=a7.length;a4<a2;a4++){Q(a7[a4])}}return aM(au.localStatement(a7,a6))}if(c("function")){a3=v();if(ab.scope){Q(a3);aJ()}return Y(a3,true)}else{a1("<name>",az)}}function S(a2){if(a2.inParens||(["Identifier","MemberExpression","IndexExpression"].indexOf(a2.type)===-1)){W(az,ao.invalidVar,az.value)}}function U(){var a3=az,a6,a2;if(H){a2=aw()}a6=e();if(null==a6){return an(az)}if(",=".indexOf(az.value)>=0){var a7=[a6],a5=[],a4;S(a6);while(c(",")){a4=e();if(null==a4){a1("<expression>",az)}S(a4);a7.push(a4)}r("=");do{a4=ap();a5.push(a4)}while(c(","));V(a2);return aM(au.assignmentStatement(a7,a5))}if(aQ(a6)){V(a2);return aM(au.callStatement(a6))}return an(a3)}function v(){aH();var a2=az.value;if(ag!==az.type){a1("<name>",az)}af();return aM(au.identifier(a2))}function Y(a3,a5){var a4=[];r("(");if(!c(")")){while(true){if(ag===az.type){var a6=v();if(ab.scope){Q(a6)}a4.push(a6);if(c(",")){continue}else{if(c(")")){break}}}else{if(x===az.type){a4.push(a());r(")");break}else{a1("<name> or '...'",az)}}}}var a2=M();r("end");if(ab.scope){a0()}a5=a5||false;return aM(au.functionStatement(a3,a4,a5,a2))}function y(){var a4,a3,a2;if(H){a2=aw()}a4=v();if(ab.scope){ad(a4,F(a4.name));aJ()}while(c(".")){V(a2);a3=v();a4=aM(au.memberExpression(a4,".",a3))}if(c(":")){V(a2);a3=v();a4=aM(au.memberExpression(a4,":",a3));if(ab.scope){X("self")}}return a4}function w(){var a2=[],a3,a4;while(true){aH();if(p===az.type&&c("[")){a3=ap();r("]");r("=");a4=ap();a2.push(aM(au.tableKey(a3,a4)))}else{if(ag===az.type){if("="===B.value){a3=v();af();a4=ap();a2.push(aM(au.tableKeyString(a3,a4)))}else{a4=ap();a2.push(aM(au.tableValue(a4)))}}else{if(null==(a4=O())){aI.pop();break}a2.push(aM(au.tableValue(a4)))}}if(",;".indexOf(az.value)>=0){af();continue}break}r("}");return aM(au.tableConstructorExpression(a2))}function O(){var a2=aC(0);return a2}function ap(){var a2=O();if(null==a2){a1("<expression>",az)}else{return a2}}function aE(a3){var a2=a3.charCodeAt(0),a4=a3.length;if(1===a4){switch(a2){case 94:return 12;case 42:case 47:case 37:return 10;case 43:case 45:return 9;case 38:return 6;case 126:return 5;case 124:return 4;case 60:case 62:return 3}}else{if(2===a4){switch(a2){case 47:return 10;case 46:return 8;case 60:case 62:if("<<"===a3||">>"===a3){return 7}return 3;case 61:case 126:return 3;case 111:return 1}}else{if(97===a2&&"and"===a3){return 2}}}return 0}function aC(a8){var a4=az.value,a7,a3;if(H){a3=aw()}if(aS(az)){aH();af();var a6=aC(10);if(a6==null){a1("<expression>",az)}a7=aM(au.unaryExpression(a4,a6))}if(null==a7){a7=a();if(null==a7){a7=e()}}if(null==a7){return null}var a2;while(true){a4=az.value;a2=(p===az.type||o===az.type)?aE(a4):0;if(a2===0||a2<=a8){break}if("^"===a4||".."===a4){a2--}af();var a5=aC(a2);if(null==a5){a1("<expression>",az)}if(H){aI.push(a3)}a7=aM(au.binaryExpression(a4,a7,a5))}return a7}function e(){var a5,a4,a2;if(H){a2=aw()}if(ag===az.type){a4=az.value;a5=v();if(ab.scope){ad(a5,F(a4))}}else{if(c("(")){a5=ap();r(")");a5.inParens=true}else{return null}}var a6,a3;while(true){if(p===az.type){switch(az.value){case"[":V(a2);af();a6=ap();a5=aM(au.indexExpression(a5,a6));r("]");break;case".":V(a2);af();a3=v();a5=aM(au.memberExpression(a5,".",a3));break;case":":V(a2);af();a3=v();a5=aM(au.memberExpression(a5,":",a3));V(a2);a5=k(a5);break;case"(":case"{":V(a2);a5=k(a5);break;default:return a5}}else{if(aY===az.type){V(a2);a5=k(a5)}else{break}}}return a5}function k(a4){if(p===az.type){switch(az.value){case"(":af();var a3=[];var a5=O();if(null!=a5){a3.push(a5)}while(c(",")){a5=ap();a3.push(a5)}r(")");return aM(au.callExpression(a4,a3));case"{":aH();af();var a2=w();return aM(au.tableCallExpression(a4,a2))}}else{if(aY===az.type){return aM(au.stringCallExpression(a4,a()))}}a1("function arguments",az)}function a(){var a6=aY|aN|K|ai|x,a5=az.value,a4=az.type,a2;if(H){a2=aw()}if(a4&a6){V(a2);var a3=aZ.slice(az.range[0],az.range[1]);af();return aM(au.literal(a4,a5,a3))}else{if(o===a4&&"function"===a5){V(a2);af();if(ab.scope){aJ()}return Y(null)}else{if(c("{")){V(a2);return w()}}}}P.parse=am;function am(a3,a2){if("undefined"===typeof a2&&"object"===typeof a3){a2=a3;a3=undefined}if(!a2){a2={}}aZ=a3||"";ab=ae(ax,a2);aT=0;n=1;aX=0;j=aZ.length;aq=[[]];aF=0;aL=[];aI=[];if(ab.comments){aj=[]}if(!ab.wait){return N()}return P}P.write=aO;function aO(a2){aZ+=String(a2);j=aZ.length;return P}P.end=N;function N(a3){if("undefined"!==typeof a3){aO(a3)}if(aZ&&aZ.substr(0,2)==="#!"){aZ=aZ.replace(/^.*/,function(a4){return a4.replace(/./g," ")})}j=aZ.length;H=ab.locations||ab.ranges;B=aa();var a2=m();if(ab.comments){a2.comments=aj}if(ab.scope){a2.globals=aL}if(aI.length>0){throw new Error("Location tracking failed. This is most likely a bug in luaparse")}return a2}}));"use strict";Blockly.Blocks.factory_base={init:function(){this.setColour(120);this.appendDummyInput().appendField("name").appendField(new Blockly.FieldTextInput("block_type"),"NAME");this.appendStatementInput("INPUTS").setCheck("Input").appendField("inputs");var a=new Blockly.FieldDropdown([["automatic inputs","AUTO"],["external inputs","EXT"],["inline inputs","INT"]]);this.appendDummyInput().appendField(a,"INLINE");a=new Blockly.FieldDropdown([["no connections","NONE"],["← left output","LEFT"],["↕ top+bottom connections","BOTH"],["↑ top connection","TOP"],["↓ bottom connection","BOTTOM"]],function(b){this.sourceBlock_.updateShape_(b);this.sourceBlock_.spawnOutputShadow_(b)});this.appendDummyInput().appendField(a,"CONNECTIONS");this.appendValueInput("TOOLTIP").setCheck("String").appendField("tooltip");this.appendValueInput("HELPURL").setCheck("String").appendField("help url");this.appendValueInput("COLOUR").setCheck("Colour").appendField("colour");this.setTooltip("Build a custom block by plugging\nfields, inputs and other blocks here.");this.setHelpUrl("https://developers.google.com/blockly/guides/create-custom-blocks/block-factory")},mutationToDom:function(){var a=document.createElement("mutation");a.setAttribute("connections",this.getFieldValue("CONNECTIONS"));return a},domToMutation:function(b){var a=b.getAttribute("connections");this.updateShape_(a)},spawnOutputShadow_:function(a){switch(a){case"LEFT":this.connectOutputShadow_("OUTPUTTYPE");break;case"TOP":this.connectOutputShadow_("TOPTYPE");break;case"BOTTOM":this.connectOutputShadow_("BOTTOMTYPE");break;case"BOTH":this.connectOutputShadow_("TOPTYPE");this.connectOutputShadow_("BOTTOMTYPE");break}},connectOutputShadow_:function(b){var a=this.workspace.newBlock("type_null");a.setShadow(true);a.outputConnection.connect(this.getInput(b).connection);a.initSvg();a.render()},updateShape_:function(c){var d=this.getInput("OUTPUTTYPE");var a=this.getInput("TOPTYPE");var b=this.getInput("BOTTOMTYPE");if(c=="LEFT"){if(!d){this.addTypeInput_("OUTPUTTYPE","output type")}}else{if(d){this.removeInput("OUTPUTTYPE")}}if(c=="TOP"||c=="BOTH"){if(!a){this.addTypeInput_("TOPTYPE","top type")}}else{if(a){this.removeInput("TOPTYPE")}}if(c=="BOTTOM"||c=="BOTH"){if(!b){this.addTypeInput_("BOTTOMTYPE","bottom type")}}else{if(b){this.removeInput("BOTTOMTYPE")}}},addTypeInput_:function(b,a){this.appendValueInput(b).setCheck("Type").appendField(a);this.moveInputBefore(b,"COLOUR")}};var FIELD_MESSAGE="fields %1 %2";var FIELD_ARGS=[{type:"field_dropdown",name:"ALIGN",options:[["left","LEFT"],["right","RIGHT"],["centre","CENTRE"]]},{type:"input_statement",name:"FIELDS",check:"Field"}];var TYPE_MESSAGE="type %1";var TYPE_ARGS=[{type:"input_value",name:"TYPE",check:"Type",align:"RIGHT"}];Blockly.Blocks.input_value={init:function(){this.jsonInit({message0:"value input %1 %2",args0:[{type:"field_input",name:"INPUTNAME",text:"NAME"},{type:"input_dummy"}],message1:FIELD_MESSAGE,args1:FIELD_ARGS,message2:TYPE_MESSAGE,args2:TYPE_ARGS,previousStatement:"Input",nextStatement:"Input",colour:210,tooltip:"A value socket for horizontal connections.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=71"})},onchange:function(){inputNameCheck(this)}};Blockly.Blocks.input_statement={init:function(){this.jsonInit({message0:"statement input %1 %2",args0:[{type:"field_input",name:"INPUTNAME",text:"NAME"},{type:"input_dummy"}],message1:FIELD_MESSAGE,args1:FIELD_ARGS,message2:TYPE_MESSAGE,args2:TYPE_ARGS,previousStatement:"Input",nextStatement:"Input",colour:210,tooltip:"A statement socket for enclosed vertical stacks.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=246"})},onchange:function(){inputNameCheck(this)}};Blockly.Blocks.input_dummy={init:function(){this.jsonInit({message0:"dummy input",message1:FIELD_MESSAGE,args1:FIELD_ARGS,previousStatement:"Input",nextStatement:"Input",colour:210,tooltip:"For adding fields on a separate row with no connections. Alignment options (left, right, centre) apply only to multi-line fields.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=293"})}};Blockly.Blocks.field_static={init:function(){this.setColour(160);this.appendDummyInput().appendField("text").appendField(new Blockly.FieldTextInput(""),"TEXT");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Static text that serves as a label.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=88")}};Blockly.Blocks.field_input={init:function(){this.setColour(160);this.appendDummyInput().appendField("text input").appendField(new Blockly.FieldTextInput("default"),"TEXT").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("An input field for the user to enter text.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=319")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_number={init:function(){this.setColour(160);this.appendDummyInput().appendField("numeric input").appendField(new Blockly.FieldNumber(0),"VALUE").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.appendDummyInput().appendField("min").appendField(new Blockly.FieldNumber(-Infinity),"MIN").appendField("max").appendField(new Blockly.FieldNumber(Infinity),"MAX").appendField("precision").appendField(new Blockly.FieldNumber(0,0),"PRECISION");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("An input field for the user to enter a number.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=319")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_angle={init:function(){this.setColour(160);this.appendDummyInput().appendField("angle input").appendField(new Blockly.FieldAngle("90"),"ANGLE").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("An input field for the user to enter an angle.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=372")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_dropdown={init:function(){this.appendDummyInput().appendField("dropdown").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.optionList_=["text","text","text"];this.updateShape_();this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setMutator(new Blockly.Mutator(["field_dropdown_option_text","field_dropdown_option_image"]));this.setColour(160);this.setTooltip("Dropdown menu with a list of options.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386")},mutationToDom:function(b){var a=document.createElement("mutation");a.setAttribute("options",JSON.stringify(this.optionList_));return a},domToMutation:function(a){var c=JSON.parse(a.getAttribute("options"));if(typeof c=="number"){this.optionList_=[];for(var b=0;b<c;b++){this.optionList_.push("text")}}else{this.optionList_=c}this.updateShape_()},decompose:function(d){var a=d.newBlock("field_dropdown_container");a.initSvg();var c=a.getInput("STACK").connection;for(var e=0;e<this.optionList_.length;e++){var b=d.newBlock("field_dropdown_option_"+this.optionList_[e]);b.initSvg();c.connect(b.previousConnection);c=b.nextConnection}return a},compose:function(b){var c=b.getInputTargetBlock("STACK");this.optionList_.length=0;var e=[];while(c){if(c.type=="field_dropdown_option_text"){this.optionList_.push("text")}else{if(c.type=="field_dropdown_option_image"){this.optionList_.push("image")}}e.push([c.userData_,c.cpuData_]);c=c.nextConnection&&c.nextConnection.targetBlock()}this.updateShape_();for(var d=0;d<this.optionList_.length;d++){var a=e[d][0];if(a!==undefined){if(typeof a=="string"){this.setFieldValue(a||"option","USER"+d)}else{this.setFieldValue(a.src,"SRC"+d);this.setFieldValue(a.width,"WIDTH"+d);this.setFieldValue(a.height,"HEIGHT"+d);this.setFieldValue(a.alt,"ALT"+d)}this.setFieldValue(e[d][1]||"OPTIONNAME","CPU"+d)}}},saveConnections:function(a){var b=a.getInputTargetBlock("STACK");var c=0;while(b){b.userData_=this.getUserData(c);b.cpuData_=this.getFieldValue("CPU"+c);c++;b=b.nextConnection&&b.nextConnection.targetBlock()}},updateShape_:function(){var a=0;while(this.getInput("OPTION"+a)){this.removeInput("OPTION"+a);this.removeInput("OPTION_IMAGE"+a,true);a++}var c="https://www.gstatic.com/codesite/ph/images/star_on.gif";for(var a=0;a<=this.optionList_.length;a++){var b=this.optionList_[a];if(b=="text"){this.appendDummyInput("OPTION"+a).appendField("•").appendField(new Blockly.FieldTextInput("option"),"USER"+a).appendField(",").appendField(new Blockly.FieldTextInput("OPTIONNAME"),"CPU"+a)}else{if(b=="image"){this.appendDummyInput("OPTION"+a).appendField("•").appendField("image").appendField(new Blockly.FieldTextInput(c),"SRC"+a);this.appendDummyInput("OPTION_IMAGE"+a).appendField(" ").appendField("width").appendField(new Blockly.FieldNumber("15",0,NaN,1),"WIDTH"+a).appendField("height").appendField(new Blockly.FieldNumber("15",0,NaN,1),"HEIGHT"+a).appendField("alt text").appendField(new Blockly.FieldTextInput("*"),"ALT"+a).appendField(",").appendField(new Blockly.FieldTextInput("OPTIONNAME"),"CPU"+a)}}}},onchange:function(){if(this.workspace&&this.optionList_.length<1){this.setWarningText("Drop down menu must\nhave at least one option.")}else{fieldNameCheck(this)}},getUserData:function(a){if(this.optionList_[a]=="text"){return this.getFieldValue("USER"+a)}if(this.optionList_[a]=="image"){return{src:this.getFieldValue("SRC"+a),width:Number(this.getFieldValue("WIDTH"+a)),height:Number(this.getFieldValue("HEIGHT"+a)),alt:this.getFieldValue("ALT"+a)}}throw"Unknown dropdown type"}};Blockly.Blocks.field_dropdown_container={init:function(){this.setColour(160);this.appendDummyInput().appendField("add options");this.appendStatementInput("STACK");this.setTooltip("Add, remove, or reorder options\nto reconfigure this dropdown menu.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386");this.contextMenu=false}};Blockly.Blocks.field_dropdown_option_text={init:function(){this.setColour(160);this.appendDummyInput().appendField("text option");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("Add a new text option to the dropdown menu.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386");this.contextMenu=false}};Blockly.Blocks.field_dropdown_option_image={init:function(){this.setColour(160);this.appendDummyInput().appendField("image option");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("Add a new image option to the dropdown menu.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386");this.contextMenu=false}};Blockly.Blocks.field_checkbox={init:function(){this.setColour(160);this.appendDummyInput().appendField("checkbox").appendField(new Blockly.FieldCheckbox("TRUE"),"CHECKED").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Checkbox field.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=485")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_colour={init:function(){this.setColour(160);this.appendDummyInput().appendField("colour").appendField(new Blockly.FieldColour("#ff0000"),"COLOUR").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Colour input field.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=495")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_date={init:function(){this.setColour(160);this.appendDummyInput().appendField("date").appendField(new Blockly.FieldDate(),"DATE").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Date input field.")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_variable={init:function(){this.setColour(160);this.appendDummyInput().appendField("variable").appendField(new Blockly.FieldTextInput("item"),"TEXT").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Dropdown menu for variable names.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=510")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_image={init:function(){this.setColour(160);var a="https://www.gstatic.com/codesite/ph/images/star_on.gif";this.appendDummyInput().appendField("image").appendField(new Blockly.FieldTextInput(a),"SRC");this.appendDummyInput().appendField("width").appendField(new Blockly.FieldNumber("15",0,NaN,1),"WIDTH").appendField("height").appendField(new Blockly.FieldNumber("15",0,NaN,1),"HEIGHT").appendField("alt text").appendField(new Blockly.FieldTextInput("*"),"ALT");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Static image (JPEG, PNG, GIF, SVG, BMP).\nRetains aspect ratio regardless of height and width.\nAlt text is for when collapsed.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=567")}};Blockly.Blocks.type_group={init:function(){this.typeCount_=2;this.updateShape_();this.setOutput(true,"Type");this.setMutator(new Blockly.Mutator(["type_group_item"]));this.setColour(230);this.setTooltip("Allows more than one type to be accepted.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=677")},mutationToDom:function(b){var a=document.createElement("mutation");a.setAttribute("types",this.typeCount_);return a},domToMutation:function(a){this.typeCount_=parseInt(a.getAttribute("types"),10);this.updateShape_();for(var c=0;c<this.typeCount_;c++){this.removeInput("TYPE"+c)}for(var c=0;c<this.typeCount_;c++){var b=this.appendValueInput("TYPE"+c).setCheck("Type");if(c==0){b.appendField("any of")}}},decompose:function(c){var a=c.newBlock("type_group_container");a.initSvg();var b=a.getInput("STACK").connection;for(var d=0;d<this.typeCount_;d++){var e=c.newBlock("type_group_item");e.initSvg();b.connect(e.previousConnection);b=e.nextConnection}return a},compose:function(a){var e=a.getInputTargetBlock("STACK");var d=[];while(e){d.push(e.valueConnection_);e=e.nextConnection&&e.nextConnection.targetBlock()}for(var c=0;c<this.typeCount_;c++){var b=this.getInput("TYPE"+c).connection.targetConnection;if(b&&d.indexOf(b)==-1){b.disconnect()}}this.typeCount_=d.length;this.updateShape_();for(var c=0;c<this.typeCount_;c++){Blockly.Mutator.reconnect(d[c],this,"TYPE"+c)}},saveConnections:function(a){var d=a.getInputTargetBlock("STACK");var c=0;while(d){var b=this.getInput("TYPE"+c);d.valueConnection_=b&&b.connection.targetConnection;c++;d=d.nextConnection&&d.nextConnection.targetBlock()}},updateShape_:function(){for(var b=0;b<this.typeCount_;b++){if(!this.getInput("TYPE"+b)){var a=this.appendValueInput("TYPE"+b);if(b==0){a.appendField("any of")}}}while(this.getInput("TYPE"+b)){this.removeInput("TYPE"+b);b++}}};Blockly.Blocks.type_group_container={init:function(){this.jsonInit({message0:"add types %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],colour:230,tooltip:"Add, or remove allowed type.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=677"})}};Blockly.Blocks.type_group_item={init:function(){this.jsonInit({message0:"type",previousStatement:null,nextStatement:null,colour:230,tooltip:"Add a new allowed type.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=677"})}};Blockly.Blocks.type_null={valueType:null,init:function(){this.jsonInit({message0:"any",output:"Type",colour:230,tooltip:"Any type is allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_boolean={valueType:"Boolean",init:function(){this.jsonInit({message0:"Boolean",output:"Type",colour:230,tooltip:"Booleans (true/false) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_number={valueType:"Number",init:function(){this.jsonInit({message0:"Number",output:"Type",colour:230,tooltip:"Numbers (int/float) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_string={valueType:"String",init:function(){this.jsonInit({message0:"String",output:"Type",colour:230,tooltip:"Strings (text) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_list={valueType:"Array",init:function(){this.jsonInit({message0:"Array",output:"Type",colour:230,tooltip:"Arrays (lists) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_other={init:function(){this.jsonInit({message0:"other %1",args0:[{type:"field_input",name:"TYPE",text:""}],output:"Type",colour:230,tooltip:"Custom type to allow.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=702"})}};Blockly.Blocks.colour_hue={init:function(){this.appendDummyInput().appendField("hue:").appendField(new Blockly.FieldAngle("0",this.validator),"HUE");this.setOutput(true,"Colour");this.setTooltip("Paint the block with this colour.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=55")},validator:function(b){var a=parseInt(b,10);if(!isNaN(a)){this.sourceBlock_.setColour(a)}},mutationToDom:function(b){var a=document.createElement("mutation");a.setAttribute("colour",this.getColour());return a},domToMutation:function(a){this.setColour(a.getAttribute("colour"))}};function fieldNameCheck(h){if(!h.workspace){return}var b=h.getFieldValue("FIELDNAME").toLowerCase();var d=0;var g=h.workspace.getAllBlocks();for(var c=0,f;f=g[c];c++){var a=f.getFieldValue("FIELDNAME");if(!f.disabled&&!f.getInheritedDisabled()&&a&&a.toLowerCase()==b){d++}}var e=(d>1)?"There are "+d+" field blocks\n with this name.":null;h.setWarningText(e)}function inputNameCheck(h){if(!h.workspace){return}var b=h.getFieldValue("INPUTNAME").toLowerCase();var d=0;var g=h.workspace.getAllBlocks();for(var c=0,f;f=g[c];c++){var a=f.getFieldValue("INPUTNAME");if(!f.disabled&&!f.getInheritedDisabled()&&a&&a.toLowerCase()==b){d++}}var e=(d>1)?"There are "+d+" input blocks\n with this name.":null;h.setWarningText(e)};function blockLibrary(){this.id="";this.def={};this.workDef={}}blockLibrary.prototype.load=function(h,g){var e=this;if(e.id==h){return}if((typeof require!="undefined")&&(typeof require("nw.gui")!="undefined")){var a=require("fs");var f=require("path");var d="library/defs/"+h+".json";var c=f.join(process.cwd(),d);try{e.def=JSON.parse(a.readFileSync(c,"utf8"));e.workDef=JSON.parse(a.readFileSync(c,"utf8"));e.id=h;g()}catch(b){g();return}}else{jQuery.ajax({url:Code.folder+"/library/defs/"+h+".json",success:function(i){e.def=i;e.workDef=i;e.id=h;g();return},error:function(){g()}})}};blockLibrary.prototype.update=function(){var d=this;if((typeof require!="undefined")&&(typeof require("nw.gui")!="undefined")){var a=require("fs");var e=require("path");var c="library/defs/"+d.id+".json";var b=e.join(process.cwd(),c);a.writeFileSync(b,JSON.stringify(d.def,function(g,f){return f},2));d.id=""}};blockLibrary.prototype.replace=function(template,char1,char2,block){var code="";var id="";for(var i=0;i<template.length;i++){if(template.charAt(i)==char1){if(i+1<template.length){i++;if(template.charAt(i)==char1){if(i+1<template.length){i++;id="";for(;i<template.length;i++){if(template.charAt(i)==char2){if(i+1<template.length){i++;if(template.charAt(i)==char2){if(char2=="%"){code=code+block[id];break}else{if(char2=="$"){code=code+"'"+eval("block.getFieldValue('"+id+"')")+"'";break}else{if(char2=="@"){code=code+eval("Blockly.Lua.valueToCode(block, id, Blockly.Lua.ORDER_NONE)");break}else{if(char2=="}"){code=code+eval(id);break}}}}}else{code+=id+template.charAt(i)}}else{code+=id+template.charAt(i)}}else{id+=template.charAt(i)}}}else{code+=template.charAt(i)}}else{code+=template.charAt(i)}}else{code+=template.charAt(i)}}else{code+=template.charAt(i)}}return code};blockLibrary.prototype.create=function(c,b){var h=this;Blockly.Blocks[b.spec.type]={init:function(){this.jsonInit(b.spec);for(var k in b.interactiveFields){this.updateBoardAtFieldChange(b.interactiveFields[k])}}};Blockly.Lua[b.spec.type]=function(k){var m=atob(b.code);var n="";for(var l in b.dependency){if(codeSection.require.indexOf('require("'+b.dependency[l]+'")')==-1){codeSection.require.push('require("'+b.dependency[l]+'")')}}n=h.replace(m,"$","$",k);n=h.replace(n,"%","%",k);n=h.replace(n,"@","@",k);n=h.replace(n,"{","}",k);return n+"\n"};var d=goog.dom.createDom("block");d.setAttribute("type",b.spec.type);for(var a in b.spec){if(/args[0-9]*/.test(a)){for(var j in b.spec[a]){if(b.spec[a][j].type=="input_value"){if(typeof b.shadow[b.spec[a][j].name]!="undefined"){var e=goog.dom.createDom("field",null,b.shadow[b.spec[a][j].name].value);e.setAttribute("name",b.shadow[b.spec[a][j].name].name);var i=goog.dom.createDom("shadow");i.setAttribute("type",b.shadow[b.spec[a][j].name].type);i.appendChild(e);var g=goog.dom.createDom("value");g.setAttribute("name",b.spec[a][j].name);g.appendChild(i);d.appendChild(g)}}}}}var f=jQuery("<toolbar>"+c+"</toolbar>");f.find("category[id='"+b.category+"']").append(jQuery(d)).html();return f.html()};blockLibrary.prototype.get=function(xml,id,callback){var thisInstance=this;if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){this.load(id,function(){var blocks=thisInstance.workDef.blocks;for(var i=0;i<blocks.length;i++){var block=blocks[i];var spec=block.spec;for(var prop in spec){if(/message[0-9]*/.test(prop)){block.spec[prop]=block.msg[Code.settings.language][prop]}}for(var prop in spec){if(/args[0-9]*/.test(prop)){for(var arg in spec[prop]){if((spec[prop][arg].type=="field_dropdown")&&(!jQuery.isArray(spec[prop][arg].options))){spec[prop][arg].options=eval(spec[prop][arg].options)}}}}if(isNaN(parseInt(spec.colour))){spec.colour=eval(spec.colour)}xml=thisInstance.create(xml,block)}callback(xml)})}else{callback(xml)}}else{callback(xml)}};"use strict";function isChrome(){var f=window.chrome,a=window.navigator,e=a.vendor,c=a.userAgent.indexOf("OPR")>-1,d=a.userAgent.indexOf("Edge")>-1,b=a.userAgent.match("CriOS");if(b){return true}else{if(f!==null&&f!==undefined&&e==="Google Inc."&&c==false&&d==false){return true}else{return false}}}Blockly.Lua.developerMode=true;var Code={};if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){Code.folder=""}else{Code.folder="https://ide.whitecatboard.org"}}else{Code.folder="https://ide.whitecatboard.org"}Code.server="https://ide.whitecatboard.org";Code.cloud=null;var blockAbstraction={Low:0,High:1};Code.blockAbstraction=blockAbstraction.High;Code.storage={};Code.minAgentVersion="1.6";Code.checkNewFirmwareVersion=true;Code.checkNewAgentVersion=true;Code.showCode=false;Code.storage.board=null;Code.storage.local=null;Code.storage.cloud=null;Code.defaultStatus={cpu:"ESP32",connected:false,modules:{thread:true,nvs:true,pack:true,i2c:true,can:true,pio:true,adc:true,pwm:true,tft:true,spi:true,tmr:true,uart:true,lora:true,mqtt:true,sensor:true,servo:true,net:true},maps:[],sensors:[]};Code.devices=[{vendorId:"0x10c4",productId:"0xea60",vendor:"Silicon Labs"},{vendorId:"0x403",productId:"0x6015",vendor:"FTDI"},{vendorId:"0x403",productId:"0x6001",vendor:"FTDI"},{vendorId:"0x1a86",productId:"0x7523",vendor:"CH340"}];Code.status=JSON.parse(JSON.stringify(Code.defaultStatus));Code.platforms=["MacIntel","Win32","Linux x86_64"];Code.progressDialog=false;Code.currentFile={id:null,path:"/",file:"",storage:StorageType.Computer,changes:false};Code.settings={language:"en",board:"N1ESP32",programmingModel:"blocks"};Code.LANGUAGE_NAME={en:"English",ca:"Català",es:"Español"};Code.LANGUAGE_RTL=[];Code.workspace={};Code.workspace.type="blocks";Code.workspace.prevType=Code.workspace.type;Code.workspace.blocks=null;Code.workspace.editor=null;Code.workspace.block_editor=null;Code.workspace.block_editorCode=null;Code.isRtl=function(){return Code.LANGUAGE_RTL.indexOf(Code.settings.language)!=-1};Code.defaultStorage=function(){if(Code.status.connected){return StorageType.Board}else{return StorageType.Computer}};Code.setDefaultStorage=function(){Code.currentFile.id=null;Code.currentFile.path="/";Code.currentFile.file="";Code.currentFile.storage=StorageType.Computer;Code.currentFile.changes=Code.defaultStorage();Code.renderStorage(StorageType.None,Code.currentFile.path,jQuery("#targetFile"))};Code.renderStorage=function(f,c,e){if(f==StorageType.None){if(e.attr("id")=="targetFile"){e.html("");return}}if(e.attr("id")=="targetFile"){var b=c.split("/");c=b[b.length-1]}else{var b=c.split("/");c="";for(var a=0;a<b.length;a++){if(b[a]!=""){if(c!=""){c=c+"/"}c=c+b[a]}}c="/"+c;if(c!="/"){c=c+"/"}}var d="";if(f==StorageType.Board){d='<span><span class="icon icon-chip" style="font-size: 14px;" aria-hidden="true"></span></span>&nbsp;'}else{if(f==StorageType.Computer){d='<span><span class="icon icon-display" style="font-size: 14px;" aria-hidden="true"></span></span>&nbsp;'}else{if(f==StorageType.Cloud){d='<span><span class="icon icon-cloud" style="font-size: 14px;" aria-hidden="true"></span></span>&nbsp;'}}}if(e.attr("id")!="targetFile"){e.html("&nbsp;&nbsp;"+d+"&nbsp;&nbsp;"+c)}else{e.html("|&nbsp;&nbsp;"+d+c)}};Code.setCurrentStorage=function(h,e,c,g){if(typeof e=="undefined"){var b=c.split("/");var d="";var f="";for(var a=0;a<b.length-1;a++){if(b[a]!=""){d=d+"/"+b[a]}}if(d==""){d="/"}else{d=d+"/"}f=b[b.length-1];e=d;c=f}if(h!=StorageType.Cloud){Code.currentFile.path=e;Code.currentFile.id=null}else{Code.currentFile.path=e;Code.currentFile.id=g;c=c.replace(/\/.*\//g,"")}Code.currentFile.file=c;Code.currentFile.storage=h;Code.currentFile.changes=false;Code.renderStorage(h,Code.getCurrentFullPath(),jQuery("#targetFile"))};Code.getCurrentFullPath=function(){var a;if(typeof Code.currentFile.path=="undefined"){Code.currentFile.path=""}a=Code.currentFile.path;a=a.replace(/[\\\/]+/g,"/");if(a.charAt(0)!="/"){a="/"+a}a+=Code.currentFile.file;a=a.replace(/[\\\/]+/g,"/");return a};Code.getPathFor=function(b,a){var c;if(typeof b=="undefined"){b=""}if(b==""){c=Code.currentFile.path}else{c=b}if(typeof a=="undefined"){a=""}if(a==""){a=Code.currentFile.file}c=c.replace(/[\\\/]+/g,"/");if(c.charAt(0)!="/"){c="/"+c}if(c!="/"){c+="/"}c+=a;c=c.replace(/[\\\/]+/g,"/");return c};Code.loadBlocks=function(b){try{var d=window.sessionStorage.loadOnceBlocks}catch(c){var d=null}if("BlocklyStorage" in window&&window.location.hash.length>1){BlocklyStorage.retrieveXml(window.location.hash.substring(1))}else{if(d){delete window.sessionStorage.loadOnceBlocks;var a=Blockly.Xml.textToDom(d);Blockly.Xml.domToWorkspace(a,Code.workspace.blocks);Code.workspace.blocks.scrollCenter()}else{if(b){var a=Blockly.Xml.textToDom(b);Blockly.Xml.domToWorkspace(a,Code.workspace.blocks);Code.workspace.blocks.scrollCenter()}else{if("BlocklyStorage" in window){window.setTimeout(BlocklyStorage.restoreBlocks,0)}}}}};Code.changeLanguage=function(){if(typeof Blockly!="undefined"&&window.sessionStorage){var b=Blockly.Xml.workspaceToDom(Code.workspace.blocks);var e=Blockly.Xml.domToText(b);window.sessionStorage.loadOnceBlocks=e}var a=document.getElementById("languageMenu");var d=encodeURIComponent(a.options[a.selectedIndex].value);var c=window.location.search;if(c.length<=1){c="?lang="+d}else{if(c.match(/[?&]lang=[^&]*/)){c=c.replace(/([?&]lang=)[^&]*/,"$1"+d)}else{c=c.replace(/\?/,"?lang="+d+"&")}}Code.settings.language=d;Settings.save(Code.settings)};Code.bindClick=function(a,b){if(typeof a=="string"){a=document.getElementById(a)}a.addEventListener("click",b,true);a.addEventListener("touchend",b,true)};Code.importPrettify=function(){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("href",Code.folder+"/prettify.css");document.head.appendChild(b);var a=document.createElement("script");a.setAttribute("src",Code.folder+"/prettify.js");document.head.appendChild(a)};Code.getBBox_=function(c){var b=c.offsetHeight;var d=c.offsetWidth;var a=0;var e=0;do{a+=c.offsetLeft;e+=c.offsetTop;c=c.offsetParent}while(c);return{height:b,width:d,x:a,y:e}};Code.TABS_=["program"];Code.selected="program";Code.tabClick=function(a){if(document.getElementById("tab_program").className=="tabon"){jQuery("#content_editor").css("visibility","hidden");jQuery(".blocklyWidgetDiv").css("visibility","hidden");jQuery(".blocklyTooltipDiv").css("visibility","hidden");jQuery(".blocklyToolboxDiv").css("visibility","hidden");jQuery("#content_blocks").css("visibility","hidden");Code.workspace.blocks.setVisible(false)}for(var c=0;c<Code.TABS_.length;c++){var b=Code.TABS_[c];document.getElementById("tab_"+b).className="taboff";jQuery("#content_"+b).css("visibility","hidden")}Code.selected=a;document.getElementById("tab_"+a).className="tabon";jQuery("#content_"+a).css("visibility","visible");if(Code.workspace.type=="blocks"){jQuery("#tab_program").text(MSG.blocks)}else{jQuery("#tab_program").text(MSG.editor)}Code.renderContent();jQuery("#tab_board").text(MSG.board);jQuery("#tab_"+a).trigger("click");if(Code.selected=="program"){if(Code.workspace.type=="blocks"){jQuery("#content_editor").hide()}else{if(Code.workspace.type=="editor"){jQuery("#content_editor").show()}else{if(Code.workspace.type=="block_editor"){jQuery("#content_block_editor").show()}}}}else{jQuery("#content_editor").hide();jQuery("#content_block_editor").hide()}window.dispatchEvent(new Event("resize"))};Code.renderContent=function(){var a=document.getElementById("content_"+Code.selected);Code.tabRefresh();if(Code.workspace.type=="blocks"){jQuery("#content_block_editor").css("visibility","hidden");jQuery("#content_editor").css("visibility","hidden");jQuery("#content_blocks").css("visibility","visible");jQuery("#content_blocks").find(".injectionDiv").css("visibility","visible");jQuery("#content_block_editor").find(".injectionDiv").css("visibility","hidden");if(Code.workspace.blocks){Code.workspace.blocks.setVisible(true);Code.updateToolBox()}}else{if(Code.workspace.type=="editor"){jQuery("#content_blocks").css("visibility","hidden");jQuery("#content_editor").css("visibility","visible");jQuery("#content_block_editor").css("visibility","hidden");if(Code.workspace.blocks){Code.workspace.blocks.setVisible(false)}}else{if(Code.workspace.type=="block_editor"){Code.blocklyFactory.init();jQuery("#content_blocks").css("visibility","hidden");jQuery("#content_editor").css("visibility","hidden");jQuery("#content_block_editor").css("visibility","visible");jQuery("#content_blocks").find(".injectionDiv").css("visibility","hidden");jQuery("#content_block_editor").find(".injectionDiv").css("visibility","visible");if(Code.workspace.blocks){Code.workspace.blocks.setVisible(false)}}}}window.dispatchEvent(new Event("resize"))};Code.buildToolBox=function(b){var a="";a+='<category id="catEvents"><block type="when_board_starts"></block><block type="thread"></block><block type="execute_every"><value name="TIME"><shadow type="math_number"><field name="NUM"></field></shadow></block><block type="when_i_receive"></block><block type="broadcast"></block><block type="broadcast_and_wait"></block><block type="event_is_being_processed"></block></category><category id="catControl"><category id="catLoops"><block type="controls_repeat_ext"><value name="TIMES"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="controls_whileUntil"></block><block type="controls_for"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="BY"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="controls_forEach"></block><block type="controls_flow_statements"></block></category><category id="catLogic"><block type="controls_if"></block><block type="logic_ternary"></block><block type="bitlogic_msb"></block><block type="bitlogic_lsb"></block></category><category id="catExceptions"><block type="exception_try"></block><block type="exception_catch_error"></block><block type="exception_raise_again"></block></category><category id="catDelays"><block type="wait_for"><value name="TIME"><shadow type="math_number"><field name="NUM"></field></shadow></block><block type="cpu_sleep"><value name="SECONDS"><shadow type="math_number"><field name="NUM"></field></shadow></value></block></category></category>';a+='<category id="catOperators"><category id="catOperatorsNumeric"><block type="math_arithmetic"><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="math_number"></block><block type="math_constant"></block><block type="math_number_property"><value name="NUMBER_TO_CHECK"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="math_single"><value name="NUM"><shadow type="math_number"><field name="NUM">9</field></shadow></value></block><block type="math_trig"><value name="NUM"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block><block type="math_round"><value name="NUM"><shadow type="math_number"><field name="NUM">3.1</field></shadow></value></block><block type="math_on_list"></block><block type="math_modulo"><value name="DIVIDEND"><shadow type="math_number"><field name="NUM">64</field></shadow></value><value name="DIVISOR"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="math_constrain"><value name="VALUE"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="LOW"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="HIGH"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_int"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_float"></block></category><category id="catOperatorsLogic"><block type="logic_compare"></block><block type="logic_operation"></block><block type="logic_negate"></block><block type="logic_boolean"></block><block type="logic_null"></block></category><category id="catOperatorsBitwise"><block type="bitwise_unary_op"><value name="OP1"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="bitwise_op"><value name="OP1"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="OP2"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block></category><category id="catOperatorsText"><block type="text_join"></block><block type="text_append"><value name="TEXT"><shadow type="text"></shadow></value></block><block type="text_length"><value name="VALUE"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_isEmpty"><value name="VALUE"><shadow type="text"><field name="TEXT"></field></shadow></value></block><block type="text_indexOf"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value><value name="FIND"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_charAt"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value></block><block type="text_getSubstring"><value name="STRING"><block type="variables_get"><field name="VAR">text</field></block></value></block><block type="text_changeCase"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_trim"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_print"></value></block><block type="text"></block><block type="text_pack"></block><block type="text_unpack"></block></category></category><category id="catLists" colour="260"><block type="lists_create_with"><mutation items="0"></mutation></block><block type="lists_create_with"></block><block type="lists_repeat"><value name="NUM"><shadow type="math_number"><field name="NUM">5</field></shadow></value></block><block type="lists_length"></block><block type="lists_isEmpty"></block><block type="lists_indexOf"><value name="VALUE"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_getIndex"><value name="VALUE"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_setIndex"><value name="LIST"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_getSublist"><value name="LIST"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_split"><value name="DELIM"><shadow type="text"><field name="TEXT">,</field></shadow></value></block></category><category id="catVariables" colour="330" custom="VARIABLE"></category><category id="catFunctions" colour="290" custom="PROCEDURE"></category><sep gap="32"></sep>';if(Code.status.modules.pio||Code.status.modules.adc||Code.status.modules.pwm){a+='<category id="catIO" colour="20">';if(Code.status.modules.pio){a+='<block type="when_digital_pin"><value name="PIN"><shadow type="input_digital_pin"></shadow></value></block><block type="setdigitalpin"><value name="PIN"><shadow type="output_digital_pin"></shadow></value></block><block type="invertdigitalpin"><value name="PIN"><shadow type="output_digital_pin"></shadow></value></block><block type="getdigitalpin"><value name="PIN"><shadow type="input_digital_pin"></shadow></value></block>'}if(Code.status.modules.adc){a+='<block type="getanalogpin"><value name="PIN"><shadow type="analog_pins"></shadow></value></block>';a+='<block type="getexternalanalogchannel"><value name="UNIT"><shadow type="external_analog_units"></shadow></value><value name="CHANNEL"><shadow type="external_analog_channels"></shadow></value></block>'}if(Code.status.modules.pwm){a+='<block type="setpwmpin"><value name="PIN"><shadow type="pwm_pins"></shadow></value><value name="FREQUENCY"><shadow type="math_number"><field name="NUM">1000</field></shadow></value><value name="DUTY"><shadow type="math_number"><field name="NUM">50</field></shadow></value></block>'}a+="</category>"}if(Code.status.modules.i2c||Code.status.modules.can){a+='<category id="catComm" colour="20">';if(Code.status.modules.can){a+='<category id="catCan"><block type="cansetspeed"><value name="SPEED"><shadow type="math_number"><field name="NUM">500</field></shadow></value></block><block type="cansetfilter"><value name="FROM"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="canframewrite"></block><block type="canread"></block><block type="canframeset"><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="canframeget"></block><block type="cantype"></block></category>'}if(Code.status.modules.i2c){a+='<category id="catI2C"><block type="i2csetspeed"><value name="SPEED"><shadow type="math_number"><field name="NUM">1000</field></shadow></value></block><block type="i2cstartcondition"></block><block type="i2cstopcondition"></block><block type="i2caddress"><value name="ADDRESS"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="i2cread"></block><block type="i2cwrite"><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block></category>'}a+="</category>"}if(Code.status.modules.sensor){a+='<category id="catSensor" custom="SENSOR" colour="20">';a+='<button function="expand(1)">Expand section</button>';a+="</category>"}if(Code.status.modules.servo){a+='<category id="catActuators">';a+='<block type="servo_move"><value name="PIN"><shadow type="output_digital_pin"></shadow></value><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block>'}a+="</category>";if(Code.status.modules.net){a+='<category id="catNET" colour="20">';a+='<category id="catWIFI" custom="WIFI" colour="20">';a+="</category>";a+="</category>"}if(Code.status.modules.lora){a+='<category id="catLora" custom="LORA" colour="20">';a+='<button function="expand(1)">Expand section</button>';a+="</category>"}if(Code.status.modules.mqtt){a+='<category id="catMQTT" custom="MQTT"colour="20">';a+='<button function="expand(1)">Expand section</button>';a+="</category>"}Code.lib.get(a,"libs",function(c){var d=document.getElementById("toolbox");d.innerHTML=c;jQuery("#catVariables").attr("colour",Blockly.Blocks.variables.HUE);jQuery("#catLists").attr("colour",Blockly.Blocks.lists.HUE);jQuery("#catIO").attr("colour",Blockly.Blocks.io.HUE);jQuery("#catControl").attr("colour",Blockly.Blocks.control.HUE);jQuery("#catEvents").attr("colour",Blockly.Blocks.events.HUE);jQuery("#catSensor").attr("colour",Blockly.Blocks.sensor.HUE);jQuery("#catComm").attr("colour",Blockly.Blocks.io.HUE);jQuery("#catI2C").attr("colour",Blockly.Blocks.io.HUE);jQuery("#catCan").attr("colour",Blockly.Blocks.io.HUE);jQuery("#catActuators").attr("colour",Blockly.Blocks.actuators.HUE);jQuery("#catOperators").attr("colour",Blockly.Blocks.operators.HUE);jQuery("#catNET").attr("colour",Blockly.Blocks.lora.HUE);jQuery("#catWIFI").attr("colour",Blockly.Blocks.lora.HUE);jQuery("#catMQTT").attr("colour",Blockly.Blocks.lora.HUE);b()})};Code.updateToolBox=function(){Code.buildToolBox(function(){Code.initLanguage();var a=null;var b=null;if(Code.workspace.type=="block_editor"){a=document.getElementById("block_editortoolbox");b=Code.workspace.block_editor}else{a=document.getElementById("toolbox");b=Code.workspace.blocks}if(b){b.updateToolbox(a)}})};Code.init=function(){Code.initLanguage();var d=Code.isRtl();var a=document.getElementById("content_area");var f=function(m){var l=Code.getBBox_(a);for(var h=0;h<Code.TABS_.length;h++){var k=document.getElementById("content_"+Code.TABS_[h]);if(Code.TABS_[h]=="program"){if(Code.workspace.type=="blocks"){k=document.getElementById("content_blocks")}else{if(Code.workspace.type=="editor"){k=document.getElementById("content_editor")}else{if(Code.workspace.type=="block_editor"){k=document.getElementById("content_block_editor")}}}}var j=k;k.style.top=l.y+"px";k.style.left=l.x+"px";k.style.height=l.height+"px";k.style.height=(2*l.height-k.offsetHeight-34)+"px";k.style.width=l.width+"px";k.style.width=(2*l.width-k.offsetWidth)+"px";k=document.getElementById("languageDiv");var g=Code.getBBox_(k);k.style.position="absolute";k.style.height="38px";k.style.width=g.width+"px";k.style.top=(l.y-38)+"px";k.style.left=(l.width-l.x-g.width-10)+"px";k.style.visibility="visible";var k=document.getElementById("boardConsole");k.style.top=j.style.top;k.style.left=(parseInt(j.style.width.replace("px",""))-600)+"px";var k=document.getElementById("cloudConsole");k.style.top=j.style.top;k.style.left=(parseInt(j.style.width.replace("px",""))-800)+"px"}};window.addEventListener("resize",f,false);var c=document.getElementById("toolbox");var e=document.getElementById("block_editortoolbox");var b=document.getElementById("block_editortoolboxpreview");Code.workspace.blocks=Blockly.inject("content_blocks",{media:Code.folder+"/media/",rtl:d,toolbox:c,zoom:{controls:true,wheel:true}});Code.workspace.blocks.wcInit();Code.watcher=new watcher();Code.storage.board=new Storage(StorageType.Board);Code.storage.local=new Storage(StorageType.Computer);Code.storage.cloud=new Storage(StorageType.Cloud);Code.loadBlocks("");f();Blockly.svgResize(Code.workspace.blocks);ace.require("ace/ext/language_tools");Code.workspace.editor=ace.edit(document.getElementById("content_editor"));Code.workspace.editor.setShowPrintMargin(true);Code.workspace.editor.setPrintMarginColumn(120);Code.workspace.editor.getSession().setMode("ace/mode/lua");Code.workspace.editor.setOptions({enableBasicAutocompletion:true});Code.workspace.editor.$blockScrolling=Infinity;ace.require("ace/ext/language_tools");Code.workspace.block_editorCode=ace.edit(document.getElementById("block_editor_code"));Code.workspace.block_editorCode.setShowPrintMargin(true);Code.workspace.block_editorCode.setPrintMarginColumn(120);Code.workspace.block_editorCode.getSession().setMode("ace/mode/lua");Code.workspace.block_editorCode.setOptions({enableBasicAutocompletion:true});Code.workspace.block_editorCode.$blockScrolling=Infinity;if("BlocklyStorage" in window){BlocklyStorage.backupOnUnload(Code.workspace.blocks)}Code.bindClick("trashButton",function(){Code.discard();Code.renderContent()});if(jQuery("#developerMode").length>0){jQuery("#developerMode").removeClass("disabled");Code.bindClick("developerMode",Code.developerMode)}if(jQuery("#blockEditorButton").length>0){jQuery("#blockEditorButton").removeClass("disabled");Code.bindClick("blockEditorButton",Code.blockEditor)}if(jQuery("#previewButton").length>0){jQuery("#previewButton").removeClass("disabled");Code.bindClick("previewButton",Code.previewCode)}Code.bindClick("switchToCode",Code.switchToCode);Code.bindClick("switchToBlocks",Code.switchToBlocks);Code.bindClick("loadButton",Code.load);Code.bindClick("saveButton",Code.save);Code.bindClick("saveAsButton",Code.saveAs);Code.bindClick("stopButton",Code.stop);Code.bindClick("runButton",Code.run);Code.bindClick("rebootButton",Code.reboot);if("BlocklyStorage" in window){BlocklyStorage.HTTPREQUEST_ERROR=MSG.httpRequestError;BlocklyStorage.LINK_ALERT=MSG.linkAlert;BlocklyStorage.HASH_ERROR=MSG.hashError;BlocklyStorage.XML_ERROR=MSG.xmlError}window.setTimeout(Code.importPrettify,1)};Code.initLanguage=function(){var o=Code.isRtl();document.dir=o?"rtl":"ltr";document.head.parentElement.setAttribute("lang",Code.settings.language);var d=[];for(var b in Code.LANGUAGE_NAME){d.push([Code.LANGUAGE_NAME[b],b])}var h=function(q,i){if(q[0]>i[0]){return 1}if(q[0]<i[0]){return -1}return 0};d.sort(h);var a=document.getElementById("languageMenu");a.options.length=0;for(var e=0;e<d.length;e++){var p=d[e];var b=p[p.length-1];var g=new Option(p[0],b);if(b==Code.settings.language){g.selected=true}a.options.add(g)}a.addEventListener("change",Code.changeLanguage,true);jQuery(".tabon, .taboff").each(function(i,r){var q=jQuery(r);q.text(MSG[q.attr("id").replace("tab_","")])});if(jQuery("#developerMode").length>0){document.getElementById("developerMode").title=MSG.developerMode}document.getElementById("switchToBlocks").title=MSG.switchToBlocksTooltip;document.getElementById("switchToCode").title=MSG.switchToCodeTooltip;document.getElementById("loadButton").title=MSG.loadButtonTooltip;document.getElementById("saveButton").title=MSG.saveButtonTooltip;document.getElementById("saveAsButton").title=MSG.saveAsButtonTooltip;document.getElementById("rebootButton").title=MSG.rebootButtonTooltip;document.getElementById("stopButton").title=MSG.stopButtonTooltip;document.getElementById("runButton").title=MSG.runTooltip;document.getElementById("trashButton").title=MSG.trashTooltip;var f=[];if(Code.status.modules.pio||Code.status.modules.adc||Code.status.modules.pwm){f.push("catIO")}if(Code.status.modules.sensor){f.push("catSensor")}f.push("catActuators");if(Code.status.modules.i2c||Code.status.modules.can){f.push("catComm")}if(Code.status.modules.i2c){f.push("catI2C")}if(Code.status.modules.can){f.push("catCan")}if(Code.status.modules.lora){f.push("catLora")}if(Code.status.modules.net){f.push("catNET");f.push("catWIFI")}if(Code.status.modules.mqtt){f.push("catMQTT")}f.push("catControl");f.push("catOperators");f.push("catOperatorsNumeric");f.push("catOperatorsLogic");f.push("catOperatorsText");f.push("catOperatorsBitwise");f.push("catExceptions");f.push("catEvents");f.push("catDelays");f.push("catLogic");f.push("catLoops");f.push("catLists");f.push("catVariables");f.push("catFunctions");for(var e=0,n;n=f[e];e++){try{document.getElementById(n).setAttribute("name",MSG[n])}catch(l){}}var k=document.getElementsByClassName("textVar");for(var e=0,c;c=k[e];e++){c.textContent=MSG.textVariable}var m=document.getElementsByClassName("listVar");for(var e=0,j;j=m[e];e++){j.textContent=MSG.listVariable}};Code.discard=function(){if(Code.workspace.type=="blocks"){var a=Code.workspace.blocks.getAllBlocks().length;if(a>0){bootbox.confirm(Blockly.Msg.DELETE_ALL_BLOCKS.replace("%1",a),function(b){if(b){Code.workspace.blocks.clear();Code.setDefaultStorage();Code.tabRefresh()}})}}else{if(Code.workspace.type=="editor"){bootbox.confirm(MSG.DELETE_EDIT_CODE,function(b){if(b){Code.workspace.editor.setValue("",-1);Code.setDefaultStorage();Code.tabRefresh()}})}}};Code.runtimeError=function(b,a,d,c){Code.showError(MSG.runtimeError,MSG.youHaveAnError+"<br><br>"+c,function(){})};Code.run=function(){var d="";Blockly.mainWorkspace.removeStarts();Blockly.mainWorkspace.removeErrors();var a=document.getElementById("content_area");var c=Code.getBBox_(a);if(Code.workspace.type=="blocks"){d=Blockly.Lua.workspaceToCode(Code.workspace.blocks)}else{if(Code.workspace.type=="editor"){d=Code.workspace.editor.getValue()}}if(Code.cloud){}function e(){var g=null;if(Blockly.Lua.usesMQTT(Code.workspace.blocks)){}Code.showProgress(MSG.sendingCode);Code.agent.send({command:"boardRunProgram",arguments:{path:"/_run.lua",code:btoa(d)}},function(i,h){Code.hideProgress()})}var b=Code.getCurrentFullPath();var f=/(?:\.([^.]+))?$/.exec(b)[1];if(typeof f=="undefined"){Code.saveAs(e)}else{e()}};Code.removeFile=function(g,c,b,f,e){var a=Code.getPathFor(c,b);var d=/(?:\.([^.]+))?$/.exec(a)[1];if(d=="xml"){Code.workspace.type="blocks"}else{if(d=="lua"){Code.workspace.type="editor"}else{return}}if(g==StorageType.Board){Code.storage.board.remove(a,function(h){e(h)})}else{if(g==StorageType.Computer){Code.storage.local.remove(a,function(h){e(h)})}else{if(g==StorageType.Cloud){Code.storage.cloud.remove(f,function(h){e(h)})}}}};Code.loadFile=function(g,d,c,f){var a=Code.getPathFor(d,c);var e=/(?:\.([^.]+))?$/.exec(a)[1];if(e=="xml"){Code.workspace.type="blocks"}else{if(e=="lua"){Code.workspace.type="editor"}else{return}}function b(i){Code.closeDialogs();if(Code.workspace.type=="blocks"){var h=Blockly.Xml.textToDom(i);h=Code.workspace.blocks.migrate(h);Code.workspace.blocks.clear();Blockly.Xml.domToWorkspace(h,Code.workspace.blocks);Blockly.resizeSvgContents(Code.workspace.blocks)}else{Code.workspace.editor.setValue(i,-1)}Code.setCurrentStorage(g,d,c,f);Code.tabRefresh();Code.renderContent()}Code.showProgress(MSG.downloadingFile+" "+a+" ...");if(g==StorageType.Board){Code.storage.board.load(a,function(h){b(h)})}else{if(g==StorageType.Computer){Code.storage.local.load(a,function(h){b(h)})}else{if(g==StorageType.Cloud){Code.storage.cloud.load(f,function(h){b(h)})}}}};Code.saveFile=function(h,c,a,g,b,f){var e;if(typeof c=="undefined"){e=a}else{e=Code.getPathFor(c,a)}function d(){Code.setCurrentStorage(h,c,a,g);Code.hideProgress();Code.tabRefresh();if(typeof f=="function"){f()}}Code.showProgress(MSG.sendingFile+" "+e+" ...");if(h==StorageType.Board){Code.storage.board.save(e,g,b,function(){d()})}else{if(h==StorageType.Computer){Code.storage.local.save(e,g,b,function(){d()})}else{if(h==StorageType.Cloud){Code.storage.cloud.save(a,g,b,function(){d()})}}}};Code.load=function(){function d(g){jQuery("#selectedStorage").val(g);jQuery("#selectedId").val("")}function c(g,h){jQuery("#selectedFileName").val("");jQuery("#selectedId").val(h)}function b(h,g,i){c(h);jQuery("#selectedId").val(i);Code.loadFile(jQuery("#selectedStorage").val(),h,g,i)}var f="";if(Code.workspace.type=="blocks"){f="xml"}else{if(Code.workspace.type=="editor"){f="lua"}}var a=document.getElementById("content_area");var e=Code.getBBox_(a);bootbox.dialog({title:MSG.loadBlockTitle,message:'<div id="loadFile" style="position: relative; left: -25px;overflow: auto;width:100%;height:'+(e.height*0.5)+'px;"></div><input type="hidden" id="selectedFolder" value=""><input type="hidden" id="selectedStorage" value=""><input type="hidden" id="selectedId" value=""><input type="hidden" id="selectedFileName" value="">',buttons:{danger:{label:MSG.cancel,className:"btn-default",callback:function(){}}},closable:false,onEscape:true});Code.listDirectories(jQuery("#loadFile"),f,d,c,b)};Code.stop=function(){Blockly.mainWorkspace.removeStarts();if(Code.cloud){Status.show("cloudConsoleOff");Code.cloud.Disconnect();Code.cloud=null}Code.agent.send({command:"boardStop",arguments:{}},function(b,a){Code.renderContent()})};Code.reboot=function(){Blockly.mainWorkspace.removeErrors();Blockly.mainWorkspace.removeStarts();Code.agent.send({command:"boardReset",arguments:{}},function(b,a){Code.renderContent()})};Code.save=function(){var b;var i;var a=document.getElementById("content_area");var k=Code.getBBox_(a);if(Code.workspace.type=="blocks"){i="xml";b=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Code.workspace.blocks))}else{if(Code.workspace.type=="editor"){i="lua";b=Code.workspace.editor.getValue()}else{if(Code.workspace.type=="block_editor"){var h=jQuery("#content_block_editor_type").val();b=btoa(Code.workspace.block_editorCode.getValue());for(var e in Code.lib.def.blocks){if(Code.lib.def.blocks[e].spec.type==h){Code.lib.def.blocks[e].code=b;Code.lib.update();break}}return}}}function g(l){jQuery("#selectedStorage").val(l);jQuery("#selectedId").val("");Code.renderStorage(l,"/",jQuery("#storageType"));jQuery("#selectedFileName").focus()}function c(l,n){var m=jQuery("#selectedStorage").val();jQuery("#selectedFolder").text(l);jQuery("#selectedFolder").val(l);jQuery("#selectedFileName").val("");jQuery("#selectedId").val(n);jQuery("#selectedFileName").focus();Code.renderStorage(m,l,jQuery("#storageType"))}function j(m,l,p){var n=/(?:\.([^.]+))?$/.exec(l)[1];l=l.replace("."+n,"");var o=jQuery("#selectedStorage").val();c(m);jQuery("#selectedFileName").val(l);jQuery("#selectedFileName").focus();jQuery("#selectedId").val(p)}var d=Code.getCurrentFullPath();var f=/(?:\.([^.]+))?$/.exec(d)[1];if(typeof f!="undefined"){Code.saveFile(Code.currentFile.storage,undefined,d,Code.currentFile.id,b)}else{d=Code.getPathFor("","unnamed."+i);bootbox.dialog({title:MSG.saveBlockTitle,message:'<div id="saveFile" style="position: relative; left: -25px;overflow: auto;width:100%;height:'+(k.height*0.5)+'px;"></div><br>'+MSG.saveAs+'&nbsp;&nbsp;<span id="storageType"></span><input type="hidden" id="selectedFolder" value="/"></input><input type="hidden" id="selectedStorage" value="0"><input type="hidden" id="selectedId" value=""><input type="text" id="selectedFileName" value="">.'+i,buttons:{danger:{label:MSG.cancel,className:"btn-default",callback:function(){}},main:{label:MSG.save,className:"btn-primary",callback:function(){var l=jQuery("#selectedFileName").val();if(l!=""){Code.saveFile(jQuery("#selectedStorage").val(),jQuery("#selectedFolder").val(),l+"."+i,jQuery("#selectedId").val(),b)}else{return false}}}},closable:false,onEscape:true});g(Code.defaultStorage());Code.listDirectories(jQuery("#saveFile"),i,g,c,j)}};Code.saveAs=function(h){var f;var g;var a=document.getElementById("content_area");var e=Code.getBBox_(a);if(Code.workspace.type=="blocks"){g="xml";f=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Code.workspace.blocks))}else{if(Code.workspace.type=="editor"){g="lua";f=Code.workspace.editor.getValue()}}function d(i){jQuery("#selectedStorage").val(i);jQuery("#selectedId").val("");Code.renderStorage(i,"/",jQuery("#storageType"));jQuery("#selectedFileName").focus()}function c(i,k){var j=jQuery("#selectedStorage").val();jQuery("#selectedFolder").text(i);jQuery("#selectedFolder").val(i);jQuery("#selectedFileName").val("");jQuery("#selectedFileName").focus();jQuery("#selectedId").val(k);Code.renderStorage(j,i,jQuery("#storageType"))}function b(j,i,m){var k=/(?:\.([^.]+))?$/.exec(i)[1];i=i.replace("."+k,"");var l=jQuery("#selectedStorage").val();c(j);jQuery("#selectedFileName").val(i);jQuery("#selectedFileName").focus();jQuery("#selectedId").val(m)}bootbox.dialog({title:MSG.saveBlockTitle,message:'<div id="saveFile" style="position: relative; left: -25px;overflow: auto;width:100%;height:'+(e.height*0.5)+'px;"></div><br>'+MSG.saveAs+'&nbsp;&nbsp;<span id="storageType"></span><input type="hidden" id="selectedFolder" value="/"></input><input type="hidden" id="selectedStorage" value="0"><input type="hidden" id="selectedId" value=""><input type="text" id="selectedFileName" value="">.'+g,buttons:{danger:{label:MSG.cancel,className:"btn-default",callback:function(){}},main:{label:MSG.save,className:"btn-primary",callback:function(){var i=jQuery("#selectedFileName").val();if(i!=""){Code.saveFile(jQuery("#selectedStorage").val(),jQuery("#selectedFolder").val(),i+"."+g,jQuery("#selectedId").val(),f,h)}else{return false}}}},closable:false,onEscape:true});d(Code.defaultStorage());Code.listDirectories(jQuery("#saveFile"),g,d,c,b)};Code.showProgress=function(a){Code.closeDialogs();BootstrapDialog.show({message:'<div class="progress progress-striped active" style="width: 100%;"><div class="progress-bar" role="progressbar" style="width: 100%;"></div></div>',title:a,closable:false})};Code.hideProgress=function(){Code.closeDialogs()};Code.showInformation=function(a){Code.closeDialogs();setTimeout(function(){BootstrapDialog.show({message:a,title:MSG.information,closable:false,onshow:function(b){setTimeout(function(){b.close()},2500)}})},500)};Code.closeDialogs=function(){BootstrapDialog.closeAll();bootbox.hideAll();Code.removeHelpHandlers()};Code.removeHelpHandlers=function(){jQuery(".modal-body").find("a").unbind("click")};Code.addHelpHandlers=function(){jQuery(".modal-body").find("a").unbind("click").bind("click",function(b){var a=jQuery(b.target);alert(Code.server+"/"+a.attr("href"));Code.showHelp(Code.server+"/"+a.attr("href"));return false})};Code.showHelp=function(a){Code.closeDialogs();setTimeout(function(){jQuery.ajax({url:Code.server+"/"+a,type:"GET",crossDomain:true,success:function(b){bootbox.dialog({title:Blockly.Msg.HELP,message:b,closable:true,onEscape:true,size:"large"}).on("shown.bs.modal",function(c){Code.addHelpHandlers()})},error:function(){}})},500)};Code.showAlert=function(a){Code.closeDialogs();BootstrapDialog.show({message:a,title:MSG.alert,closable:true,onshow:function(b){setTimeout(function(){jQuery(".btn-alert-instructions").unbind("click").bind("click",function(d){b.close();var c=jQuery(d.target);if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){Code.showHelp(c.data("url"))}else{Code.showHelp(c.data("url"))}}else{Code.showHelp(c.data("url"))}})},500)}})};Code.showError=function(b,a,c){Code.closeDialogs();setTimeout(function(){bootbox.dialog({title:b,message:a,buttons:{main:{label:MSG.ok,className:"btn-primary",callback:function(){if(typeof c!=undefined){c()}}}},closable:false})},500)};Code.newFirmware=function(){if(!Code.checkNewFirmwareVersion){return}bootbox.dialog({message:MSG.newFirmware,buttons:{danger:{label:MSG.notNow,className:"btn-default",callback:function(){Code.checkNewFirmwareVersion=false}},success:{label:MSG.installNow,className:"btn-primary",callback:function(){Code.agent.send({command:"boardUpgrade",arguments:{}},function(b,a){Code.showProgress(MSG.downloadingFirmware)})}}},closable:false,onEscape:true})};Code.listDirectoriesUpdate=function(b,f,d,a,e){var c="";c+='<ul class="dir-entry">';a.forEach(function(k){var h=true;if(typeof e!="undefined"){h=k.name.match(new RegExp("^.*."+e+"$"))||(k.type=="d")}if(h){var j="icon-file-text2";var g=d;var i="";if(typeof k.id!="undefined"){i=k.id}else{i=""}if(k.type=="d"){j="icon-folder2";if(d!=""){g+="/"}g+=k.name}c=c+'<li class="dir-entry-'+k.type+'" data-expanded="false" data-type="'+k.type+'" data-id="'+i+'" data-path="'+g+'" data-name="'+k.name+'" data-storage="'+f+'"><span data-type="'+k.type+'" class="icon '+j+'"></span><span class="dir-label">'+k.name+"</span></li>"}});c+="</ul>";b.append(c)};Code.listDirectories=function(a,f,e,d,c){var b="";b+='<ul class="dir-entry">';b+='<li class="dir-entry-d" data-expanded="false" data-type="r" data-id data-path data-name data-storage="'+StorageType.Board+'"><span class="icon icon-chip"></span><span class="dir-label">Board</span></li>';b+='<li class="dir-entry-d" data-expanded="false" data-type="r" data-id data-path data-name data-storage="'+StorageType.Computer+'"><span class="icon icon-display"></span><span class="dir-label">Computer</span></li>';b+='<li class="dir-entry-d" data-expanded="false" data-type="r" data-id data-path data-name data-storage="'+StorageType.Cloud+'"><span class="icon icon-cloud"></span><span class="dir-label">Cloud</span></li>';b+="</ul>";a.append(b);window.dispatchEvent(new Event("resize"));a.find(".dir-entry-d, .dir-entry-f").unbind().bind("click",function(l){var k=jQuery(l.target);if(k.prop("tagName")!="LI"){k=k.closest("li")}var h=k.attr("data-type");var n=k.attr("data-storage");var g=k.attr("data-expanded");var j=k.attr("data-path");var i=k.attr("data-name");var m=k.attr("data-id");j=j.replace(/[\\\/]+/g,"/");if(j.charAt(0)!="/"){j="/"+j}if(j.charAt(j.length-1)!="/"){j=j+"/"}jQuery(".dir-entry-d[data-type='r']").each(function(o,p){var q=jQuery(p);if(!jQuery.contains(p,l.target)){q.find("ul").empty();q.attr("data-expanded","false")}});if((h=="r")||(h=="d")){if(g=="true"){k.find("ul").empty();k.attr("data-expanded","false")}else{k.attr("data-expanded","true")}if(g=="false"){if(n==StorageType.Board){Code.storage.board.listDirectories(j,function(o){Code.listDirectoriesUpdate(k,n,j,o,f);jQuery('.dir-entry-d[data-expanded="true"]').find("span[data-type='d']").removeClass("icon-folder2").addClass("icon-folder-open");jQuery('.dir-entry-d[data-expanded="false"]').find("span[data-type='d']").removeClass("icon-folder-open").addClass("icon-folder2");if(typeof e!="undefined"){e(n)}if(typeof d!="undefined"){d(j,m)}})}else{if(n==StorageType.Computer){Code.storage.local.listDirectories(j,function(o){Code.listDirectoriesUpdate(k,n,j,o,f);jQuery('.dir-entry-d[data-expanded="true"]').find("span[data-type='d']").removeClass("icon-folder2").addClass("icon-folder-open");jQuery('.dir-entry-d[data-expanded="false"]').find("span[data-type='d']").removeClass("icon-folder-open").addClass("icon-folder2");if(typeof e!="undefined"){e(n)}if(typeof d!="undefined"){d(j,m)}})}else{if(n==StorageType.Cloud){Code.storage.cloud.listDirectories(m,function(o){Code.listDirectoriesUpdate(k,n,j,o,f);jQuery('.dir-entry-d[data-expanded="true"]').find("span[data-type='d']").removeClass("icon-folder2").addClass("icon-folder-open");jQuery('.dir-entry-d[data-expanded="false"]').find("span[data-type='d']").removeClass("icon-folder-open").addClass("icon-folder2");if(typeof e!="undefined"){e(n)}if(typeof d!="undefined"){d(j,m)}})}}}}else{if(n==StorageType.Board){if(typeof e!="undefined"){e(n)}if(typeof d!="undefined"){d(j,m)}}else{if(n==StorageType.Computer){if(typeof e!="undefined"){e(n)}if(typeof d!="undefined"){d(j,m)}}else{if(n==StorageType.Cloud){if(typeof e!="undefined"){e(n)}if(typeof d!="undefined"){d(j,m)}}}}}}else{if(h=="f"){if(typeof e!="undefined"){e(n)}if(typeof c!="undefined"){c(j,i,m)}}}l.stopPropagation()});jQuery.contextMenu({selector:".dir-entry-f",items:{remove:{name:Blockly.Msg.DELETE_FILE,callback:function(i,h){var l=jQuery(this);var g;var n=l.attr("data-id");var k=l.attr("data-path");var j=l.attr("data-name");var m=l.attr("data-storage");bootbox.confirm(Blockly.Msg.DELETE_FILE_CONFIRM.replace("%1",j),function(o){if(o){Code.removeFile(m,k,j,n,function(p){if(p){Code.showInformation(Blockly.Msg.FILE_DELETED.replace("%1",j))}})}else{setTimeout(function(){jQuery("body").addClass("modal-open")},500)}})}}}})};Code.tabRefresh=function(){if((Code.selected=="program")&&(Code.workspace.type=="blocks")){jQuery("#developerMode, #switchToCode, #trashButton, #loadButton, #saveButton,  #saveAsButton, #rebootButton, #stopButton, #runButton").removeClass("disabled");jQuery("#switchToBlocks").addClass("disabled")}else{if((Code.selected=="program")&&(Code.workspace.type=="editor")){jQuery("developerMode, #switchToBlocks, #trashButton, #loadButton, #saveButton, #saveAsButton, #rebootButton, #stopButton, #runButton").removeClass("disabled");jQuery("#switchToCode").addClass("disabled")}else{if((Code.selected=="program")&&(Code.workspace.type=="block_editor")){jQuery("#trashButton, #loadButton, #saveButton, #saveAsButton, #rebootButton, #stopButton, #runButton").removeClass("disabled");jQuery("#developerMode, #switchToCode, #switchToBlocks").addClass("disabled")}else{if(Code.selected=="board"){jQuery("#developerMode, #switchToCode, #switchToBlocks, #trashButton, #loadButton, #saveButton, #saveAsButton, #rebootButton, #stopButton, #runButton").addClass("disabled")}}}}if(!Code.status.connected){jQuery("#stopButton, #runButton, #tab_board, #rebootButton").addClass("disabled")}else{jQuery("#stopButton, #runButton, #rebootButton").removeClass("disabled")}if(Code.workspace.type=="block_editor"){jQuery("#saveButton").removeClass("disabled")}if(Code.showCode){jQuery("#saveButton").addClass("disabled");jQuery("#saveAsButton").addClass("disabled")}};Code.developerMode=function(){if(jQuery("#developerMode").hasClass("on")){jQuery("#developerMode").removeClass("on");jQuery("#developerMode").find(".icon").addClass("off");Blockly.Lua.developerMode=false}else{jQuery("#developerMode").addClass("on");jQuery("#developerMode").find(".icon").removeClass("off");Blockly.Lua.developerMode=true}Code.workspace.editor.setValue(Blockly.Lua.workspaceToCode(Code.workspace.blocks),-1);Code.workspace.editor.focus();Code.renderContent()};Code.blockEditor=function(){if(Code.workspace.type=="block_editor"){Code.workspace.type="blocks"}else{Code.workspace.type="block_editor"}Code.renderContent()};Code.previewCode=function(){Code.showCode=!Code.showCode;if(Code.showCode){Code.workspace.type="editor";Code.workspace.prevType=Code.workspace.type;Code.workspace.editor.setValue(Blockly.Lua.workspaceToCode(Code.workspace.blocks),-1);Code.workspace.editor.focus();Code.renderContent()}else{Code.workspace.type="blocks";Code.workspace.prevType=Code.workspace.type;Code.workspace.editor.setValue("",-1);Code.workspace.editor.focus();Code.renderContent()}};Code.switchToCode=function(){function a(){Code.setDefaultStorage();Code.settings.programmingModel="lua";Settings.save(Code.settings);Code.workspace.blocks.clear();Code.workspace.type="editor";Code.workspace.prevType=Code.workspace.type;Code.workspace.editor.setValue("",-1);Code.workspace.editor.focus();Code.renderContent()}bootbox.dialog({title:MSG.information,message:MSG.switchToCodeWarning,buttons:{danger:{label:MSG.no,className:"btn-default",callback:function(){}},success:{label:MSG.yes,className:"btn-primary",callback:function(){a()}}},closable:false,onEscape:true})};Code.switchToBlocks=function(){function a(){Code.setDefaultStorage();Code.settings.programmingModel="blocks";Settings.save(Code.settings);Code.workspace.blocks.clear();Code.workspace.type="blocks";Code.workspace.prevType=Code.workspace.type;Code.workspace.editor.setValue("",-1);Code.workspace.editor.focus();Code.renderContent()}bootbox.dialog({title:MSG.informatiom,message:MSG.switchToBlocksWarning,buttons:{danger:{label:MSG.no,className:"btn-default",callback:function(){}},success:{label:MSG.yes,className:"btn-primary",callback:function(){a()}}},closable:false,onEscape:true})};Code.setup=function(){Code.agent.addListener("boardPowerOnReset",function(b,a){Blockly.mainWorkspace.removeErrors();Blockly.mainWorkspace.removeStarts();Code.status=JSON.parse(JSON.stringify(Code.defaultStatus));Code.board.getMaps(Code.settings.board,function(c){Code.status.maps=c});Code.renderContent()});Code.agent.addListener("boardAttached",function(b,a){Blockly.mainWorkspace.removeErrors();Blockly.mainWorkspace.removeStarts();Status.hide();Code.status=JSON.parse(JSON.stringify(Code.defaultStatus));Code.status=a.info;Code.settings.board=a.info.board;Status.show(Code.board.getDesc(Code.settings.board));Code.board.getMaps(Code.settings.board,function(c){Code.status.maps=c;Code.status.connected=true;Code.status.firmware=a.info.os+"-"+a.info.version.replace(" ","-")+"-"+a.info.build;Code.renderContent()});if((Code.agent.version=="")||(parseFloat(Code.agent.version)<parseFloat(Code.minAgentVersion))){if(Code.checkNewAgentVersion){Code.showAlert(MSG.pleaseUpgradeAgent)}Code.checkNewAgentVersion=false}else{if(Code.agent.version>"1.2"){if(a.newBuild){Code.newFirmware()}}}});Code.agent.addListener("boardConsoleOut",function(b,a){Term.write(atob(a.content))});Code.agent.addListener("attachIde",function(b,a){if(!a.hasOwnProperty("agent-version")){Code.showAlert(MSG.pleaseUpgradeAgent)}else{Code.agent.version=a["agent-version"];if(Code.agent.version>"1.2"){Code.agent.consoleUpSocketConnect();Code.agent.consoleDownSocketConnect()}}});Code.agent.addListener("boardDetached",function(b,a){Blockly.mainWorkspace.removeErrors();Blockly.mainWorkspace.removeStarts();Status.show("Connect a board");Code.status=JSON.parse(JSON.stringify(Code.defaultStatus));Code.board.getMaps(Code.settings.board,function(c){Code.status.maps=c;Code.renderContent()})});Code.agent.addListener("boardUpgraded",function(b,a){Blockly.mainWorkspace.removeErrors();Blockly.mainWorkspace.removeStarts();Code.hideProgress();Code.tabRefresh()});Code.agent.addListener("blockStart",function(d,b){if(Code.workspace.type=="blocks"){var c=atob(b.block).replace(/\0/g,"");var a=Blockly.mainWorkspace.getBlockById(Blockly.Lua.numToBlockId(c));if((a.type=="cpu_sleep")||(a.type=="when_board_starts")){Blockly.mainWorkspace.removeStarts()}a.addStart()}});Code.agent.addListener("blockEnd",function(d,b){if(Code.workspace.type=="blocks"){var c=atob(b.block).replace(/\0/g,"");var a=Blockly.mainWorkspace.getBlockById(Blockly.Lua.numToBlockId(c));a.removeStart()}});Code.agent.addListener("blockError",function(e,c){if(Code.workspace.type=="blocks"){Blockly.mainWorkspace.removeStarts();Blockly.mainWorkspace.removeErrors();var d=atob(c.block).replace(/\0/g,"");var b=Blockly.mainWorkspace.getBlockById(Blockly.Lua.numToBlockId(d));var a=atob(c.error);b.addError();b.setWarningText(a)}});Code.agent.addListener("boardUpdate",function(b,a){Blockly.mainWorkspace.removeErrors();Blockly.mainWorkspace.removeStarts();if(Code.agent.version>"1.2"){a.what=atob(a.what)}Status.show(a.what)});Code.agent.addListener("boardRuntimeError",function(b,a){a.message=atob(a.message);Code.runtimeError(a.where,a.line,a.exception,a.message)});if(typeof ide_init==="function"){ide_init()}Settings.load(Code.settings);Blockly.Blocks.operators={};if(Code.settings.programmingModel=="blocks"){Code.workspace.type="blocks"}else{if(Code.settings.programmingModel=="lua"){Code.workspace.type="editor"}}Blockly.Blocks.variables.HUE="#ee7d16";Blockly.Blocks.lists.HUE="#cc5b22";Blockly.Blocks.control.HUE="#e1a91a";Blockly.Blocks.events.HUE="#c88330";Blockly.Blocks.sensor.HUE="#2ca5e2";Blockly.Blocks.operators.HUE="#5cb712";Blockly.Blocks.i2c.HUE=Blockly.Blocks.io.HUE;Blockly.Blocks.can.HUE=Blockly.Blocks.io.HUE;Blockly.Blocks.actuators.HUE="#4a6cd4";Blockly.Blocks["try"].HUE=Blockly.Blocks.control.HUE;Blockly.Blocks.loops.HUE=Blockly.Blocks.control.HUE;Blockly.Blocks.logic.HUE=Blockly.Blocks.control.HUE;Blockly.Blocks.constant.HUE="#cccccc";Blockly.Blocks.texts.HUE=Blockly.Blocks.operators.HUE;Blockly.Blocks.math.HUE=Blockly.Blocks.operators.HUE;jQuery.getScript("msg/wc/"+Code.settings.language+".js",function(){jQuery.getScript("msg/js/"+Code.settings.language+".js",function(){Code.board.getMaps(Code.settings.board,function(a){Code.status.maps=a;Code.buildToolBox(function(){Code.init();Term.init();Code.renderContent();Code.agent.controlSocketConnect();if(typeof ide_post_init==="function"){ide_post_init()}})})})})};window.addEventListener("load",function(){$.ajax({xhrFields:{withCredentials:true}});Code.agent=new agent();Code.board=new board();Code.lib=new blockLibrary();Code.blocklyFactory=null;if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){Code.blocklyFactory=new AppController()}}Code.setup()});if(typeof require!="undefined"){if(typeof require("nw.gui")!="undefined"){var gui=require("nw.gui");var win=gui.Window.get();win.on("close",function(a){Code.agent.send({command:"detachIde",arguments:{}},function(c,b){});win.close(true)})}else{appWin.addEventListener("close",function(){Code.agent.send({command:"detachIde",arguments:{}},function(b,a){})})}}else{window.addEventListener("close",function(){Code.agent.send({command:"detachIde",arguments:{}},function(b,a){})})};